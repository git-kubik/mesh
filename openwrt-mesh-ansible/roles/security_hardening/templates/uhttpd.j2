# uHTTPd Configuration - Security Hardened
# Generated by Ansible security_hardening role - DO NOT EDIT MANUALLY
#
# This configuration includes:
# - HTTPS with self-signed certificates
# - HTTP to HTTPS redirect (optional)
#
# NOTE: uhttpd does NOT support custom HTTP security headers (X-Frame-Options,
# Content-Security-Policy, etc.). A reverse proxy (nginx) would be required
# to add such headers.

config uhttpd 'main'
	# HTTP listen addresses
	list listen_http '0.0.0.0:80'
	list listen_http '[::]:80'
{% if security_https_enabled | bool %}
	# HTTPS listen addresses
	list listen_https '0.0.0.0:443'
	list listen_https '[::]:443'
{% endif %}

	# Server document root
	option home '/www'

	# Security settings
	option rfc1918_filter '1'
	option max_requests '3'
	option max_connections '100'

	# Timeouts
	option script_timeout '60'
	option network_timeout '30'

{% if security_https_enabled | bool %}
	# TLS/SSL Configuration
	option cert '/etc/uhttpd.crt'
	option key '/etc/uhttpd.key'
{% if security_http_redirect_enabled | bool %}
	option redirect_https '1'
{% else %}
	option redirect_https '0'
{% endif %}
{% endif %}

	# CGI Configuration for LuCI
	option cgi_prefix '/cgi-bin'
	list lua_prefix '/cgi-bin/luci=/usr/lib/lua/luci/sgi/uhttpd.lua'
	option ubus_prefix '/ubus'

	# Index page
	option index_page 'index.html'

config cert 'px5g'
	option days '{{ security_tls_cert_days }}'
	option bits '2048'
	option country '{{ security_tls_cert_country }}'
	option state '{{ security_tls_cert_state }}'
	option location '{{ security_tls_cert_locality }}'
	option commonname '{{ inventory_hostname }}'
	option organisation '{{ security_tls_cert_org }}'
