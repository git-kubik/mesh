# OpenWrt Mesh Network - Complete Environment Configuration
#
# This file consolidates ALL environment variables for both:
# - Docker containers (PostgreSQL, Semaphore)
# - Ansible deployment (OpenWrt mesh network)
#
# IMPORTANT SECURITY INSTRUCTIONS:
# 1. Copy this file to .env:  cp .env.example .env
# 2. Update all values with your specific configuration
# 3. Never commit .env to git (it's in .gitignore)
# 4. Keep .env secure (600 permissions recommended)
#
# Usage:
#   set -a; source .env; set +a  # Load before deployment
#   Both Docker Compose and Ansible automatically read these environment variables

# ============================================================================
# DOCKER: PostgreSQL Database
# ============================================================================

# Strong password for PostgreSQL database (min 16 chars recommended)
# Generate with: openssl rand -base64 24
POSTGRES_PASSWORD=CHANGE_THIS_PASSWORD

# ============================================================================
# DOCKER: Semaphore Web Interface
# ============================================================================

# Port to expose Semaphore on localhost
SEMAPHORE_PORT=3000

# Semaphore admin username (for login)
SEMAPHORE_ADMIN=admin

# Semaphore admin password (REQUIRED - min 12 chars recommended)
# Generate with: openssl rand -base64 18
SEMAPHORE_ADMIN_PASSWORD=CHANGE_THIS_PASSWORD

# Semaphore admin display name
SEMAPHORE_ADMIN_NAME=Admin

# Semaphore admin email
SEMAPHORE_ADMIN_EMAIL=admin@localhost

# Semaphore Access Key Encryption
# Generate with: head -c32 /dev/urandom | base64
# Leave empty on first run, Semaphore will generate if needed
SEMAPHORE_ACCESS_KEY_ENCRYPTION=

# ============================================================================
# ANSIBLE: REQUIRED Security & Authentication
# ============================================================================

# Root password for console/serial access (NOT used for SSH)
# SSH uses key-based authentication, this is for emergency console access
# Minimum 16 characters recommended
ROOT_PASSWORD=YourSecureRootPassword123!

# 2.4GHz Mesh Network Password (WPA3-SAE)
# Used for wireless mesh backhaul between nodes
# Minimum 8 characters
MESH_PASSWORD=YourSecureMeshPassword123!

# 5GHz Client Access Point Password (WPA2/WPA3)
# Used for client devices connecting to the mesh network
# Minimum 8 characters
CLIENT_PASSWORD=YourSecureClientPassword123!

# ============================================================================
# ANSIBLE: OPTIONAL Additional Network Passwords (if VLANs enabled)
# ============================================================================

# Management Network Password (if enable_vlans=true)
MGMT_PASSWORD=YourSecureMgmtPassword123!

# Guest Network Password (if enable_vlans=true)
GUEST_PASSWORD=YourSecureGuestPassword123!

# ============================================================================
# ANSIBLE: SSH Key Configuration
# ============================================================================

# Path to SSH private key on control machine
# Default: ~/.ssh/openwrt_mesh_rsa
SSH_KEY_PATH=~/.ssh/openwrt_mesh_rsa

# SSH key algorithm (rsa, ed25519, ecdsa)
SSH_KEY_TYPE=rsa

# SSH key size in bits (4096 for RSA, 256 for ed25519)
SSH_KEY_BITS=4096

# SSH key comment
SSH_KEY_COMMENT=ansible@openwrt-mesh

# ============================================================================
# ANSIBLE: Workstation Network Interface
# ============================================================================

# Ethernet interface on control machine for connecting to nodes
# Default: enp5s0 (PCI ethernet on CLI workstation)
# Use 'ip link show' to see available interfaces
ETH_INTERFACE=enp5s0

# ============================================================================
# ANSIBLE: Network Configuration
# ============================================================================

# Mesh network subnet
MESH_NETWORK=10.11.12.0
MESH_NETMASK=255.255.255.0
MESH_CIDR=24

# Gateway IP (typically node1)
MESH_GATEWAY=10.11.12.1

# DNS Servers (comma-separated)
# Examples: Cloudflare (1.1.1.1), Google (8.8.8.8), Quad9 (9.9.9.9)
DNS_PRIMARY=1.1.1.1
DNS_SECONDARY=8.8.8.8

# ============================================================================
# ANSIBLE: DHCP Configuration
# ============================================================================

# DHCP lease time (e.g., 12h, 24h, 7d)
DHCP_LEASETIME=12h

# Per-node DHCP pools (non-overlapping ranges)
# Node 1: 10.11.12.100-149
DHCP_NODE1_START=100
DHCP_NODE1_LIMIT=50

# Node 2: 10.11.12.150-199
DHCP_NODE2_START=150
DHCP_NODE2_LIMIT=50

# Node 3: 10.11.12.200-249
DHCP_NODE3_START=200
DHCP_NODE3_LIMIT=50

# ============================================================================
# ANSIBLE: Batman-adv Mesh Routing Configuration
# ============================================================================

# Routing algorithm (BATMAN_IV or BATMAN_V)
# BATMAN_V is recommended for better performance
BATMAN_ROUTING_ALGO=BATMAN_V

# WAN bandwidth for gateway selection (kbit/s)
# Format: download/upload
# Examples: 100000/100000 (100Mbps), 500000/50000 (500/50 Mbps)
BATMAN_GW_BANDWIDTH=100000/100000

# Originator message interval in milliseconds
# Lower values = faster failover but more overhead
# Default: 1000 (1 second), Recommended for hybrid wired/wireless: 500ms
BATMAN_ORIG_INTERVAL=500

# Per-interface hop penalties (0-255)
# Different penalties for wired vs wireless prevents route flapping
# Lower values = prefer this path type

# Wired mesh hop penalty (LAN3/LAN4 via switches)
# Low value strongly prefers wired paths (fast, stable, low latency)
# Default: 5
BATMAN_HOP_PENALTY_WIRED=5

# Wireless mesh hop penalty (2.4GHz backup)
# High value penalizes wireless (slower, variable, use as backup only)
# Default: 30
BATMAN_HOP_PENALTY_WIRELESS=30

# Legacy hop penalty (deprecated, kept for compatibility)
# Use BATMAN_HOP_PENALTY_WIRED and BATMAN_HOP_PENALTY_WIRELESS instead
BATMAN_HOP_PENALTY=15

# ============================================================================
# ANSIBLE: Wireless Mesh Configuration (2.4GHz Backbone)
# ============================================================================

# Mesh ID (network name for mesh backhaul)
MESH_ID=HA-Mesh

# Mesh encryption (none, sae)
# SAE (WPA3) recommended for security
MESH_ENCRYPTION=sae

# 2.4GHz channel (1-14, auto)
# Recommended: 1, 6, or 11 (non-overlapping)
MESH_CHANNEL=6

# Channel width (HT20, HT40)
# HT40 for better performance, HT20 for compatibility
MESH_HTMODE=HT40

# Multicast rate in kbit/s (6000, 12000, 24000)
# Higher = better performance but less range
MESH_MCAST_RATE=24000

# ============================================================================
# ANSIBLE: Client WiFi Configuration (5GHz Access Point)
# ============================================================================

# Client SSID (network name visible to devices)
CLIENT_SSID=HA-Client

# Client encryption (psk2, psk2+ccmp, sae, sae-mixed)
# psk2+ccmp = WPA2, sae = WPA3
CLIENT_ENCRYPTION=psk2+ccmp

# 5GHz channel (36-165)
# Recommended: 36, 40, 44, 48 (low band) or 149, 153, 157, 161 (high band)
CLIENT_CHANNEL=36

# Channel width (VHT20, VHT40, VHT80, VHT160)
# VHT80 recommended for balance of speed and compatibility
CLIENT_HTMODE=VHT80

# Country code (2-letter ISO 3166-1)
# Determines available channels and power limits
# Examples: US, GB, AU, DE, FR, CA, JP
CLIENT_COUNTRY=AU

# ============================================================================
# ANSIBLE: 802.11r Fast Roaming
# ============================================================================

# Enable 802.11r fast roaming (true/false)
# Allows seamless handoff between mesh nodes
ENABLE_80211R=true

# Mobility domain (4 hex characters)
# All nodes must use same domain for roaming
MOBILITY_DOMAIN=a1b2

# ============================================================================
# ANSIBLE: MTU Configuration
# ============================================================================

# MTU for wired mesh interfaces (batman-adv over Ethernet)
# Default: 1560 (accounts for batman-adv overhead)
MTU_WIRED_MESH=1560

# MTU for wireless mesh interfaces (batman-adv over WiFi)
# Default: 1532 (accounts for wireless + batman-adv overhead)
MTU_WIRELESS_MESH=1532

# ============================================================================
# ANSIBLE: System Configuration
# ============================================================================

# Timezone (POSIX format)
# Examples: UTC, EST5EDT, PST8PDT, AEST-10, CET-1CEST
TIMEZONE=AEST-10

# Timezone name (human-readable)
# Examples: UTC, America/New_York, Europe/London, Australia/Adelaide
ZONENAME=Australia/Adelaide

# Hostname prefix (will be suffixed with node ID)
# Result: mesh-node1, mesh-node2, mesh-node3
HOSTNAME_PREFIX=mesh-node

# ============================================================================
# ANSIBLE: VLAN Configuration (Optional Multi-Network Support)
# ============================================================================

# Enable VLAN support (true/false)
# Set to false if you only need a single network
ENABLE_VLANS=true

# Management VLAN
MGMT_VLAN_VID=10
MGMT_VLAN_NETWORK=10.11.10.0/24
MGMT_VLAN_DHCP_START=100
MGMT_VLAN_DHCP_LIMIT=50
MGMT_VLAN_SSID=HA-Management
MGMT_VLAN_ENCRYPTION=psk2+ccmp

# Guest VLAN
GUEST_VLAN_VID=30
GUEST_VLAN_NETWORK=10.11.30.0/24
GUEST_VLAN_DHCP_START=100
GUEST_VLAN_DHCP_LIMIT=50
GUEST_VLAN_ISOLATION=true
GUEST_VLAN_SSID=HA-Guest
GUEST_VLAN_ENCRYPTION=psk2+ccmp

# ============================================================================
# ANSIBLE: Package Configuration (Advanced)
# ============================================================================

# Required packages (comma-separated)
# DO NOT MODIFY unless you know what you're doing
# NOTE: python3 is required for Ansible to function properly
# IMPORTANT: Use batctl-full (not batctl) to avoid batctl-tiny
REQUIRED_PACKAGES=python3,batctl-full,kmod-batman-adv,wpad-mesh-mbedtls,ip-full,tcpdump-mini,openssh-server,openssh-sftp-server,openssh-keygen

# Packages to remove (comma-separated)
# Conflicting WiFi packages
REMOVE_PACKAGES=wpad-basic-mbedtls,wpad-basic-wolfssl,wpad-basic

# Optional packages (comma-separated)
# Monitoring and debugging tools
OPTIONAL_PACKAGES=iperf3,ethtool,nano,htop,rsync

# ============================================================================
# ANSIBLE: Service Configuration (Advanced)
# ============================================================================

# Services to enable on boot (comma-separated)
# DO NOT MODIFY unless you know what you're doing
ENABLE_SERVICES=network,firewall,dnsmasq,sshd

# ============================================================================
# ANSIBLE: Deployment Options
# ============================================================================

# Reboot node after deployment for clean initialization (true/false)
# Recommended: true for initial deployments, false for updates
# Can also be passed via command line: -e reboot_after_deploy=true
REBOOT_AFTER_DEPLOY=false

# ============================================================================
# Configuration Tips
# ============================================================================
#
# Network Planning:
#   - Use non-overlapping DHCP pools per node
#   - Reserve IPs 1-99 for static assignments
#   - Choose WiFi channels with minimal interference
#
# Security:
#   - Use 16+ character passwords
#   - Enable WPA3 (SAE) when all clients support it
#   - Isolate guest network from main network
#
# Performance:
#   - Adjust BATMAN_GW_BANDWIDTH to match actual WAN speeds
#   - Use VHT80 for balance of speed and compatibility
#   - Consider HT20 in congested areas
#
# Compatibility:
#   - Check country code for legal channels
#   - Use psk2+ccmp for older devices
#   - Disable 802.11r if devices don't roam
#
# ============================================================================
