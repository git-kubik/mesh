<!DOCTYPE html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="High-availability OpenWrt mesh network with Batman-adv routing"><meta name="author" content="OpenWrt Mesh Network Project"><link href="https://git-kubik.github.io/mesh/openwrt-batman-mesh-setup/" rel="canonical"><link href="../INITIAL-NODE-SETUP/" rel="prev"><link href="../CONTRIBUTING/" rel="next"><link rel="icon" href="../assets/images/favicon.png"><meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23"><title>Complete Setup Guide - OpenWrt Mesh Network Documentation</title><link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css"><link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel="stylesheet" href="../css/timeago.css"><link rel="stylesheet" href="../stylesheets/extra.css"><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head> <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" for="__drawer"></label> <div data-md-component="skip"> <a href="#openwrt-multi-gateway-batman-adv-mesh-network" class="md-skip"> Skip to content </a> </div> <div data-md-component="announce"> </div> <div data-md-color-scheme="default" data-md-component="outdated" hidden> </div> <header class="md-header" data-md-component="header"> <nav class="md-header__inner md-grid" aria-label="Header"> <a href=".." title="OpenWrt Mesh Network Documentation" class="md-header__button md-logo" aria-label="OpenWrt Mesh Network Documentation" data-md-component="logo"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> <label class="md-header__button md-icon" for="__drawer"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <div class="md-header__title" data-md-component="header-title"> <div class="md-header__ellipsis"> <div class="md-header__topic"> <span class="md-ellipsis"> OpenWrt Mesh Network Documentation </span> </div> <div class="md-header__topic" data-md-component="header-topic"> <span class="md-ellipsis"> Complete Setup Guide </span> </div> </div> </div> <form class="md-header__option" data-md-component="palette"> <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo" aria-label="Switch to dark mode" type="radio" name="__palette" id="__palette_0"> <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_1"> <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for="__search"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <div class="md-search" data-md-component="search" role="dialog"> <label class="md-search__overlay" for="__search"></label> <div class="md-search__inner" role="search"> <form class="md-search__form" name="search"> <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required> <label class="md-search__icon md-icon" for="__search"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav class="md-search__options" aria-label="Search"> <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text data-md-component="search-share" tabindex="-1"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg> </a> <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> <div class="md-search__suggest" data-md-component="search-suggest"></div> </form> <div class="md-search__output"> <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix> <div class="md-search-result" data-md-component="search-result"> <div class="md-search-result__meta"> Initializing search </div> <ol class="md-search-result__list" role="presentation"></ol> </div> </div> </div> </div> </div> <div class="md-header__source"> <a href="https://github.com/git-kubik/mesh" title="Go to repository" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </div> <div class="md-source__repository"> git-kubik/mesh </div> </a> </div> </nav> </header> <div class="md-container" data-md-component="container"> <nav class="md-tabs" aria-label="Tabs" data-md-component="tabs"> <div class="md-grid"> <ul class="md-tabs__list"> <li class="md-tabs__item"> <a href=".." class="md-tabs__link"> Home </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href="../ANSIBLE-QUICKSTART/" class="md-tabs__link"> Getting Started </a> </li> <li class="md-tabs__item"> <a href="../CONTRIBUTING/" class="md-tabs__link"> Development </a> </li> <li class="md-tabs__item"> <a href="../GITHUB-SETUP/" class="md-tabs__link"> GitHub Integration </a> </li> <li class="md-tabs__item"> <a href="../docker-README/" class="md-tabs__link"> Reference </a> </li> </ul> </div> </nav> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0"> <label class="md-nav__title" for="__drawer"> <a href=".." title="OpenWrt Mesh Network Documentation" class="md-nav__button md-logo" aria-label="OpenWrt Mesh Network Documentation" data-md-component="logo"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> OpenWrt Mesh Network Documentation </label> <div class="md-nav__source"> <a href="https://github.com/git-kubik/mesh" title="Go to repository" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </div> <div class="md-source__repository"> git-kubik/mesh </div> </a> </div> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1"> <div class="md-nav__link md-nav__container"> <a href=".." class="md-nav__link "> <span class="md-ellipsis"> Home </span> </a> <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_1"> <span class="md-nav__icon md-icon"></span> Home </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../STATUS-UPDATE/" class="md-nav__link"> <span class="md-ellipsis"> Project Status </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked> <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex> <span class="md-ellipsis"> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true"> <label class="md-nav__title" for="__nav_2"> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../ANSIBLE-QUICKSTART/" class="md-nav__link"> <span class="md-ellipsis"> Quick Start </span> </a> </li> <li class="md-nav__item"> <a href="../INITIAL-NODE-SETUP/" class="md-nav__link"> <span class="md-ellipsis"> Initial Node Setup </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc"> <label class="md-nav__link md-nav__link--active" for="__toc"> <span class="md-ellipsis"> Complete Setup Guide </span> <span class="md-nav__icon md-icon"></span> </label> <a href="./" class="md-nav__link md-nav__link--active"> <span class="md-ellipsis"> Complete Setup Guide </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix> <li class="md-nav__item"> <a href="#full-ring-topology-with-vlan-support" class="md-nav__link"> <span class="md-ellipsis"> Full Ring Topology with VLAN Support </span> </a> <nav class="md-nav" aria-label="Full Ring Topology with VLAN Support"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#network-design-overview" class="md-nav__link"> <span class="md-ellipsis"> Network Design Overview </span> </a> </li> <li class="md-nav__item"> <a href="#detailed-port-layout" class="md-nav__link"> <span class="md-ellipsis"> Detailed Port Layout </span> </a> </li> <li class="md-nav__item"> <a href="#client-connection-points" class="md-nav__link"> <span class="md-ellipsis"> Client Connection Points </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#port-allocation-and-client-connectivity" class="md-nav__link"> <span class="md-ellipsis"> Port Allocation and Client Connectivity </span> </a> <nav class="md-nav" aria-label="Port Allocation and Client Connectivity"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#per-node-port-usage" class="md-nav__link"> <span class="md-ellipsis"> Per-Node Port Usage </span> </a> </li> <li class="md-nav__item"> <a href="#wired-client-connectivity" class="md-nav__link"> <span class="md-ellipsis"> Wired Client Connectivity </span> </a> </li> <li class="md-nav__item"> <a href="#client-connection-examples" class="md-nav__link"> <span class="md-ellipsis"> Client Connection Examples </span> </a> </li> <li class="md-nav__item"> <a href="#expanding-wired-ports" class="md-nav__link"> <span class="md-ellipsis"> Expanding Wired Ports </span> </a> </li> <li class="md-nav__item"> <a href="#static-ip-reservations" class="md-nav__link"> <span class="md-ellipsis"> Static IP Reservations </span> </a> </li> <li class="md-nav__item"> <a href="#performance-considerations" class="md-nav__link"> <span class="md-ellipsis"> Performance Considerations </span> </a> </li> <li class="md-nav__item"> <a href="#verifying-client-connectivity" class="md-nav__link"> <span class="md-ellipsis"> Verifying Client Connectivity </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#table-of-contents" class="md-nav__link"> <span class="md-ellipsis"> Table of Contents </span> </a> </li> <li class="md-nav__item"> <a href="#prerequisites" class="md-nav__link"> <span class="md-ellipsis"> Prerequisites </span> </a> <nav class="md-nav" aria-label="Prerequisites"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#required-hardware" class="md-nav__link"> <span class="md-ellipsis"> Required Hardware </span> </a> </li> <li class="md-nav__item"> <a href="#required-softwarepackages" class="md-nav__link"> <span class="md-ellipsis"> Required Software/Packages </span> </a> </li> <li class="md-nav__item"> <a href="#network-planning" class="md-nav__link"> <span class="md-ellipsis"> Network Planning </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#hardware-preparation" class="md-nav__link"> <span class="md-ellipsis"> Hardware Preparation </span> </a> <nav class="md-nav" aria-label="Hardware Preparation"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1-label-your-routers" class="md-nav__link"> <span class="md-ellipsis"> 1. Label Your Routers </span> </a> </li> <li class="md-nav__item"> <a href="#2-verify-hardware-revision" class="md-nav__link"> <span class="md-ellipsis"> 2. Verify Hardware Revision </span> </a> </li> <li class="md-nav__item"> <a href="#3-backup-original-firmware-optional" class="md-nav__link"> <span class="md-ellipsis"> 3. Backup Original Firmware (Optional) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#initial-openwrt-installation" class="md-nav__link"> <span class="md-ellipsis"> Initial OpenWrt Installation </span> </a> <nav class="md-nav" aria-label="Initial OpenWrt Installation"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#download-firmware" class="md-nav__link"> <span class="md-ellipsis"> Download Firmware </span> </a> </li> <li class="md-nav__item"> <a href="#flash-process-per-router" class="md-nav__link"> <span class="md-ellipsis"> Flash Process (Per Router) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#physical-wiring" class="md-nav__link"> <span class="md-ellipsis"> Physical Wiring </span> </a> <nav class="md-nav" aria-label="Physical Wiring"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#ring-topology-connections" class="md-nav__link"> <span class="md-ellipsis"> Ring Topology Connections </span> </a> </li> <li class="md-nav__item"> <a href="#cable-mapping" class="md-nav__link"> <span class="md-ellipsis"> Cable Mapping </span> </a> </li> <li class="md-nav__item"> <a href="#wan-connections" class="md-nav__link"> <span class="md-ellipsis"> WAN Connections </span> </a> </li> <li class="md-nav__item"> <a href="#client-devices" class="md-nav__link"> <span class="md-ellipsis"> Client Devices </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#base-configuration" class="md-nav__link"> <span class="md-ellipsis"> Base Configuration </span> </a> <nav class="md-nav" aria-label="Base Configuration"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#install-required-packages" class="md-nav__link"> <span class="md-ellipsis"> Install Required Packages </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#node-specific-configurations" class="md-nav__link"> <span class="md-ellipsis"> Node-Specific Configurations </span> </a> <nav class="md-nav" aria-label="Node-Specific Configurations"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#node-1-configuration-1011121" class="md-nav__link"> <span class="md-ellipsis"> Node 1 Configuration (10.11.12.1) </span> </a> </li> <li class="md-nav__item"> <a href="#node-2-configuration-1011122" class="md-nav__link"> <span class="md-ellipsis"> Node 2 Configuration (10.11.12.2) </span> </a> </li> <li class="md-nav__item"> <a href="#node-3-configuration-1011123" class="md-nav__link"> <span class="md-ellipsis"> Node 3 Configuration (10.11.12.3) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#vlan-configuration" class="md-nav__link"> <span class="md-ellipsis"> VLAN Configuration </span> </a> <nav class="md-nav" aria-label="VLAN Configuration"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#enable-vlan-support" class="md-nav__link"> <span class="md-ellipsis"> Enable VLAN Support </span> </a> </li> <li class="md-nav__item"> <a href="#add-vlan-aware-wifi-interfaces" class="md-nav__link"> <span class="md-ellipsis"> Add VLAN-Aware WiFi Interfaces </span> </a> </li> <li class="md-nav__item"> <a href="#configure-vlan-firewall-rules" class="md-nav__link"> <span class="md-ellipsis"> Configure VLAN Firewall Rules </span> </a> </li> <li class="md-nav__item"> <a href="#enable-dhcp-for-vlans" class="md-nav__link"> <span class="md-ellipsis"> Enable DHCP for VLANs </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#testing-verification" class="md-nav__link"> <span class="md-ellipsis"> Testing &amp; Verification </span> </a> <nav class="md-nav" aria-label="Testing &amp; Verification"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#initial-connectivity-tests" class="md-nav__link"> <span class="md-ellipsis"> Initial Connectivity Tests </span> </a> </li> <li class="md-nav__item"> <a href="#failover-testing" class="md-nav__link"> <span class="md-ellipsis"> Failover Testing </span> </a> </li> <li class="md-nav__item"> <a href="#performance-testing" class="md-nav__link"> <span class="md-ellipsis"> Performance Testing </span> </a> </li> <li class="md-nav__item"> <a href="#vlan-testing-if-configured" class="md-nav__link"> <span class="md-ellipsis"> VLAN Testing (if configured) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#monitoring-maintenance" class="md-nav__link"> <span class="md-ellipsis"> Monitoring &amp; Maintenance </span> </a> <nav class="md-nav" aria-label="Monitoring &amp; Maintenance"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#create-monitoring-script" class="md-nav__link"> <span class="md-ellipsis"> Create Monitoring Script </span> </a> </li> <li class="md-nav__item"> <a href="#continuous-monitoring" class="md-nav__link"> <span class="md-ellipsis"> Continuous Monitoring </span> </a> </li> <li class="md-nav__item"> <a href="#key-metrics-to-monitor" class="md-nav__link"> <span class="md-ellipsis"> Key Metrics to Monitor </span> </a> </li> <li class="md-nav__item"> <a href="#log-monitoring" class="md-nav__link"> <span class="md-ellipsis"> Log Monitoring </span> </a> </li> <li class="md-nav__item"> <a href="#performance-monitoring" class="md-nav__link"> <span class="md-ellipsis"> Performance Monitoring </span> </a> </li> <li class="md-nav__item"> <a href="#scheduled-monitoring-optional" class="md-nav__link"> <span class="md-ellipsis"> Scheduled Monitoring (Optional) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#troubleshooting" class="md-nav__link"> <span class="md-ellipsis"> Troubleshooting </span> </a> <nav class="md-nav" aria-label="Troubleshooting"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#issue-batman-interface-not-active" class="md-nav__link"> <span class="md-ellipsis"> Issue: Batman Interface Not Active </span> </a> </li> <li class="md-nav__item"> <a href="#issue-mesh-peers-not-connecting" class="md-nav__link"> <span class="md-ellipsis"> Issue: Mesh Peers Not Connecting </span> </a> </li> <li class="md-nav__item"> <a href="#issue-low-tq-values-on-wired-links" class="md-nav__link"> <span class="md-ellipsis"> Issue: Low TQ Values on Wired Links </span> </a> </li> <li class="md-nav__item"> <a href="#issue-gateway-not-switching-on-failover" class="md-nav__link"> <span class="md-ellipsis"> Issue: Gateway Not Switching on Failover </span> </a> </li> <li class="md-nav__item"> <a href="#issue-clients-cant-get-dhcp" class="md-nav__link"> <span class="md-ellipsis"> Issue: Clients Can't Get DHCP </span> </a> </li> <li class="md-nav__item"> <a href="#issue-wired-client-cant-connect" class="md-nav__link"> <span class="md-ellipsis"> Issue: Wired Client Can't Connect </span> </a> </li> <li class="md-nav__item"> <a href="#issue-client-gets-ip-but-no-internet" class="md-nav__link"> <span class="md-ellipsis"> Issue: Client Gets IP But No Internet </span> </a> </li> <li class="md-nav__item"> <a href="#issue-client-connectivity-lost-during-failover" class="md-nav__link"> <span class="md-ellipsis"> Issue: Client Connectivity Lost During Failover </span> </a> </li> <li class="md-nav__item"> <a href="#issue-slow-performance-on-wired-client" class="md-nav__link"> <span class="md-ellipsis"> Issue: Slow Performance on Wired Client </span> </a> </li> <li class="md-nav__item"> <a href="#issue-high-latency-or-packet-loss" class="md-nav__link"> <span class="md-ellipsis"> Issue: High Latency or Packet Loss </span> </a> </li> <li class="md-nav__item"> <a href="#issue-vlan-traffic-not-working" class="md-nav__link"> <span class="md-ellipsis"> Issue: VLAN Traffic Not Working </span> </a> </li> <li class="md-nav__item"> <a href="#issue-frequent-gateway-switching" class="md-nav__link"> <span class="md-ellipsis"> Issue: Frequent Gateway Switching </span> </a> </li> <li class="md-nav__item"> <a href="#issue-poor-wireless-performance" class="md-nav__link"> <span class="md-ellipsis"> Issue: Poor Wireless Performance </span> </a> </li> <li class="md-nav__item"> <a href="#issue-configuration-not-persisting" class="md-nav__link"> <span class="md-ellipsis"> Issue: Configuration Not Persisting </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#advanced-tuning" class="md-nav__link"> <span class="md-ellipsis"> Advanced Tuning </span> </a> <nav class="md-nav" aria-label="Advanced Tuning"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#batman-adv-algorithm-selection" class="md-nav__link"> <span class="md-ellipsis"> Batman-adv Algorithm Selection </span> </a> </li> <li class="md-nav__item"> <a href="#optimize-for-different-scenarios" class="md-nav__link"> <span class="md-ellipsis"> Optimize for Different Scenarios </span> </a> </li> <li class="md-nav__item"> <a href="#qos-over-mesh" class="md-nav__link"> <span class="md-ellipsis"> QoS Over Mesh </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#backup-recovery" class="md-nav__link"> <span class="md-ellipsis"> Backup &amp; Recovery </span> </a> <nav class="md-nav" aria-label="Backup &amp; Recovery"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#backup-configuration" class="md-nav__link"> <span class="md-ellipsis"> Backup Configuration </span> </a> </li> <li class="md-nav__item"> <a href="#restore-configuration" class="md-nav__link"> <span class="md-ellipsis"> Restore Configuration </span> </a> </li> <li class="md-nav__item"> <a href="#configuration-version-control" class="md-nav__link"> <span class="md-ellipsis"> Configuration Version Control </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#security-considerations" class="md-nav__link"> <span class="md-ellipsis"> Security Considerations </span> </a> <nav class="md-nav" aria-label="Security Considerations"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#mesh-security" class="md-nav__link"> <span class="md-ellipsis"> Mesh Security </span> </a> </li> <li class="md-nav__item"> <a href="#network-segmentation" class="md-nav__link"> <span class="md-ellipsis"> Network Segmentation </span> </a> </li> <li class="md-nav__item"> <a href="#monitoring-for-security" class="md-nav__link"> <span class="md-ellipsis"> Monitoring for Security </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#performance-expectations" class="md-nav__link"> <span class="md-ellipsis"> Performance Expectations </span> </a> <nav class="md-nav" aria-label="Performance Expectations"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#throughput-benchmarks" class="md-nav__link"> <span class="md-ellipsis"> Throughput Benchmarks </span> </a> </li> <li class="md-nav__item"> <a href="#latency-benchmarks" class="md-nav__link"> <span class="md-ellipsis"> Latency Benchmarks </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#maintenance-schedule" class="md-nav__link"> <span class="md-ellipsis"> Maintenance Schedule </span> </a> <nav class="md-nav" aria-label="Maintenance Schedule"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#daily" class="md-nav__link"> <span class="md-ellipsis"> Daily </span> </a> </li> <li class="md-nav__item"> <a href="#weekly" class="md-nav__link"> <span class="md-ellipsis"> Weekly </span> </a> </li> <li class="md-nav__item"> <a href="#monthly" class="md-nav__link"> <span class="md-ellipsis"> Monthly </span> </a> </li> <li class="md-nav__item"> <a href="#quarterly" class="md-nav__link"> <span class="md-ellipsis"> Quarterly </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#additional-resources" class="md-nav__link"> <span class="md-ellipsis"> Additional Resources </span> </a> <nav class="md-nav" aria-label="Additional Resources"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#openwrt-documentation" class="md-nav__link"> <span class="md-ellipsis"> OpenWrt Documentation </span> </a> </li> <li class="md-nav__item"> <a href="#batman-adv-project" class="md-nav__link"> <span class="md-ellipsis"> Batman-adv Project </span> </a> </li> <li class="md-nav__item"> <a href="#community-resources" class="md-nav__link"> <span class="md-ellipsis"> Community Resources </span> </a> </li> <li class="md-nav__item"> <a href="#tools" class="md-nav__link"> <span class="md-ellipsis"> Tools </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#quick-reference-guide" class="md-nav__link"> <span class="md-ellipsis"> Quick Reference Guide </span> </a> <nav class="md-nav" aria-label="Quick Reference Guide"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#common-client-connection-scenarios" class="md-nav__link"> <span class="md-ellipsis"> Common Client Connection Scenarios </span> </a> </li> <li class="md-nav__item"> <a href="#common-monitoring-commands" class="md-nav__link"> <span class="md-ellipsis"> Common Monitoring Commands </span> </a> </li> <li class="md-nav__item"> <a href="#emergency-procedures" class="md-nav__link"> <span class="md-ellipsis"> Emergency Procedures </span> </a> </li> <li class="md-nav__item"> <a href="#port-cheat-sheet" class="md-nav__link"> <span class="md-ellipsis"> Port Cheat Sheet </span> </a> </li> <li class="md-nav__item"> <a href="#ip-address-allocation" class="md-nav__link"> <span class="md-ellipsis"> IP Address Allocation </span> </a> </li> <li class="md-nav__item"> <a href="#important-files" class="md-nav__link"> <span class="md-ellipsis"> Important Files </span> </a> </li> <li class="md-nav__item"> <a href="#getting-help" class="md-nav__link"> <span class="md-ellipsis"> Getting Help </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#conclusion" class="md-nav__link"> <span class="md-ellipsis"> Conclusion </span> </a> <nav class="md-nav" aria-label="Conclusion"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#next-steps" class="md-nav__link"> <span class="md-ellipsis"> Next Steps </span> </a> </li> <li class="md-nav__item"> <a href="#support" class="md-nav__link"> <span class="md-ellipsis"> Support </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3"> <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0"> <span class="md-ellipsis"> Development </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_3"> <span class="md-nav__icon md-icon"></span> Development </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../CONTRIBUTING/" class="md-nav__link"> <span class="md-ellipsis"> Contributing </span> </a> </li> <li class="md-nav__item"> <a href="../PRE-COMMIT-HOOKS/" class="md-nav__link"> <span class="md-ellipsis"> Pre-commit Hooks </span> </a> </li> <li class="md-nav__item"> <a href="../PROJECT-STATUS/" class="md-nav__link"> <span class="md-ellipsis"> Project Status </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4"> <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0"> <span class="md-ellipsis"> GitHub Integration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_4"> <span class="md-nav__icon md-icon"></span> GitHub Integration </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../GITHUB-SETUP/" class="md-nav__link"> <span class="md-ellipsis"> Setup Guide </span> </a> </li> <li class="md-nav__item"> <a href="../GITHUB-COMPLETE-SETUP/" class="md-nav__link"> <span class="md-ellipsis"> Complete Integration </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5"> <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0"> <span class="md-ellipsis"> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false"> <label class="md-nav__title" for="__nav_5"> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class="md-nav__list" data-md-scrollfix> <li class="md-nav__item"> <a href="../docker-README/" class="md-nav__link"> <span class="md-ellipsis"> Docker Setup </span> </a> </li> <li class="md-nav__item"> <a href="../tests-README/" class="md-nav__link"> <span class="md-ellipsis"> Test Suite </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix> <li class="md-nav__item"> <a href="#full-ring-topology-with-vlan-support" class="md-nav__link"> <span class="md-ellipsis"> Full Ring Topology with VLAN Support </span> </a> <nav class="md-nav" aria-label="Full Ring Topology with VLAN Support"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#network-design-overview" class="md-nav__link"> <span class="md-ellipsis"> Network Design Overview </span> </a> </li> <li class="md-nav__item"> <a href="#detailed-port-layout" class="md-nav__link"> <span class="md-ellipsis"> Detailed Port Layout </span> </a> </li> <li class="md-nav__item"> <a href="#client-connection-points" class="md-nav__link"> <span class="md-ellipsis"> Client Connection Points </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#port-allocation-and-client-connectivity" class="md-nav__link"> <span class="md-ellipsis"> Port Allocation and Client Connectivity </span> </a> <nav class="md-nav" aria-label="Port Allocation and Client Connectivity"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#per-node-port-usage" class="md-nav__link"> <span class="md-ellipsis"> Per-Node Port Usage </span> </a> </li> <li class="md-nav__item"> <a href="#wired-client-connectivity" class="md-nav__link"> <span class="md-ellipsis"> Wired Client Connectivity </span> </a> </li> <li class="md-nav__item"> <a href="#client-connection-examples" class="md-nav__link"> <span class="md-ellipsis"> Client Connection Examples </span> </a> </li> <li class="md-nav__item"> <a href="#expanding-wired-ports" class="md-nav__link"> <span class="md-ellipsis"> Expanding Wired Ports </span> </a> </li> <li class="md-nav__item"> <a href="#static-ip-reservations" class="md-nav__link"> <span class="md-ellipsis"> Static IP Reservations </span> </a> </li> <li class="md-nav__item"> <a href="#performance-considerations" class="md-nav__link"> <span class="md-ellipsis"> Performance Considerations </span> </a> </li> <li class="md-nav__item"> <a href="#verifying-client-connectivity" class="md-nav__link"> <span class="md-ellipsis"> Verifying Client Connectivity </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#table-of-contents" class="md-nav__link"> <span class="md-ellipsis"> Table of Contents </span> </a> </li> <li class="md-nav__item"> <a href="#prerequisites" class="md-nav__link"> <span class="md-ellipsis"> Prerequisites </span> </a> <nav class="md-nav" aria-label="Prerequisites"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#required-hardware" class="md-nav__link"> <span class="md-ellipsis"> Required Hardware </span> </a> </li> <li class="md-nav__item"> <a href="#required-softwarepackages" class="md-nav__link"> <span class="md-ellipsis"> Required Software/Packages </span> </a> </li> <li class="md-nav__item"> <a href="#network-planning" class="md-nav__link"> <span class="md-ellipsis"> Network Planning </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#hardware-preparation" class="md-nav__link"> <span class="md-ellipsis"> Hardware Preparation </span> </a> <nav class="md-nav" aria-label="Hardware Preparation"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#1-label-your-routers" class="md-nav__link"> <span class="md-ellipsis"> 1. Label Your Routers </span> </a> </li> <li class="md-nav__item"> <a href="#2-verify-hardware-revision" class="md-nav__link"> <span class="md-ellipsis"> 2. Verify Hardware Revision </span> </a> </li> <li class="md-nav__item"> <a href="#3-backup-original-firmware-optional" class="md-nav__link"> <span class="md-ellipsis"> 3. Backup Original Firmware (Optional) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#initial-openwrt-installation" class="md-nav__link"> <span class="md-ellipsis"> Initial OpenWrt Installation </span> </a> <nav class="md-nav" aria-label="Initial OpenWrt Installation"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#download-firmware" class="md-nav__link"> <span class="md-ellipsis"> Download Firmware </span> </a> </li> <li class="md-nav__item"> <a href="#flash-process-per-router" class="md-nav__link"> <span class="md-ellipsis"> Flash Process (Per Router) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#physical-wiring" class="md-nav__link"> <span class="md-ellipsis"> Physical Wiring </span> </a> <nav class="md-nav" aria-label="Physical Wiring"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#ring-topology-connections" class="md-nav__link"> <span class="md-ellipsis"> Ring Topology Connections </span> </a> </li> <li class="md-nav__item"> <a href="#cable-mapping" class="md-nav__link"> <span class="md-ellipsis"> Cable Mapping </span> </a> </li> <li class="md-nav__item"> <a href="#wan-connections" class="md-nav__link"> <span class="md-ellipsis"> WAN Connections </span> </a> </li> <li class="md-nav__item"> <a href="#client-devices" class="md-nav__link"> <span class="md-ellipsis"> Client Devices </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#base-configuration" class="md-nav__link"> <span class="md-ellipsis"> Base Configuration </span> </a> <nav class="md-nav" aria-label="Base Configuration"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#install-required-packages" class="md-nav__link"> <span class="md-ellipsis"> Install Required Packages </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#node-specific-configurations" class="md-nav__link"> <span class="md-ellipsis"> Node-Specific Configurations </span> </a> <nav class="md-nav" aria-label="Node-Specific Configurations"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#node-1-configuration-1011121" class="md-nav__link"> <span class="md-ellipsis"> Node 1 Configuration (10.11.12.1) </span> </a> </li> <li class="md-nav__item"> <a href="#node-2-configuration-1011122" class="md-nav__link"> <span class="md-ellipsis"> Node 2 Configuration (10.11.12.2) </span> </a> </li> <li class="md-nav__item"> <a href="#node-3-configuration-1011123" class="md-nav__link"> <span class="md-ellipsis"> Node 3 Configuration (10.11.12.3) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#vlan-configuration" class="md-nav__link"> <span class="md-ellipsis"> VLAN Configuration </span> </a> <nav class="md-nav" aria-label="VLAN Configuration"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#enable-vlan-support" class="md-nav__link"> <span class="md-ellipsis"> Enable VLAN Support </span> </a> </li> <li class="md-nav__item"> <a href="#add-vlan-aware-wifi-interfaces" class="md-nav__link"> <span class="md-ellipsis"> Add VLAN-Aware WiFi Interfaces </span> </a> </li> <li class="md-nav__item"> <a href="#configure-vlan-firewall-rules" class="md-nav__link"> <span class="md-ellipsis"> Configure VLAN Firewall Rules </span> </a> </li> <li class="md-nav__item"> <a href="#enable-dhcp-for-vlans" class="md-nav__link"> <span class="md-ellipsis"> Enable DHCP for VLANs </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#testing-verification" class="md-nav__link"> <span class="md-ellipsis"> Testing &amp; Verification </span> </a> <nav class="md-nav" aria-label="Testing &amp; Verification"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#initial-connectivity-tests" class="md-nav__link"> <span class="md-ellipsis"> Initial Connectivity Tests </span> </a> </li> <li class="md-nav__item"> <a href="#failover-testing" class="md-nav__link"> <span class="md-ellipsis"> Failover Testing </span> </a> </li> <li class="md-nav__item"> <a href="#performance-testing" class="md-nav__link"> <span class="md-ellipsis"> Performance Testing </span> </a> </li> <li class="md-nav__item"> <a href="#vlan-testing-if-configured" class="md-nav__link"> <span class="md-ellipsis"> VLAN Testing (if configured) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#monitoring-maintenance" class="md-nav__link"> <span class="md-ellipsis"> Monitoring &amp; Maintenance </span> </a> <nav class="md-nav" aria-label="Monitoring &amp; Maintenance"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#create-monitoring-script" class="md-nav__link"> <span class="md-ellipsis"> Create Monitoring Script </span> </a> </li> <li class="md-nav__item"> <a href="#continuous-monitoring" class="md-nav__link"> <span class="md-ellipsis"> Continuous Monitoring </span> </a> </li> <li class="md-nav__item"> <a href="#key-metrics-to-monitor" class="md-nav__link"> <span class="md-ellipsis"> Key Metrics to Monitor </span> </a> </li> <li class="md-nav__item"> <a href="#log-monitoring" class="md-nav__link"> <span class="md-ellipsis"> Log Monitoring </span> </a> </li> <li class="md-nav__item"> <a href="#performance-monitoring" class="md-nav__link"> <span class="md-ellipsis"> Performance Monitoring </span> </a> </li> <li class="md-nav__item"> <a href="#scheduled-monitoring-optional" class="md-nav__link"> <span class="md-ellipsis"> Scheduled Monitoring (Optional) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#troubleshooting" class="md-nav__link"> <span class="md-ellipsis"> Troubleshooting </span> </a> <nav class="md-nav" aria-label="Troubleshooting"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#issue-batman-interface-not-active" class="md-nav__link"> <span class="md-ellipsis"> Issue: Batman Interface Not Active </span> </a> </li> <li class="md-nav__item"> <a href="#issue-mesh-peers-not-connecting" class="md-nav__link"> <span class="md-ellipsis"> Issue: Mesh Peers Not Connecting </span> </a> </li> <li class="md-nav__item"> <a href="#issue-low-tq-values-on-wired-links" class="md-nav__link"> <span class="md-ellipsis"> Issue: Low TQ Values on Wired Links </span> </a> </li> <li class="md-nav__item"> <a href="#issue-gateway-not-switching-on-failover" class="md-nav__link"> <span class="md-ellipsis"> Issue: Gateway Not Switching on Failover </span> </a> </li> <li class="md-nav__item"> <a href="#issue-clients-cant-get-dhcp" class="md-nav__link"> <span class="md-ellipsis"> Issue: Clients Can't Get DHCP </span> </a> </li> <li class="md-nav__item"> <a href="#issue-wired-client-cant-connect" class="md-nav__link"> <span class="md-ellipsis"> Issue: Wired Client Can't Connect </span> </a> </li> <li class="md-nav__item"> <a href="#issue-client-gets-ip-but-no-internet" class="md-nav__link"> <span class="md-ellipsis"> Issue: Client Gets IP But No Internet </span> </a> </li> <li class="md-nav__item"> <a href="#issue-client-connectivity-lost-during-failover" class="md-nav__link"> <span class="md-ellipsis"> Issue: Client Connectivity Lost During Failover </span> </a> </li> <li class="md-nav__item"> <a href="#issue-slow-performance-on-wired-client" class="md-nav__link"> <span class="md-ellipsis"> Issue: Slow Performance on Wired Client </span> </a> </li> <li class="md-nav__item"> <a href="#issue-high-latency-or-packet-loss" class="md-nav__link"> <span class="md-ellipsis"> Issue: High Latency or Packet Loss </span> </a> </li> <li class="md-nav__item"> <a href="#issue-vlan-traffic-not-working" class="md-nav__link"> <span class="md-ellipsis"> Issue: VLAN Traffic Not Working </span> </a> </li> <li class="md-nav__item"> <a href="#issue-frequent-gateway-switching" class="md-nav__link"> <span class="md-ellipsis"> Issue: Frequent Gateway Switching </span> </a> </li> <li class="md-nav__item"> <a href="#issue-poor-wireless-performance" class="md-nav__link"> <span class="md-ellipsis"> Issue: Poor Wireless Performance </span> </a> </li> <li class="md-nav__item"> <a href="#issue-configuration-not-persisting" class="md-nav__link"> <span class="md-ellipsis"> Issue: Configuration Not Persisting </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#advanced-tuning" class="md-nav__link"> <span class="md-ellipsis"> Advanced Tuning </span> </a> <nav class="md-nav" aria-label="Advanced Tuning"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#batman-adv-algorithm-selection" class="md-nav__link"> <span class="md-ellipsis"> Batman-adv Algorithm Selection </span> </a> </li> <li class="md-nav__item"> <a href="#optimize-for-different-scenarios" class="md-nav__link"> <span class="md-ellipsis"> Optimize for Different Scenarios </span> </a> </li> <li class="md-nav__item"> <a href="#qos-over-mesh" class="md-nav__link"> <span class="md-ellipsis"> QoS Over Mesh </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#backup-recovery" class="md-nav__link"> <span class="md-ellipsis"> Backup &amp; Recovery </span> </a> <nav class="md-nav" aria-label="Backup &amp; Recovery"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#backup-configuration" class="md-nav__link"> <span class="md-ellipsis"> Backup Configuration </span> </a> </li> <li class="md-nav__item"> <a href="#restore-configuration" class="md-nav__link"> <span class="md-ellipsis"> Restore Configuration </span> </a> </li> <li class="md-nav__item"> <a href="#configuration-version-control" class="md-nav__link"> <span class="md-ellipsis"> Configuration Version Control </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#security-considerations" class="md-nav__link"> <span class="md-ellipsis"> Security Considerations </span> </a> <nav class="md-nav" aria-label="Security Considerations"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#mesh-security" class="md-nav__link"> <span class="md-ellipsis"> Mesh Security </span> </a> </li> <li class="md-nav__item"> <a href="#network-segmentation" class="md-nav__link"> <span class="md-ellipsis"> Network Segmentation </span> </a> </li> <li class="md-nav__item"> <a href="#monitoring-for-security" class="md-nav__link"> <span class="md-ellipsis"> Monitoring for Security </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#performance-expectations" class="md-nav__link"> <span class="md-ellipsis"> Performance Expectations </span> </a> <nav class="md-nav" aria-label="Performance Expectations"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#throughput-benchmarks" class="md-nav__link"> <span class="md-ellipsis"> Throughput Benchmarks </span> </a> </li> <li class="md-nav__item"> <a href="#latency-benchmarks" class="md-nav__link"> <span class="md-ellipsis"> Latency Benchmarks </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#maintenance-schedule" class="md-nav__link"> <span class="md-ellipsis"> Maintenance Schedule </span> </a> <nav class="md-nav" aria-label="Maintenance Schedule"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#daily" class="md-nav__link"> <span class="md-ellipsis"> Daily </span> </a> </li> <li class="md-nav__item"> <a href="#weekly" class="md-nav__link"> <span class="md-ellipsis"> Weekly </span> </a> </li> <li class="md-nav__item"> <a href="#monthly" class="md-nav__link"> <span class="md-ellipsis"> Monthly </span> </a> </li> <li class="md-nav__item"> <a href="#quarterly" class="md-nav__link"> <span class="md-ellipsis"> Quarterly </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#additional-resources" class="md-nav__link"> <span class="md-ellipsis"> Additional Resources </span> </a> <nav class="md-nav" aria-label="Additional Resources"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#openwrt-documentation" class="md-nav__link"> <span class="md-ellipsis"> OpenWrt Documentation </span> </a> </li> <li class="md-nav__item"> <a href="#batman-adv-project" class="md-nav__link"> <span class="md-ellipsis"> Batman-adv Project </span> </a> </li> <li class="md-nav__item"> <a href="#community-resources" class="md-nav__link"> <span class="md-ellipsis"> Community Resources </span> </a> </li> <li class="md-nav__item"> <a href="#tools" class="md-nav__link"> <span class="md-ellipsis"> Tools </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#quick-reference-guide" class="md-nav__link"> <span class="md-ellipsis"> Quick Reference Guide </span> </a> <nav class="md-nav" aria-label="Quick Reference Guide"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#common-client-connection-scenarios" class="md-nav__link"> <span class="md-ellipsis"> Common Client Connection Scenarios </span> </a> </li> <li class="md-nav__item"> <a href="#common-monitoring-commands" class="md-nav__link"> <span class="md-ellipsis"> Common Monitoring Commands </span> </a> </li> <li class="md-nav__item"> <a href="#emergency-procedures" class="md-nav__link"> <span class="md-ellipsis"> Emergency Procedures </span> </a> </li> <li class="md-nav__item"> <a href="#port-cheat-sheet" class="md-nav__link"> <span class="md-ellipsis"> Port Cheat Sheet </span> </a> </li> <li class="md-nav__item"> <a href="#ip-address-allocation" class="md-nav__link"> <span class="md-ellipsis"> IP Address Allocation </span> </a> </li> <li class="md-nav__item"> <a href="#important-files" class="md-nav__link"> <span class="md-ellipsis"> Important Files </span> </a> </li> <li class="md-nav__item"> <a href="#getting-help" class="md-nav__link"> <span class="md-ellipsis"> Getting Help </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a href="#conclusion" class="md-nav__link"> <span class="md-ellipsis"> Conclusion </span> </a> <nav class="md-nav" aria-label="Conclusion"> <ul class="md-nav__list"> <li class="md-nav__item"> <a href="#next-steps" class="md-nav__link"> <span class="md-ellipsis"> Next Steps </span> </a> </li> <li class="md-nav__item"> <a href="#support" class="md-nav__link"> <span class="md-ellipsis"> Support </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset"> <a href="https://github.com/git-kubik/mesh/edit/main/docs/openwrt-batman-mesh-setup.md" title="Edit this page" class="md-content__button md-icon" rel="edit"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"></path></svg> </a> <a href="https://github.com/git-kubik/mesh/raw/main/docs/openwrt-batman-mesh-setup.md" title="View source of this page" class="md-content__button md-icon"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"></path></svg> </a> <h1 id="openwrt-multi-gateway-batman-adv-mesh-network">OpenWrt Multi-Gateway Batman-adv Mesh Network<a class="headerlink" href="#openwrt-multi-gateway-batman-adv-mesh-network" title="Permanent link"></a></h1> <h2 id="full-ring-topology-with-vlan-support">Full Ring Topology with VLAN Support<a class="headerlink" href="#full-ring-topology-with-vlan-support" title="Permanent link"></a></h2> <h3 id="network-design-overview">Network Design Overview<a class="headerlink" href="#network-design-overview" title="Permanent link"></a></h3> <p><strong>Topology:</strong> Full wired ring with 2.4GHz wireless backup <strong>Network:</strong> 10.11.12.0/24 <strong>Devices:</strong> 3x D-Link DIR-1960 A1</p> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../images/mesh-topology-overview.svg" data-desc-position="bottom"><img alt="Mesh Topology Overview" src="../images/mesh-topology-overview.svg"></a></p> <h3 id="detailed-port-layout">Detailed Port Layout<a class="headerlink" href="#detailed-port-layout" title="Permanent link"></a></h3> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../images/mesh-port-layout.svg" data-desc-position="bottom"><img alt="Mesh Network Port Layout" src="../images/mesh-port-layout.svg"></a></p> <p><strong>Port Configuration:</strong></p> <ul> <li><strong>WAN (Blue)</strong>: ISP connection for internet access</li> <li><strong>LAN1-LAN2 (Green)</strong>: Client device connections</li> <li><strong>LAN3-LAN4 (Yellow)</strong>: Mesh network connections to other nodes</li> <li><strong>2.4GHz Wireless</strong>: Mesh backup (invisible to clients)</li> <li><strong>5GHz Wireless</strong>: Client access point with unified SSID</li> </ul> <h3 id="client-connection-points">Client Connection Points<a class="headerlink" href="#client-connection-points" title="Permanent link"></a></h3> <p><strong>Wired Clients:</strong></p> <ul> <li>LAN1 and LAN2 on each node (6 total ports available)</li> <li>All ports bridged to mesh network</li> <li>DHCP from Node1, gateway selection automatic</li> </ul> <p><strong>Wireless Clients:</strong></p> <ul> <li>5GHz unified SSID: "HA-Network-5G"</li> <li>Seamless roaming between nodes (802.11r)</li> <li>Same network as wired clients (10.11.12.0/24)</li> </ul> <p><strong>Features:</strong></p> <ul> <li>Multi-gateway HA (all 3 nodes with independent WAN)</li> <li>Wired ring primary path</li> <li>2.4GHz wireless automatic failover</li> <li>5GHz client AP (unified SSID with 802.11r roaming)</li> <li>Wired client ports on every node (lan1, lan2)</li> <li>VLAN support over batman-adv mesh</li> <li>Automatic gateway selection and failover</li> </ul> <hr> <h2 id="port-allocation-and-client-connectivity">Port Allocation and Client Connectivity<a class="headerlink" href="#port-allocation-and-client-connectivity" title="Permanent link"></a></h2> <h3 id="per-node-port-usage">Per-Node Port Usage<a class="headerlink" href="#per-node-port-usage" title="Permanent link"></a></h3> <p>Each DIR-1960 has 1 WAN port and 4 LAN ports. Here's how they're allocated:</p> <table> <thead> <tr> <th>Port</th> <th>Purpose</th> <th>Connected To</th> <th>Notes</th> </tr> </thead> <tbody> <tr> <td>WAN</td> <td>Internet uplink</td> <td>Your ISP modem/router</td> <td>Independent per node</td> </tr> <tr> <td>LAN1</td> <td><strong>Client devices</strong></td> <td>Workstations, servers, etc.</td> <td>Bridged to mesh</td> </tr> <tr> <td>LAN2</td> <td><strong>Client devices</strong></td> <td>Workstations, servers, etc.</td> <td>Bridged to mesh</td> </tr> <tr> <td>LAN3</td> <td>Mesh ring</td> <td>Another node's LAN3</td> <td>Dedicated mesh</td> </tr> <tr> <td>LAN4</td> <td>Mesh ring</td> <td>Another node's LAN4</td> <td>Dedicated mesh</td> </tr> </tbody> </table> <h3 id="wired-client-connectivity">Wired Client Connectivity<a class="headerlink" href="#wired-client-connectivity" title="Permanent link"></a></h3> <p><strong>You can connect workstations/devices to LAN1 or LAN2 on ANY node:</strong></p> <div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Workstation  Node2 LAN1  br-lan bridge  bat0 mesh
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>                                                  
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>                                          Routes to all nodes
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>                                          Gets DHCP from Node1
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>                                          Internet via best gateway
</span></code></pre></div> <p><strong>Key points:</strong></p> <ul> <li><strong>2 client ports per node</strong> (LAN1, LAN2)</li> <li><strong>6 total wired clients</strong> across 3-node mesh (2 per node)</li> <li>All clients on same 10.11.12.0/24 network</li> <li>DHCP provided by Node 1 (via mesh)</li> <li>Automatic gateway selection</li> <li>If local node loses WAN, traffic routes through mesh to another gateway</li> </ul> <h3 id="client-connection-examples">Client Connection Examples<a class="headerlink" href="#client-connection-examples" title="Permanent link"></a></h3> <h4 id="example-1-workstation-on-node-2">Example 1: Workstation on Node 2<a class="headerlink" href="#example-1-workstation-on-node-2" title="Permanent link"></a></h4> <div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>Your PC  Node2 LAN1
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>              
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>         Gets: 10.11.12.105 (DHCP from Node1 via mesh)
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>         Gateway: 10.11.12.1
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>         DNS: 1.1.1.1, 8.8.8.8
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>         Internet: Via Node2's WAN (if available) or via mesh to Node1/Node3
</span></code></pre></div> <h4 id="example-2-multiple-workstations">Example 2: Multiple Workstations<a class="headerlink" href="#example-2-multiple-workstations" title="Permanent link"></a></h4> <div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>Node1 LAN1  Management Workstation (10.11.12.10 - static)
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>Node1 LAN2  Gigabit Switch  Server 1
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>                                Server 2
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>                                NAS
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>Node2 LAN1  Desktop PC
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>Node2 LAN2  Available
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>Node3 LAN1  Laptop
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>Node3 LAN2  Available
</span></code></pre></div> <h4 id="example-3-node-failure-scenario">Example 3: Node Failure Scenario<a class="headerlink" href="#example-3-node-failure-scenario" title="Permanent link"></a></h4> <div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>Initial state:
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>  Desktop PC  Node2 LAN1  Internet via Node2 WAN
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>Node2 fails (power loss):
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>  Desktop PC loses connection until moved
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>Move cable to Node3:
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>  Desktop PC  Node3 LAN1  Keeps same IP (10.11.12.105)
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>                            Internet via Node3 WAN
</span></code></pre></div> <h4 id="example-4-wan-failure-not-node-failure">Example 4: WAN Failure, Not Node Failure<a class="headerlink" href="#example-4-wan-failure-not-node-failure" title="Permanent link"></a></h4> <div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>Initial state:
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>  Desktop PC  Node2 LAN1  Internet via Node2 WAN
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>Node2's WAN fails:
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>  Desktop PC  Node2 LAN1  bat0 mesh  Node1 or Node3 WAN
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>                            Automatically reroutes!
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>                            PC stays connected, minimal disruption
</span></code></pre></div> <h3 id="expanding-wired-ports">Expanding Wired Ports<a class="headerlink" href="#expanding-wired-ports" title="Permanent link"></a></h3> <p><strong>Option 1: Add Unmanaged Switch (Simplest)</strong></p> <div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>Node1 LAN1  Gigabit Switch  Device 1
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>                                Device 2
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>                                Device 3
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>                                Device 4
</span></code></pre></div> <ul> <li>Cheap and simple</li> <li>All devices on main LAN (10.11.12.0/24)</li> <li>No configuration needed</li> </ul> <p><strong>Option 2: Managed Switch with VLANs (Advanced)</strong></p> <div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>Node1 LAN1  Managed Switch  VLAN 10 devices (Management)
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>                                VLAN 20 devices (Trusted)
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>                                VLAN 30 devices (Guest)
</span></code></pre></div> <ul> <li>Requires VLAN configuration (see VLAN section)</li> <li>Better security and segregation</li> <li>More complex setup</li> </ul> <p><strong>Option 3: Sacrifice Ring Redundancy (Not Recommended)</strong></p> <ul> <li>Use only LAN3 for mesh (linear topology)</li> <li>Free up LAN4 for client use (3 client ports per node)</li> <li>Lose one wired path redundancy</li> <li>Only consider if you desperately need more ports</li> </ul> <h3 id="static-ip-reservations">Static IP Reservations<a class="headerlink" href="#static-ip-reservations" title="Permanent link"></a></h3> <p>For servers or management workstations, add to Node 1's <code>/etc/config/dhcp</code>:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>config<span class="w"> </span>host
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'admin-workstation'</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span>option<span class="w"> </span>mac<span class="w"> </span><span class="s1">'AA:BB:CC:DD:EE:FF'</span><span class="w">  </span><span class="c1"># Workstation's MAC address</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span>option<span class="w"> </span>ip<span class="w"> </span><span class="s1">'10.11.12.10'</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>config<span class="w"> </span>host
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'file-server'</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">    </span>option<span class="w"> </span>mac<span class="w"> </span><span class="s1">'11:22:33:44:55:66'</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">    </span>option<span class="w"> </span>ip<span class="w"> </span><span class="s1">'10.11.12.20'</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>config<span class="w"> </span>host
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">    </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'nas'</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">    </span>option<span class="w"> </span>mac<span class="w"> </span><span class="s1">'77:88:99:AA:BB:CC'</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">    </span>option<span class="w"> </span>ip<span class="w"> </span><span class="s1">'10.11.12.30'</span>
</span></code></pre></div> <p>Benefits:</p> <ul> <li>Consistent IP addresses</li> <li>Easy to remember/document</li> <li>Works regardless of which node device connects to</li> </ul> <h3 id="performance-considerations">Performance Considerations<a class="headerlink" href="#performance-considerations" title="Permanent link"></a></h3> <p><strong>Best case (local WAN available):</strong></p> <div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>Workstation  Node LAN1  Local WAN
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>Latency: &lt;2ms to internet
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>Throughput: Full WAN speed
</span></code></pre></div> <p><strong>Mesh routing case (local WAN down):</strong></p> <div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>Workstation  Node LAN1  bat0  Ring  Other Node  WAN
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>Latency: +2-5ms overhead
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>Throughput: Limited by mesh (400-900 Mbps wired, 50-200 Mbps wireless)
</span></code></pre></div> <p>For maximum performance:</p> <ul> <li>Connect high-bandwidth devices to the node with the fastest WAN</li> <li>Use wired mesh paths (keep all ring cables connected)</li> <li>Consider static gateway assignment if needed</li> </ul> <h3 id="verifying-client-connectivity">Verifying Client Connectivity<a class="headerlink" href="#verifying-client-connectivity" title="Permanent link"></a></h3> <p>After connecting a workstation to any LAN1/LAN2:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># From the workstation</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="c1"># Check IP assignment</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>ip<span class="w"> </span>addr<span class="w"> </span>show<span class="w"> </span>eth0<span class="w">  </span><span class="c1"># or your interface name</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="c1"># Should show: 10.11.12.x</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="c1"># Check gateway</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>ip<span class="w"> </span>route<span class="w"> </span>show
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="c1"># Should show: default via 10.11.12.1</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="c1"># Test connectivity to all nodes</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">10</span>.11.12.1
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">10</span>.11.12.2
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">10</span>.11.12.3
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="c1"># Test internet</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">1</span>.1.1.1
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">3</span><span class="w"> </span>google.com
</span></code></pre></div> <hr> <h2 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link"></a></h2> <ol> <li><a href="#prerequisites">Prerequisites</a></li> <li><a href="#hardware-preparation">Hardware Preparation</a></li> <li><a href="#initial-openwrt-installation">Initial OpenWrt Installation</a></li> <li><a href="#physical-wiring">Physical Wiring</a></li> <li><a href="#base-configuration">Base Configuration</a></li> <li><a href="#node-specific-configurations">Node-Specific Configurations</a></li> <li><a href="#vlan-configuration">VLAN Configuration</a></li> <li><a href="#testing--verification">Testing &amp; Verification</a></li> <li><a href="#monitoring--maintenance">Monitoring &amp; Maintenance</a></li> <li><a href="#troubleshooting">Troubleshooting</a></li> </ol> <hr> <h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link"></a></h2> <h3 id="required-hardware">Required Hardware<a class="headerlink" href="#required-hardware" title="Permanent link"></a></h3> <ul> <li>3x D-Link DIR-1960 A1 routers</li> <li>3x Ethernet cables (ring interconnects)</li> <li>3x Independent internet connections</li> <li>1x Computer with Ethernet port for initial setup</li> </ul> <h3 id="required-softwarepackages">Required Software/Packages<a class="headerlink" href="#required-softwarepackages" title="Permanent link"></a></h3> <ul> <li>OpenWrt 24.10.4 or later</li> <li>Packages to install on each node:</li> <li><code>kmod-batman-adv</code> - Batman kernel module</li> <li><code>batctl</code> - Batman control utility</li> <li><code>wpad-mesh-mbedtls</code> or <code>wpad-mesh-wolfssl</code> - Mesh WiFi support</li> <li><code>ip-full</code> - Enhanced IP utilities</li> <li><code>tcpdump-mini</code> - Network debugging (optional but recommended)</li> </ul> <h3 id="network-planning">Network Planning<a class="headerlink" href="#network-planning" title="Permanent link"></a></h3> <table> <thead> <tr> <th>Node</th> <th>IP Address</th> <th>WAN Port</th> <th>Mesh Ports</th> <th>Role</th> </tr> </thead> <tbody> <tr> <td>Node1</td> <td>10.11.12.1</td> <td>wan</td> <td>lan3Node2, lan4Node3</td> <td>Gateway + DHCP Server</td> </tr> <tr> <td>Node2</td> <td>10.11.12.2</td> <td>wan</td> <td>lan3Node1, lan4Node3</td> <td>Gateway</td> </tr> <tr> <td>Node3</td> <td>10.11.12.3</td> <td>wan</td> <td>lan3Node2, lan4Node1</td> <td>Gateway</td> </tr> </tbody> </table> <p><strong>Port Usage:</strong></p> <ul> <li><code>wan</code> - Internet uplink</li> <li><code>lan1, lan2</code> - Client devices (bridged to mesh)</li> <li><code>lan3, lan4</code> - Mesh ring interconnects</li> <li><code>radio0</code> (2.4GHz) - Wireless mesh backup</li> <li><code>radio1</code> (5GHz) - Client AP</li> </ul> <hr> <h2 id="hardware-preparation">Hardware Preparation<a class="headerlink" href="#hardware-preparation" title="Permanent link"></a></h2> <h3 id="1-label-your-routers">1. Label Your Routers<a class="headerlink" href="#1-label-your-routers" title="Permanent link"></a></h3> <p>Physically label each router as Node1, Node2, Node3 to avoid confusion during setup.</p> <h3 id="2-verify-hardware-revision">2. Verify Hardware Revision<a class="headerlink" href="#2-verify-hardware-revision" title="Permanent link"></a></h3> <p>Ensure you have DIR-1960 <strong>A1</strong> revision. Check the label on the bottom of the router.</p> <h3 id="3-backup-original-firmware-optional">3. Backup Original Firmware (Optional)<a class="headerlink" href="#3-backup-original-firmware-optional" title="Permanent link"></a></h3> <p>If you want to revert to stock firmware later, backup using the emergency recovery console before flashing OpenWrt.</p> <hr> <h2 id="initial-openwrt-installation">Initial OpenWrt Installation<a class="headerlink" href="#initial-openwrt-installation" title="Permanent link"></a></h2> <h3 id="download-firmware">Download Firmware<a class="headerlink" href="#download-firmware" title="Permanent link"></a></h3> <p>Visit OpenWrt firmware selector: <a href="https://firmware-selector.openwrt.org/">https://firmware-selector.openwrt.org/</a></p> <p>Search for: <code>D-Link DIR-1960 A1</code></p> <p>Download:</p> <ul> <li><strong>Factory image</strong> (for initial flash from stock firmware)</li> <li><strong>Sysupgrade image</strong> (for future updates)</li> </ul> <h3 id="flash-process-per-router">Flash Process (Per Router)<a class="headerlink" href="#flash-process-per-router" title="Permanent link"></a></h3> <ol> <li><strong>Enter Recovery Mode:</strong></li> <li>Disconnect power from router</li> <li>Press and hold RESET button</li> <li>While holding RESET, connect power</li> <li>Continue holding until Power LED starts flashing (orange) - about 10 seconds</li> <li> <p>Release RESET button</p> </li> <li> <p><strong>Configure Computer:</strong></p> </li> <li>Connect computer to LAN1 port</li> <li> <p>Set static IP on computer:</p> <ul> <li>IP: <code>192.168.0.2</code></li> <li>Netmask: <code>255.255.255.0</code></li> <li>Gateway: <code>192.168.0.1</code></li> </ul> </li> <li> <p><strong>Access Recovery Interface:</strong></p> </li> <li>Open browser to: <code>http://192.168.0.1</code></li> <li> <p>You should see D-Link Emergency Recovery page</p> </li> <li> <p><strong>Upload Firmware:</strong></p> </li> <li>Browse and select the OpenWrt <strong>factory</strong> image</li> <li>Click "Upload"</li> <li>Wait 3-5 minutes for flash and reboot</li> <li> <p>Do NOT interrupt power during this process</p> </li> <li> <p><strong>Verify Installation:</strong></p> </li> <li>After reboot, browse to <code>http://192.168.1.1</code></li> <li>You should see OpenWrt LuCI interface</li> <li> <p>Default: no password set</p> </li> <li> <p><strong>Set Root Password:</strong> </p> </li> <li>SSH to router: <code>ssh root@192.168.1.1</code> (no password initially)</li> <li>Set password: <code>passwd</code> </li> <li> <p>Or via LuCI: System  Administration  Router Password</p> </li> <li> <p><strong>Update Package Lists:</strong></p> </li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>opkg<span class="w"> </span>update
</span></code></pre></div> <p><strong>Repeat for all three routers before proceeding.</strong></p> <hr> <h2 id="physical-wiring">Physical Wiring<a class="headerlink" href="#physical-wiring" title="Permanent link"></a></h2> <h3 id="ring-topology-connections">Ring Topology Connections<a class="headerlink" href="#ring-topology-connections" title="Permanent link"></a></h3> <p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../images/mesh-ring-wiring.svg" data-desc-position="bottom"><img alt="Mesh Ring Topology Wiring" src="../images/mesh-ring-wiring.svg"></a></p> <p><strong>Physical Connections:</strong></p> <ul> <li>Node1 lan3  Node2 lan3</li> <li>Node2 lan4  Node3 lan3</li> <li>Node3 lan4  Node1 lan4</li> </ul> <h3 id="cable-mapping">Cable Mapping<a class="headerlink" href="#cable-mapping" title="Permanent link"></a></h3> <table> <thead> <tr> <th>Connection</th> <th>Cable</th> </tr> </thead> <tbody> <tr> <td>Node1 lan3 to Node2 lan3</td> <td>Cable A</td> </tr> <tr> <td>Node2 lan4 to Node3 lan3</td> <td>Cable B</td> </tr> <tr> <td>Node3 lan4 to Node1 lan4</td> <td>Cable C</td> </tr> </tbody> </table> <h3 id="wan-connections">WAN Connections<a class="headerlink" href="#wan-connections" title="Permanent link"></a></h3> <p>Each node's WAN port connects to its independent internet connection (different cables, ideally different ISPs).</p> <h3 id="client-devices">Client Devices<a class="headerlink" href="#client-devices" title="Permanent link"></a></h3> <ul> <li>Can connect via Ethernet to lan1 or lan2 on any node</li> <li>Can connect via WiFi to the unified 5GHz AP</li> </ul> <hr> <h2 id="base-configuration">Base Configuration<a class="headerlink" href="#base-configuration" title="Permanent link"></a></h2> <p>These files are common across all nodes with only IP addresses changing.</p> <h3 id="install-required-packages">Install Required Packages<a class="headerlink" href="#install-required-packages" title="Permanent link"></a></h3> <p>SSH to each router and run:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># Remove conflicting package first</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>opkg<span class="w"> </span>remove<span class="w"> </span>wpad-basic-mbedtls
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="c1"># Install required packages</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>opkg<span class="w"> </span>update
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>opkg<span class="w"> </span>install<span class="w"> </span>kmod-batman-adv<span class="w"> </span>batctl<span class="w"> </span>wpad-mesh-mbedtls<span class="w"> </span>ip-full<span class="w"> </span>tcpdump-mini
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="c1"># Reboot to load batman kernel module</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>reboot
</span></code></pre></div> <p>Verify batman module loaded:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>lsmod<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>batman
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="c1"># Should show: batman_adv</span>
</span></code></pre></div> <hr> <h2 id="node-specific-configurations">Node-Specific Configurations<a class="headerlink" href="#node-specific-configurations" title="Permanent link"></a></h2> <h3 id="node-1-configuration-1011121">Node 1 Configuration (10.11.12.1)<a class="headerlink" href="#node-1-configuration-1011121" title="Permanent link"></a></h3> <h4 id="etcconfignetwork">/etc/config/network<a class="headerlink" href="#etcconfignetwork" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>config<span class="w"> </span>interface<span class="w"> </span><span class="s1">'loopback'</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w"> </span>option<span class="w"> </span>device<span class="w"> </span><span class="s1">'lo'</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'static'</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w"> </span>option<span class="w"> </span>ipaddr<span class="w"> </span><span class="s1">'127.0.0.1'</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w"> </span>option<span class="w"> </span>netmask<span class="w"> </span><span class="s1">'255.0.0.0'</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>config<span class="w"> </span>globals<span class="w"> </span><span class="s1">'globals'</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w"> </span>option<span class="w"> </span>ula_prefix<span class="w"> </span><span class="s1">'fd12:3456:789a::/48'</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="c1"># WAN Interface</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>config<span class="w"> </span>interface<span class="w"> </span><span class="s1">'wan'</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w"> </span>option<span class="w"> </span>device<span class="w"> </span><span class="s1">'wan'</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'dhcp'</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w"> </span>option<span class="w"> </span>peerdns<span class="w"> </span><span class="s1">'0'</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w"> </span>option<span class="w"> </span>dns<span class="w"> </span><span class="s1">'1.1.1.1 8.8.8.8'</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>config<span class="w"> </span>interface<span class="w"> </span><span class="s1">'wan6'</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w"> </span>option<span class="w"> </span>device<span class="w"> </span><span class="s1">'wan'</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'dhcpv6'</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="c1"># Batman-adv Main Interface</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>config<span class="w"> </span>interface<span class="w"> </span><span class="s1">'bat0'</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'batadv'</span>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="w"> </span>option<span class="w"> </span>routing_algo<span class="w"> </span><span class="s1">'BATMAN_V'</span>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a><span class="w"> </span>option<span class="w"> </span>gw_mode<span class="w"> </span><span class="s1">'server'</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a><span class="w"> </span>option<span class="w"> </span>gw_bandwidth<span class="w"> </span><span class="s1">'100000/100000'</span>
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="w"> </span>option<span class="w"> </span>distributed_arp_table<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="w"> </span>option<span class="w"> </span>bridge_loop_avoidance<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="w"> </span>option<span class="w"> </span>multicast_mode<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a><span class="w"> </span>option<span class="w"> </span>fragmentation<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a><span class="w"> </span>option<span class="w"> </span>hop_penalty<span class="w"> </span><span class="s1">'15'</span>
</span><span id="__span-14-32"><a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a><span class="w"> </span>option<span class="w"> </span>orig_interval<span class="w"> </span><span class="s1">'1000'</span>
</span><span id="__span-14-33"><a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a>
</span><span id="__span-14-34"><a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a><span class="c1"># Wired mesh interface - lan3 to Node2</span>
</span><span id="__span-14-35"><a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a>config<span class="w"> </span>interface<span class="w"> </span><span class="s1">'bat0_hardif_lan3'</span>
</span><span id="__span-14-36"><a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'batadv_hardif'</span>
</span><span id="__span-14-37"><a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a><span class="w"> </span>option<span class="w"> </span>master<span class="w"> </span><span class="s1">'bat0'</span>
</span><span id="__span-14-38"><a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a><span class="w"> </span>option<span class="w"> </span>mtu<span class="w"> </span><span class="s1">'1560'</span>
</span><span id="__span-14-39"><a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a>
</span><span id="__span-14-40"><a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a><span class="c1"># Wired mesh interface - lan4 to Node3</span>
</span><span id="__span-14-41"><a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a>config<span class="w"> </span>interface<span class="w"> </span><span class="s1">'bat0_hardif_lan4'</span>
</span><span id="__span-14-42"><a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'batadv_hardif'</span>
</span><span id="__span-14-43"><a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a><span class="w"> </span>option<span class="w"> </span>master<span class="w"> </span><span class="s1">'bat0'</span>
</span><span id="__span-14-44"><a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a><span class="w"> </span>option<span class="w"> </span>mtu<span class="w"> </span><span class="s1">'1560'</span>
</span><span id="__span-14-45"><a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a>
</span><span id="__span-14-46"><a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a><span class="c1"># Wireless mesh interface - 2.4GHz backup</span>
</span><span id="__span-14-47"><a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a>config<span class="w"> </span>interface<span class="w"> </span><span class="s1">'bat0_hardif_mesh0'</span>
</span><span id="__span-14-48"><a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'batadv_hardif'</span>
</span><span id="__span-14-49"><a id="__codelineno-14-49" name="__codelineno-14-49" href="#__codelineno-14-49"></a><span class="w"> </span>option<span class="w"> </span>master<span class="w"> </span><span class="s1">'bat0'</span>
</span><span id="__span-14-50"><a id="__codelineno-14-50" name="__codelineno-14-50" href="#__codelineno-14-50"></a><span class="w"> </span>option<span class="w"> </span>mtu<span class="w"> </span><span class="s1">'1532'</span>
</span><span id="__span-14-51"><a id="__codelineno-14-51" name="__codelineno-14-51" href="#__codelineno-14-51"></a>
</span><span id="__span-14-52"><a id="__codelineno-14-52" name="__codelineno-14-52" href="#__codelineno-14-52"></a><span class="c1"># Physical device for mesh ports</span>
</span><span id="__span-14-53"><a id="__codelineno-14-53" name="__codelineno-14-53" href="#__codelineno-14-53"></a>config<span class="w"> </span>device<span class="w"> </span><span class="s1">'lan3'</span>
</span><span id="__span-14-54"><a id="__codelineno-14-54" name="__codelineno-14-54" href="#__codelineno-14-54"></a><span class="w"> </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'lan3'</span>
</span><span id="__span-14-55"><a id="__codelineno-14-55" name="__codelineno-14-55" href="#__codelineno-14-55"></a><span class="w"> </span>option<span class="w"> </span>mtu<span class="w"> </span><span class="s1">'1560'</span>
</span><span id="__span-14-56"><a id="__codelineno-14-56" name="__codelineno-14-56" href="#__codelineno-14-56"></a>
</span><span id="__span-14-57"><a id="__codelineno-14-57" name="__codelineno-14-57" href="#__codelineno-14-57"></a>config<span class="w"> </span>device<span class="w"> </span><span class="s1">'lan4'</span>
</span><span id="__span-14-58"><a id="__codelineno-14-58" name="__codelineno-14-58" href="#__codelineno-14-58"></a><span class="w"> </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'lan4'</span>
</span><span id="__span-14-59"><a id="__codelineno-14-59" name="__codelineno-14-59" href="#__codelineno-14-59"></a><span class="w"> </span>option<span class="w"> </span>mtu<span class="w"> </span><span class="s1">'1560'</span>
</span><span id="__span-14-60"><a id="__codelineno-14-60" name="__codelineno-14-60" href="#__codelineno-14-60"></a>
</span><span id="__span-14-61"><a id="__codelineno-14-61" name="__codelineno-14-61" href="#__codelineno-14-61"></a><span class="c1"># LAN Bridge</span>
</span><span id="__span-14-62"><a id="__codelineno-14-62" name="__codelineno-14-62" href="#__codelineno-14-62"></a>config<span class="w"> </span>device<span class="w"> </span><span class="s1">'br_lan'</span>
</span><span id="__span-14-63"><a id="__codelineno-14-63" name="__codelineno-14-63" href="#__codelineno-14-63"></a><span class="w"> </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'br-lan'</span>
</span><span id="__span-14-64"><a id="__codelineno-14-64" name="__codelineno-14-64" href="#__codelineno-14-64"></a><span class="w"> </span>option<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="s1">'bridge'</span>
</span><span id="__span-14-65"><a id="__codelineno-14-65" name="__codelineno-14-65" href="#__codelineno-14-65"></a><span class="w"> </span>list<span class="w"> </span>ports<span class="w"> </span><span class="s1">'bat0'</span>
</span><span id="__span-14-66"><a id="__codelineno-14-66" name="__codelineno-14-66" href="#__codelineno-14-66"></a><span class="w"> </span>list<span class="w"> </span>ports<span class="w"> </span><span class="s1">'lan1'</span>
</span><span id="__span-14-67"><a id="__codelineno-14-67" name="__codelineno-14-67" href="#__codelineno-14-67"></a><span class="w"> </span>list<span class="w"> </span>ports<span class="w"> </span><span class="s1">'lan2'</span>
</span><span id="__span-14-68"><a id="__codelineno-14-68" name="__codelineno-14-68" href="#__codelineno-14-68"></a><span class="w"> </span><span class="c1"># Note: lan3 and lan4 NOT in bridge - dedicated to mesh</span>
</span><span id="__span-14-69"><a id="__codelineno-14-69" name="__codelineno-14-69" href="#__codelineno-14-69"></a>
</span><span id="__span-14-70"><a id="__codelineno-14-70" name="__codelineno-14-70" href="#__codelineno-14-70"></a>config<span class="w"> </span>interface<span class="w"> </span><span class="s1">'lan'</span>
</span><span id="__span-14-71"><a id="__codelineno-14-71" name="__codelineno-14-71" href="#__codelineno-14-71"></a><span class="w"> </span>option<span class="w"> </span>device<span class="w"> </span><span class="s1">'br-lan'</span>
</span><span id="__span-14-72"><a id="__codelineno-14-72" name="__codelineno-14-72" href="#__codelineno-14-72"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'static'</span>
</span><span id="__span-14-73"><a id="__codelineno-14-73" name="__codelineno-14-73" href="#__codelineno-14-73"></a><span class="w"> </span>option<span class="w"> </span>ipaddr<span class="w"> </span><span class="s1">'10.11.12.1'</span>
</span><span id="__span-14-74"><a id="__codelineno-14-74" name="__codelineno-14-74" href="#__codelineno-14-74"></a><span class="w"> </span>option<span class="w"> </span>netmask<span class="w"> </span><span class="s1">'255.255.255.0'</span>
</span><span id="__span-14-75"><a id="__codelineno-14-75" name="__codelineno-14-75" href="#__codelineno-14-75"></a><span class="w"> </span>option<span class="w"> </span>ip6assign<span class="w"> </span><span class="s1">'60'</span>
</span><span id="__span-14-76"><a id="__codelineno-14-76" name="__codelineno-14-76" href="#__codelineno-14-76"></a>
</span><span id="__span-14-77"><a id="__codelineno-14-77" name="__codelineno-14-77" href="#__codelineno-14-77"></a><span class="c1"># IMPORTANT: The br-lan bridge connects:</span>
</span><span id="__span-14-78"><a id="__codelineno-14-78" name="__codelineno-14-78" href="#__codelineno-14-78"></a><span class="c1">#   - bat0 (batman mesh)</span>
</span><span id="__span-14-79"><a id="__codelineno-14-79" name="__codelineno-14-79" href="#__codelineno-14-79"></a><span class="c1">#   - lan1 (client devices)</span>
</span><span id="__span-14-80"><a id="__codelineno-14-80" name="__codelineno-14-80" href="#__codelineno-14-80"></a><span class="c1">#   - lan2 (client devices)</span>
</span><span id="__span-14-81"><a id="__codelineno-14-81" name="__codelineno-14-81" href="#__codelineno-14-81"></a><span class="c1"># This allows workstations on lan1/lan2 to access the mesh network</span>
</span><span id="__span-14-82"><a id="__codelineno-14-82" name="__codelineno-14-82" href="#__codelineno-14-82"></a><span class="c1"># and get DHCP, internet, and connectivity to all mesh nodes.</span>
</span></code></pre></div> <h4 id="etcconfigwireless">/etc/config/wireless<a class="headerlink" href="#etcconfigwireless" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>config<span class="w"> </span>wifi-device<span class="w"> </span><span class="s1">'radio0'</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w"> </span>option<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="s1">'mac80211'</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w"> </span>option<span class="w"> </span>path<span class="w"> </span><span class="s1">'platform/soc/1e140000.pcie/pci0000:00/0000:00:01.0/0000:01:00.0'</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w"> </span>option<span class="w"> </span>channel<span class="w"> </span><span class="s1">'6'</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w"> </span>option<span class="w"> </span>band<span class="w"> </span><span class="s1">'2g'</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w"> </span>option<span class="w"> </span>htmode<span class="w"> </span><span class="s1">'HT40'</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w"> </span>option<span class="w"> </span>country<span class="w"> </span><span class="s1">'AU'</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w"> </span>option<span class="w"> </span>cell_density<span class="w"> </span><span class="s1">'0'</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="c1"># 2.4GHz Mesh Backup</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>config<span class="w"> </span>wifi-iface<span class="w"> </span><span class="s1">'mesh0'</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w"> </span>option<span class="w"> </span>device<span class="w"> </span><span class="s1">'radio0'</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w"> </span>option<span class="w"> </span>mode<span class="w"> </span><span class="s1">'mesh'</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w"> </span>option<span class="w"> </span>network<span class="w"> </span><span class="s1">'bat0_hardif_mesh0'</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w"> </span>option<span class="w"> </span>mesh_id<span class="w"> </span><span class="s1">'ha-mesh-net'</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w"> </span>option<span class="w"> </span>mesh_fwding<span class="w"> </span><span class="s1">'0'</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w"> </span>option<span class="w"> </span>mesh_ttl<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w"> </span>option<span class="w"> </span>encryption<span class="w"> </span><span class="s1">'sae'</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w"> </span>option<span class="w"> </span>key<span class="w"> </span><span class="s1">'YourSecureMeshPassword123!'</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w"> </span>option<span class="w"> </span>mcast_rate<span class="w"> </span><span class="s1">'24000'</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>config<span class="w"> </span>wifi-device<span class="w"> </span><span class="s1">'radio1'</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w"> </span>option<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="s1">'mac80211'</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="w"> </span>option<span class="w"> </span>path<span class="w"> </span><span class="s1">'platform/soc/1e140000.pcie/pci0000:00/0000:00:00.0/0000:00:00.0'</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="w"> </span>option<span class="w"> </span>channel<span class="w"> </span><span class="s1">'36'</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w"> </span>option<span class="w"> </span>band<span class="w"> </span><span class="s1">'5g'</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="w"> </span>option<span class="w"> </span>htmode<span class="w"> </span><span class="s1">'VHT80'</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w"> </span>option<span class="w"> </span>country<span class="w"> </span><span class="s1">'AU'</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="w"> </span>option<span class="w"> </span>cell_density<span class="w"> </span><span class="s1">'0'</span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a>
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="c1"># 5GHz Client AP</span>
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a>config<span class="w"> </span>wifi-iface<span class="w"> </span><span class="s1">'wlan0'</span>
</span><span id="__span-15-33"><a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a><span class="w"> </span>option<span class="w"> </span>device<span class="w"> </span><span class="s1">'radio1'</span>
</span><span id="__span-15-34"><a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="w"> </span>option<span class="w"> </span>mode<span class="w"> </span><span class="s1">'ap'</span>
</span><span id="__span-15-35"><a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a><span class="w"> </span>option<span class="w"> </span>network<span class="w"> </span><span class="s1">'lan'</span>
</span><span id="__span-15-36"><a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a><span class="w"> </span>option<span class="w"> </span>ssid<span class="w"> </span><span class="s1">'HA-Network-5G'</span>
</span><span id="__span-15-37"><a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a><span class="w"> </span>option<span class="w"> </span>encryption<span class="w"> </span><span class="s1">'psk2+ccmp'</span>
</span><span id="__span-15-38"><a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a><span class="w"> </span>option<span class="w"> </span>key<span class="w"> </span><span class="s1">'YourClientPassword123!'</span>
</span><span id="__span-15-39"><a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a><span class="w"> </span>option<span class="w"> </span>ieee80211r<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-15-40"><a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a><span class="w"> </span>option<span class="w"> </span>mobility_domain<span class="w"> </span><span class="s1">'a1b2'</span>
</span><span id="__span-15-41"><a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a><span class="w"> </span>option<span class="w"> </span>ft_over_ds<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-15-42"><a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a><span class="w"> </span>option<span class="w"> </span>ft_psk_generate_local<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-15-43"><a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a><span class="w"> </span>option<span class="w"> </span>rsn_preauth<span class="w"> </span><span class="s1">'1'</span>
</span></code></pre></div> <h4 id="etcconfigdhcp">/etc/config/dhcp<a class="headerlink" href="#etcconfigdhcp" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>config<span class="w"> </span>dnsmasq
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w"> </span>option<span class="w"> </span>domainneeded<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w"> </span>option<span class="w"> </span>boguspriv<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w"> </span>option<span class="w"> </span>filterwin2k<span class="w"> </span><span class="s1">'0'</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w"> </span>option<span class="w"> </span>localise_queries<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w"> </span>option<span class="w"> </span>rebind_protection<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w"> </span>option<span class="w"> </span>rebind_localhost<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w"> </span>option<span class="w"> </span><span class="nb">local</span><span class="w"> </span><span class="s1">'/lan/'</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w"> </span>option<span class="w"> </span>domain<span class="w"> </span><span class="s1">'lan'</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w"> </span>option<span class="w"> </span>expandhosts<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w"> </span>option<span class="w"> </span>nonegcache<span class="w"> </span><span class="s1">'0'</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w"> </span>option<span class="w"> </span>cachesize<span class="w"> </span><span class="s1">'1000'</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w"> </span>option<span class="w"> </span>authoritative<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="w"> </span>option<span class="w"> </span>readethers<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="w"> </span>option<span class="w"> </span>leasefile<span class="w"> </span><span class="s1">'/tmp/dhcp.leases'</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="w"> </span>option<span class="w"> </span>resolvfile<span class="w"> </span><span class="s1">'/tmp/resolv.conf.d/resolv.conf.auto'</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="w"> </span>option<span class="w"> </span>nonwildcard<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="w"> </span>option<span class="w"> </span>localservice<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="w"> </span>option<span class="w"> </span>ednspacket_max<span class="w"> </span><span class="s1">'1232'</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>config<span class="w"> </span>dhcp<span class="w"> </span><span class="s1">'lan'</span>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="w"> </span>option<span class="w"> </span>interface<span class="w"> </span><span class="s1">'lan'</span>
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="w"> </span>option<span class="w"> </span>start<span class="w"> </span><span class="s1">'100'</span>
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="w"> </span>option<span class="w"> </span>limit<span class="w"> </span><span class="s1">'150'</span>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a><span class="w"> </span>option<span class="w"> </span>leasetime<span class="w"> </span><span class="s1">'12h'</span>
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a><span class="w"> </span>option<span class="w"> </span>dhcpv4<span class="w"> </span><span class="s1">'server'</span>
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="w"> </span>option<span class="w"> </span>dhcpv6<span class="w"> </span><span class="s1">'server'</span>
</span><span id="__span-16-28"><a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="w"> </span>option<span class="w"> </span>ra<span class="w"> </span><span class="s1">'server'</span>
</span><span id="__span-16-29"><a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a><span class="w"> </span>list<span class="w"> </span>ra_flags<span class="w"> </span><span class="s1">'managed-config'</span>
</span><span id="__span-16-30"><a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a><span class="w"> </span>list<span class="w"> </span>ra_flags<span class="w"> </span><span class="s1">'other-config'</span>
</span><span id="__span-16-31"><a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a>
</span><span id="__span-16-32"><a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a>config<span class="w"> </span>dhcp<span class="w"> </span><span class="s1">'wan'</span>
</span><span id="__span-16-33"><a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a><span class="w"> </span>option<span class="w"> </span>interface<span class="w"> </span><span class="s1">'wan'</span>
</span><span id="__span-16-34"><a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a><span class="w"> </span>option<span class="w"> </span>ignore<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-16-35"><a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a>
</span><span id="__span-16-36"><a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a>config<span class="w"> </span>odhcpd<span class="w"> </span><span class="s1">'odhcpd'</span>
</span><span id="__span-16-37"><a id="__codelineno-16-37" name="__codelineno-16-37" href="#__codelineno-16-37"></a><span class="w"> </span>option<span class="w"> </span>maindhcp<span class="w"> </span><span class="s1">'0'</span>
</span><span id="__span-16-38"><a id="__codelineno-16-38" name="__codelineno-16-38" href="#__codelineno-16-38"></a><span class="w"> </span>option<span class="w"> </span>leasefile<span class="w"> </span><span class="s1">'/tmp/hosts/odhcpd'</span>
</span><span id="__span-16-39"><a id="__codelineno-16-39" name="__codelineno-16-39" href="#__codelineno-16-39"></a><span class="w"> </span>option<span class="w"> </span>leasetrigger<span class="w"> </span><span class="s1">'/usr/sbin/odhcpd-update'</span>
</span><span id="__span-16-40"><a id="__codelineno-16-40" name="__codelineno-16-40" href="#__codelineno-16-40"></a><span class="w"> </span>option<span class="w"> </span>loglevel<span class="w"> </span><span class="s1">'4'</span>
</span></code></pre></div> <h4 id="etcconfigfirewall">/etc/config/firewall<a class="headerlink" href="#etcconfigfirewall" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>config<span class="w"> </span>defaults
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w"> </span>option<span class="w"> </span>input<span class="w"> </span><span class="s1">'REJECT'</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w"> </span>option<span class="w"> </span>output<span class="w"> </span><span class="s1">'ACCEPT'</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w"> </span>option<span class="w"> </span>forward<span class="w"> </span><span class="s1">'REJECT'</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w"> </span>option<span class="w"> </span>synflood_protect<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>config<span class="w"> </span>zone
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w"> </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'lan'</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w"> </span>list<span class="w"> </span>network<span class="w"> </span><span class="s1">'lan'</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w"> </span>option<span class="w"> </span>input<span class="w"> </span><span class="s1">'ACCEPT'</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w"> </span>option<span class="w"> </span>output<span class="w"> </span><span class="s1">'ACCEPT'</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w"> </span>option<span class="w"> </span>forward<span class="w"> </span><span class="s1">'ACCEPT'</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>config<span class="w"> </span>zone
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="w"> </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'wan'</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="w"> </span>list<span class="w"> </span>network<span class="w"> </span><span class="s1">'wan'</span>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="w"> </span>list<span class="w"> </span>network<span class="w"> </span><span class="s1">'wan6'</span>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="w"> </span>option<span class="w"> </span>input<span class="w"> </span><span class="s1">'REJECT'</span>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="w"> </span>option<span class="w"> </span>output<span class="w"> </span><span class="s1">'ACCEPT'</span>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="w"> </span>option<span class="w"> </span>forward<span class="w"> </span><span class="s1">'REJECT'</span>
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="w"> </span>option<span class="w"> </span>masq<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="w"> </span>option<span class="w"> </span>mtu_fix<span class="w"> </span><span class="s1">'1'</span>
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a>config<span class="w"> </span>forwarding
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="w"> </span>option<span class="w"> </span>src<span class="w"> </span><span class="s1">'lan'</span>
</span><span id="__span-17-26"><a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="w"> </span>option<span class="w"> </span>dest<span class="w"> </span><span class="s1">'wan'</span>
</span><span id="__span-17-27"><a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a>
</span><span id="__span-17-28"><a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="c1"># Allow ICMP</span>
</span><span id="__span-17-29"><a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a>config<span class="w"> </span>rule
</span><span id="__span-17-30"><a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="w"> </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'Allow-DHCP-Renew'</span>
</span><span id="__span-17-31"><a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="w"> </span>option<span class="w"> </span>src<span class="w"> </span><span class="s1">'wan'</span>
</span><span id="__span-17-32"><a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'udp'</span>
</span><span id="__span-17-33"><a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a><span class="w"> </span>option<span class="w"> </span>dest_port<span class="w"> </span><span class="s1">'68'</span>
</span><span id="__span-17-34"><a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a><span class="w"> </span>option<span class="w"> </span>target<span class="w"> </span><span class="s1">'ACCEPT'</span>
</span><span id="__span-17-35"><a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a><span class="w"> </span>option<span class="w"> </span>family<span class="w"> </span><span class="s1">'ipv4'</span>
</span><span id="__span-17-36"><a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a>
</span><span id="__span-17-37"><a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a>config<span class="w"> </span>rule
</span><span id="__span-17-38"><a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a><span class="w"> </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'Allow-Ping'</span>
</span><span id="__span-17-39"><a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a><span class="w"> </span>option<span class="w"> </span>src<span class="w"> </span><span class="s1">'wan'</span>
</span><span id="__span-17-40"><a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'icmp'</span>
</span><span id="__span-17-41"><a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a><span class="w"> </span>option<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'echo-request'</span>
</span><span id="__span-17-42"><a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a><span class="w"> </span>option<span class="w"> </span>family<span class="w"> </span><span class="s1">'ipv4'</span>
</span><span id="__span-17-43"><a id="__codelineno-17-43" name="__codelineno-17-43" href="#__codelineno-17-43"></a><span class="w"> </span>option<span class="w"> </span>target<span class="w"> </span><span class="s1">'ACCEPT'</span>
</span><span id="__span-17-44"><a id="__codelineno-17-44" name="__codelineno-17-44" href="#__codelineno-17-44"></a>
</span><span id="__span-17-45"><a id="__codelineno-17-45" name="__codelineno-17-45" href="#__codelineno-17-45"></a>config<span class="w"> </span>rule
</span><span id="__span-17-46"><a id="__codelineno-17-46" name="__codelineno-17-46" href="#__codelineno-17-46"></a><span class="w"> </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'Allow-IGMP'</span>
</span><span id="__span-17-47"><a id="__codelineno-17-47" name="__codelineno-17-47" href="#__codelineno-17-47"></a><span class="w"> </span>option<span class="w"> </span>src<span class="w"> </span><span class="s1">'wan'</span>
</span><span id="__span-17-48"><a id="__codelineno-17-48" name="__codelineno-17-48" href="#__codelineno-17-48"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'igmp'</span>
</span><span id="__span-17-49"><a id="__codelineno-17-49" name="__codelineno-17-49" href="#__codelineno-17-49"></a><span class="w"> </span>option<span class="w"> </span>family<span class="w"> </span><span class="s1">'ipv4'</span>
</span><span id="__span-17-50"><a id="__codelineno-17-50" name="__codelineno-17-50" href="#__codelineno-17-50"></a><span class="w"> </span>option<span class="w"> </span>target<span class="w"> </span><span class="s1">'ACCEPT'</span>
</span><span id="__span-17-51"><a id="__codelineno-17-51" name="__codelineno-17-51" href="#__codelineno-17-51"></a>
</span><span id="__span-17-52"><a id="__codelineno-17-52" name="__codelineno-17-52" href="#__codelineno-17-52"></a>config<span class="w"> </span>rule
</span><span id="__span-17-53"><a id="__codelineno-17-53" name="__codelineno-17-53" href="#__codelineno-17-53"></a><span class="w"> </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'Allow-DHCPv6'</span>
</span><span id="__span-17-54"><a id="__codelineno-17-54" name="__codelineno-17-54" href="#__codelineno-17-54"></a><span class="w"> </span>option<span class="w"> </span>src<span class="w"> </span><span class="s1">'wan'</span>
</span><span id="__span-17-55"><a id="__codelineno-17-55" name="__codelineno-17-55" href="#__codelineno-17-55"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'udp'</span>
</span><span id="__span-17-56"><a id="__codelineno-17-56" name="__codelineno-17-56" href="#__codelineno-17-56"></a><span class="w"> </span>option<span class="w"> </span>dest_port<span class="w"> </span><span class="s1">'546'</span>
</span><span id="__span-17-57"><a id="__codelineno-17-57" name="__codelineno-17-57" href="#__codelineno-17-57"></a><span class="w"> </span>option<span class="w"> </span>family<span class="w"> </span><span class="s1">'ipv6'</span>
</span><span id="__span-17-58"><a id="__codelineno-17-58" name="__codelineno-17-58" href="#__codelineno-17-58"></a><span class="w"> </span>option<span class="w"> </span>target<span class="w"> </span><span class="s1">'ACCEPT'</span>
</span><span id="__span-17-59"><a id="__codelineno-17-59" name="__codelineno-17-59" href="#__codelineno-17-59"></a>
</span><span id="__span-17-60"><a id="__codelineno-17-60" name="__codelineno-17-60" href="#__codelineno-17-60"></a>config<span class="w"> </span>rule
</span><span id="__span-17-61"><a id="__codelineno-17-61" name="__codelineno-17-61" href="#__codelineno-17-61"></a><span class="w"> </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'Allow-MLD'</span>
</span><span id="__span-17-62"><a id="__codelineno-17-62" name="__codelineno-17-62" href="#__codelineno-17-62"></a><span class="w"> </span>option<span class="w"> </span>src<span class="w"> </span><span class="s1">'wan'</span>
</span><span id="__span-17-63"><a id="__codelineno-17-63" name="__codelineno-17-63" href="#__codelineno-17-63"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'icmp'</span>
</span><span id="__span-17-64"><a id="__codelineno-17-64" name="__codelineno-17-64" href="#__codelineno-17-64"></a><span class="w"> </span>option<span class="w"> </span>src_ip<span class="w"> </span><span class="s1">'fe80::/10'</span>
</span><span id="__span-17-65"><a id="__codelineno-17-65" name="__codelineno-17-65" href="#__codelineno-17-65"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'130/0'</span>
</span><span id="__span-17-66"><a id="__codelineno-17-66" name="__codelineno-17-66" href="#__codelineno-17-66"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'131/0'</span>
</span><span id="__span-17-67"><a id="__codelineno-17-67" name="__codelineno-17-67" href="#__codelineno-17-67"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'132/0'</span>
</span><span id="__span-17-68"><a id="__codelineno-17-68" name="__codelineno-17-68" href="#__codelineno-17-68"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'143/0'</span>
</span><span id="__span-17-69"><a id="__codelineno-17-69" name="__codelineno-17-69" href="#__codelineno-17-69"></a><span class="w"> </span>option<span class="w"> </span>family<span class="w"> </span><span class="s1">'ipv6'</span>
</span><span id="__span-17-70"><a id="__codelineno-17-70" name="__codelineno-17-70" href="#__codelineno-17-70"></a><span class="w"> </span>option<span class="w"> </span>target<span class="w"> </span><span class="s1">'ACCEPT'</span>
</span><span id="__span-17-71"><a id="__codelineno-17-71" name="__codelineno-17-71" href="#__codelineno-17-71"></a>
</span><span id="__span-17-72"><a id="__codelineno-17-72" name="__codelineno-17-72" href="#__codelineno-17-72"></a>config<span class="w"> </span>rule
</span><span id="__span-17-73"><a id="__codelineno-17-73" name="__codelineno-17-73" href="#__codelineno-17-73"></a><span class="w"> </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'Allow-ICMPv6-Input'</span>
</span><span id="__span-17-74"><a id="__codelineno-17-74" name="__codelineno-17-74" href="#__codelineno-17-74"></a><span class="w"> </span>option<span class="w"> </span>src<span class="w"> </span><span class="s1">'wan'</span>
</span><span id="__span-17-75"><a id="__codelineno-17-75" name="__codelineno-17-75" href="#__codelineno-17-75"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'icmp'</span>
</span><span id="__span-17-76"><a id="__codelineno-17-76" name="__codelineno-17-76" href="#__codelineno-17-76"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'echo-request'</span>
</span><span id="__span-17-77"><a id="__codelineno-17-77" name="__codelineno-17-77" href="#__codelineno-17-77"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'echo-reply'</span>
</span><span id="__span-17-78"><a id="__codelineno-17-78" name="__codelineno-17-78" href="#__codelineno-17-78"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'destination-unreachable'</span>
</span><span id="__span-17-79"><a id="__codelineno-17-79" name="__codelineno-17-79" href="#__codelineno-17-79"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'packet-too-big'</span>
</span><span id="__span-17-80"><a id="__codelineno-17-80" name="__codelineno-17-80" href="#__codelineno-17-80"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'time-exceeded'</span>
</span><span id="__span-17-81"><a id="__codelineno-17-81" name="__codelineno-17-81" href="#__codelineno-17-81"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'bad-header'</span>
</span><span id="__span-17-82"><a id="__codelineno-17-82" name="__codelineno-17-82" href="#__codelineno-17-82"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'unknown-header-type'</span>
</span><span id="__span-17-83"><a id="__codelineno-17-83" name="__codelineno-17-83" href="#__codelineno-17-83"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'router-solicitation'</span>
</span><span id="__span-17-84"><a id="__codelineno-17-84" name="__codelineno-17-84" href="#__codelineno-17-84"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'neighbour-solicitation'</span>
</span><span id="__span-17-85"><a id="__codelineno-17-85" name="__codelineno-17-85" href="#__codelineno-17-85"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'router-advertisement'</span>
</span><span id="__span-17-86"><a id="__codelineno-17-86" name="__codelineno-17-86" href="#__codelineno-17-86"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'neighbour-advertisement'</span>
</span><span id="__span-17-87"><a id="__codelineno-17-87" name="__codelineno-17-87" href="#__codelineno-17-87"></a><span class="w"> </span>option<span class="w"> </span>limit<span class="w"> </span><span class="s1">'1000/sec'</span>
</span><span id="__span-17-88"><a id="__codelineno-17-88" name="__codelineno-17-88" href="#__codelineno-17-88"></a><span class="w"> </span>option<span class="w"> </span>family<span class="w"> </span><span class="s1">'ipv6'</span>
</span><span id="__span-17-89"><a id="__codelineno-17-89" name="__codelineno-17-89" href="#__codelineno-17-89"></a><span class="w"> </span>option<span class="w"> </span>target<span class="w"> </span><span class="s1">'ACCEPT'</span>
</span><span id="__span-17-90"><a id="__codelineno-17-90" name="__codelineno-17-90" href="#__codelineno-17-90"></a>
</span><span id="__span-17-91"><a id="__codelineno-17-91" name="__codelineno-17-91" href="#__codelineno-17-91"></a>config<span class="w"> </span>rule
</span><span id="__span-17-92"><a id="__codelineno-17-92" name="__codelineno-17-92" href="#__codelineno-17-92"></a><span class="w"> </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'Allow-ICMPv6-Forward'</span>
</span><span id="__span-17-93"><a id="__codelineno-17-93" name="__codelineno-17-93" href="#__codelineno-17-93"></a><span class="w"> </span>option<span class="w"> </span>src<span class="w"> </span><span class="s1">'wan'</span>
</span><span id="__span-17-94"><a id="__codelineno-17-94" name="__codelineno-17-94" href="#__codelineno-17-94"></a><span class="w"> </span>option<span class="w"> </span>dest<span class="w"> </span><span class="s1">'*'</span>
</span><span id="__span-17-95"><a id="__codelineno-17-95" name="__codelineno-17-95" href="#__codelineno-17-95"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'icmp'</span>
</span><span id="__span-17-96"><a id="__codelineno-17-96" name="__codelineno-17-96" href="#__codelineno-17-96"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'echo-request'</span>
</span><span id="__span-17-97"><a id="__codelineno-17-97" name="__codelineno-17-97" href="#__codelineno-17-97"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'echo-reply'</span>
</span><span id="__span-17-98"><a id="__codelineno-17-98" name="__codelineno-17-98" href="#__codelineno-17-98"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'destination-unreachable'</span>
</span><span id="__span-17-99"><a id="__codelineno-17-99" name="__codelineno-17-99" href="#__codelineno-17-99"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'packet-too-big'</span>
</span><span id="__span-17-100"><a id="__codelineno-17-100" name="__codelineno-17-100" href="#__codelineno-17-100"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'time-exceeded'</span>
</span><span id="__span-17-101"><a id="__codelineno-17-101" name="__codelineno-17-101" href="#__codelineno-17-101"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'bad-header'</span>
</span><span id="__span-17-102"><a id="__codelineno-17-102" name="__codelineno-17-102" href="#__codelineno-17-102"></a><span class="w"> </span>list<span class="w"> </span>icmp_type<span class="w"> </span><span class="s1">'unknown-header-type'</span>
</span><span id="__span-17-103"><a id="__codelineno-17-103" name="__codelineno-17-103" href="#__codelineno-17-103"></a><span class="w"> </span>option<span class="w"> </span>limit<span class="w"> </span><span class="s1">'1000/sec'</span>
</span><span id="__span-17-104"><a id="__codelineno-17-104" name="__codelineno-17-104" href="#__codelineno-17-104"></a><span class="w"> </span>option<span class="w"> </span>family<span class="w"> </span><span class="s1">'ipv6'</span>
</span><span id="__span-17-105"><a id="__codelineno-17-105" name="__codelineno-17-105" href="#__codelineno-17-105"></a><span class="w"> </span>option<span class="w"> </span>target<span class="w"> </span><span class="s1">'ACCEPT'</span>
</span><span id="__span-17-106"><a id="__codelineno-17-106" name="__codelineno-17-106" href="#__codelineno-17-106"></a>
</span><span id="__span-17-107"><a id="__codelineno-17-107" name="__codelineno-17-107" href="#__codelineno-17-107"></a>config<span class="w"> </span>rule
</span><span id="__span-17-108"><a id="__codelineno-17-108" name="__codelineno-17-108" href="#__codelineno-17-108"></a><span class="w"> </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'Allow-IPSec-ESP'</span>
</span><span id="__span-17-109"><a id="__codelineno-17-109" name="__codelineno-17-109" href="#__codelineno-17-109"></a><span class="w"> </span>option<span class="w"> </span>src<span class="w"> </span><span class="s1">'wan'</span>
</span><span id="__span-17-110"><a id="__codelineno-17-110" name="__codelineno-17-110" href="#__codelineno-17-110"></a><span class="w"> </span>option<span class="w"> </span>dest<span class="w"> </span><span class="s1">'lan'</span>
</span><span id="__span-17-111"><a id="__codelineno-17-111" name="__codelineno-17-111" href="#__codelineno-17-111"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'esp'</span>
</span><span id="__span-17-112"><a id="__codelineno-17-112" name="__codelineno-17-112" href="#__codelineno-17-112"></a><span class="w"> </span>option<span class="w"> </span>target<span class="w"> </span><span class="s1">'ACCEPT'</span>
</span><span id="__span-17-113"><a id="__codelineno-17-113" name="__codelineno-17-113" href="#__codelineno-17-113"></a>
</span><span id="__span-17-114"><a id="__codelineno-17-114" name="__codelineno-17-114" href="#__codelineno-17-114"></a>config<span class="w"> </span>rule
</span><span id="__span-17-115"><a id="__codelineno-17-115" name="__codelineno-17-115" href="#__codelineno-17-115"></a><span class="w"> </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'Allow-ISAKMP'</span>
</span><span id="__span-17-116"><a id="__codelineno-17-116" name="__codelineno-17-116" href="#__codelineno-17-116"></a><span class="w"> </span>option<span class="w"> </span>src<span class="w"> </span><span class="s1">'wan'</span>
</span><span id="__span-17-117"><a id="__codelineno-17-117" name="__codelineno-17-117" href="#__codelineno-17-117"></a><span class="w"> </span>option<span class="w"> </span>dest<span class="w"> </span><span class="s1">'lan'</span>
</span><span id="__span-17-118"><a id="__codelineno-17-118" name="__codelineno-17-118" href="#__codelineno-17-118"></a><span class="w"> </span>option<span class="w"> </span>dest_port<span class="w"> </span><span class="s1">'500'</span>
</span><span id="__span-17-119"><a id="__codelineno-17-119" name="__codelineno-17-119" href="#__codelineno-17-119"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'udp'</span>
</span><span id="__span-17-120"><a id="__codelineno-17-120" name="__codelineno-17-120" href="#__codelineno-17-120"></a><span class="w"> </span>option<span class="w"> </span>target<span class="w"> </span><span class="s1">'ACCEPT'</span>
</span></code></pre></div> <hr> <h3 id="node-2-configuration-1011122">Node 2 Configuration (10.11.12.2)<a class="headerlink" href="#node-2-configuration-1011122" title="Permanent link"></a></h3> <p><strong>Changes from Node 1:</strong></p> <h4 id="etcconfignetwork_1">/etc/config/network<a class="headerlink" href="#etcconfignetwork_1" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># Change only these lines:</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>config<span class="w"> </span>interface<span class="w"> </span><span class="s1">'lan'</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w"> </span>option<span class="w"> </span>device<span class="w"> </span><span class="s1">'br-lan'</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'static'</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w"> </span>option<span class="w"> </span>ipaddr<span class="w"> </span><span class="s1">'10.11.12.2'</span><span class="w">  </span><span class="c1"># Changed</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w"> </span>option<span class="w"> </span>netmask<span class="w"> </span><span class="s1">'255.255.255.0'</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w"> </span>option<span class="w"> </span>ip6assign<span class="w"> </span><span class="s1">'60'</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w"> </span>option<span class="w"> </span>gateway<span class="w"> </span><span class="s1">'10.11.12.1'</span><span class="w">  </span><span class="c1"># Add this</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w"> </span>list<span class="w"> </span>dns<span class="w"> </span><span class="s1">'10.11.12.1'</span><span class="w">        </span><span class="c1"># Add this</span>
</span></code></pre></div> <h4 id="etcconfigdhcp_1">/etc/config/dhcp<a class="headerlink" href="#etcconfigdhcp_1" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># Disable DHCP server on Node 2</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>config<span class="w"> </span>dhcp<span class="w"> </span><span class="s1">'lan'</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w"> </span>option<span class="w"> </span>interface<span class="w"> </span><span class="s1">'lan'</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w"> </span>option<span class="w"> </span>ignore<span class="w"> </span><span class="s1">'1'</span><span class="w">  </span><span class="c1"># Changed to disable DHCP</span>
</span></code></pre></div> <p><strong>All other configuration files remain identical to Node 1.</strong></p> <hr> <h3 id="node-3-configuration-1011123">Node 3 Configuration (10.11.12.3)<a class="headerlink" href="#node-3-configuration-1011123" title="Permanent link"></a></h3> <p><strong>Changes from Node 1:</strong></p> <h4 id="etcconfignetwork_2">/etc/config/network<a class="headerlink" href="#etcconfignetwork_2" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># Change only these lines:</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>config<span class="w"> </span>interface<span class="w"> </span><span class="s1">'lan'</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w"> </span>option<span class="w"> </span>device<span class="w"> </span><span class="s1">'br-lan'</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'static'</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w"> </span>option<span class="w"> </span>ipaddr<span class="w"> </span><span class="s1">'10.11.12.3'</span><span class="w">  </span><span class="c1"># Changed</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w"> </span>option<span class="w"> </span>netmask<span class="w"> </span><span class="s1">'255.255.255.0'</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w"> </span>option<span class="w"> </span>ip6assign<span class="w"> </span><span class="s1">'60'</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w"> </span>option<span class="w"> </span>gateway<span class="w"> </span><span class="s1">'10.11.12.1'</span><span class="w">  </span><span class="c1"># Add this</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w"> </span>list<span class="w"> </span>dns<span class="w"> </span><span class="s1">'10.11.12.1'</span><span class="w">        </span><span class="c1"># Add this</span>
</span></code></pre></div> <h4 id="etcconfigdhcp_2">/etc/config/dhcp<a class="headerlink" href="#etcconfigdhcp_2" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># Disable DHCP server on Node 3</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>config<span class="w"> </span>dhcp<span class="w"> </span><span class="s1">'lan'</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w"> </span>option<span class="w"> </span>interface<span class="w"> </span><span class="s1">'lan'</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w"> </span>option<span class="w"> </span>ignore<span class="w"> </span><span class="s1">'1'</span><span class="w">  </span><span class="c1"># Changed to disable DHCP</span>
</span></code></pre></div> <p><strong>All other configuration files remain identical to Node 1.</strong></p> <hr> <h2 id="vlan-configuration">VLAN Configuration<a class="headerlink" href="#vlan-configuration" title="Permanent link"></a></h2> <p>Batman-adv supports VLANs for network segmentation over the mesh. Common use cases:</p> <ul> <li>VLAN 10: Management</li> <li>VLAN 20: Trusted clients</li> <li>VLAN 30: Guest network</li> <li>VLAN 40: IoT devices</li> </ul> <h3 id="enable-vlan-support">Enable VLAN Support<a class="headerlink" href="#enable-vlan-support" title="Permanent link"></a></h3> <p>Add to each node's <code>/etc/config/network</code>:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># VLAN 10 - Management (example)</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>config<span class="w"> </span>interface<span class="w"> </span><span class="s1">'mgmt'</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'batadv_vlan'</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w"> </span>option<span class="w"> </span>master<span class="w"> </span><span class="s1">'bat0'</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w"> </span>option<span class="w"> </span>vid<span class="w"> </span><span class="s1">'10'</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w"> </span>option<span class="w"> </span>ap_isolation<span class="w"> </span><span class="s1">'0'</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>config<span class="w"> </span>interface<span class="w"> </span><span class="s1">'mgmt_bridge'</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'static'</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="w"> </span>option<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="s1">'bridge'</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w"> </span>list<span class="w"> </span>ports<span class="w"> </span><span class="s1">'mgmt'</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="w"> </span>option<span class="w"> </span>ipaddr<span class="w"> </span><span class="s1">'10.11.10.1'</span><span class="w">  </span><span class="c1"># Different subnet</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w"> </span>option<span class="w"> </span>netmask<span class="w"> </span><span class="s1">'255.255.255.0'</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="c1"># VLAN 20 - Trusted Clients (example)</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>config<span class="w"> </span>interface<span class="w"> </span><span class="s1">'trusted'</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'batadv_vlan'</span>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="w"> </span>option<span class="w"> </span>master<span class="w"> </span><span class="s1">'bat0'</span>
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="w"> </span>option<span class="w"> </span>vid<span class="w"> </span><span class="s1">'20'</span>
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a><span class="w"> </span>option<span class="w"> </span>ap_isolation<span class="w"> </span><span class="s1">'0'</span>
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>
</span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>config<span class="w"> </span>interface<span class="w"> </span><span class="s1">'trusted_bridge'</span>
</span><span id="__span-22-23"><a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'static'</span>
</span><span id="__span-22-24"><a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a><span class="w"> </span>option<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="s1">'bridge'</span>
</span><span id="__span-22-25"><a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a><span class="w"> </span>list<span class="w"> </span>ports<span class="w"> </span><span class="s1">'trusted'</span>
</span><span id="__span-22-26"><a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a><span class="w"> </span>option<span class="w"> </span>ipaddr<span class="w"> </span><span class="s1">'10.11.20.1'</span>
</span><span id="__span-22-27"><a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a><span class="w"> </span>option<span class="w"> </span>netmask<span class="w"> </span><span class="s1">'255.255.255.0'</span>
</span><span id="__span-22-28"><a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a>
</span><span id="__span-22-29"><a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a><span class="c1"># VLAN 30 - Guest Network (example)</span>
</span><span id="__span-22-30"><a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a>config<span class="w"> </span>interface<span class="w"> </span><span class="s1">'guest'</span>
</span><span id="__span-22-31"><a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'batadv_vlan'</span>
</span><span id="__span-22-32"><a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a><span class="w"> </span>option<span class="w"> </span>master<span class="w"> </span><span class="s1">'bat0'</span>
</span><span id="__span-22-33"><a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a><span class="w"> </span>option<span class="w"> </span>vid<span class="w"> </span><span class="s1">'30'</span>
</span><span id="__span-22-34"><a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a><span class="w"> </span>option<span class="w"> </span>ap_isolation<span class="w"> </span><span class="s1">'1'</span><span class="w">  </span><span class="c1"># Isolate guest clients</span>
</span><span id="__span-22-35"><a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a>
</span><span id="__span-22-36"><a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a>config<span class="w"> </span>interface<span class="w"> </span><span class="s1">'guest_bridge'</span>
</span><span id="__span-22-37"><a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a><span class="w"> </span>option<span class="w"> </span>proto<span class="w"> </span><span class="s1">'static'</span>
</span><span id="__span-22-38"><a id="__codelineno-22-38" name="__codelineno-22-38" href="#__codelineno-22-38"></a><span class="w"> </span>option<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="s1">'bridge'</span>
</span><span id="__span-22-39"><a id="__codelineno-22-39" name="__codelineno-22-39" href="#__codelineno-22-39"></a><span class="w"> </span>list<span class="w"> </span>ports<span class="w"> </span><span class="s1">'guest'</span>
</span><span id="__span-22-40"><a id="__codelineno-22-40" name="__codelineno-22-40" href="#__codelineno-22-40"></a><span class="w"> </span>option<span class="w"> </span>ipaddr<span class="w"> </span><span class="s1">'10.11.30.1'</span>
</span><span id="__span-22-41"><a id="__codelineno-22-41" name="__codelineno-22-41" href="#__codelineno-22-41"></a><span class="w"> </span>option<span class="w"> </span>netmask<span class="w"> </span><span class="s1">'255.255.255.0'</span>
</span></code></pre></div> <h3 id="add-vlan-aware-wifi-interfaces">Add VLAN-Aware WiFi Interfaces<a class="headerlink" href="#add-vlan-aware-wifi-interfaces" title="Permanent link"></a></h3> <p>Modify <code>/etc/config/wireless</code> to add VLAN-specific SSIDs:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1"># Guest WiFi on VLAN 30</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>config<span class="w"> </span>wifi-iface<span class="w"> </span><span class="s1">'guest_wifi'</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w"> </span>option<span class="w"> </span>device<span class="w"> </span><span class="s1">'radio1'</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w"> </span>option<span class="w"> </span>mode<span class="w"> </span><span class="s1">'ap'</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w"> </span>option<span class="w"> </span>network<span class="w"> </span><span class="s1">'guest_bridge'</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w"> </span>option<span class="w"> </span>ssid<span class="w"> </span><span class="s1">'HA-Guest'</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w"> </span>option<span class="w"> </span>encryption<span class="w"> </span><span class="s1">'psk2+ccmp'</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w"> </span>option<span class="w"> </span>key<span class="w"> </span><span class="s1">'GuestPassword123!'</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w"> </span>option<span class="w"> </span>isolate<span class="w"> </span><span class="s1">'1'</span>
</span></code></pre></div> <h3 id="configure-vlan-firewall-rules">Configure VLAN Firewall Rules<a class="headerlink" href="#configure-vlan-firewall-rules" title="Permanent link"></a></h3> <p>Add to <code>/etc/config/firewall</code>:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># Guest VLAN zone</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>config<span class="w"> </span>zone
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="w"> </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'guest'</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w"> </span>list<span class="w"> </span>network<span class="w"> </span><span class="s1">'guest_bridge'</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w"> </span>option<span class="w"> </span>input<span class="w"> </span><span class="s1">'REJECT'</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="w"> </span>option<span class="w"> </span>output<span class="w"> </span><span class="s1">'ACCEPT'</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="w"> </span>option<span class="w"> </span>forward<span class="w"> </span><span class="s1">'REJECT'</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>config<span class="w"> </span>forwarding
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="w"> </span>option<span class="w"> </span>src<span class="w"> </span><span class="s1">'guest'</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="w"> </span>option<span class="w"> </span>dest<span class="w"> </span><span class="s1">'wan'</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="c1"># Block guest access to LAN</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>config<span class="w"> </span>rule
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="w"> </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'Block-Guest-to-LAN'</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="w"> </span>option<span class="w"> </span>src<span class="w"> </span><span class="s1">'guest'</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="w"> </span>option<span class="w"> </span>dest<span class="w"> </span><span class="s1">'lan'</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a><span class="w"> </span>option<span class="w"> </span>target<span class="w"> </span><span class="s1">'REJECT'</span>
</span></code></pre></div> <h3 id="enable-dhcp-for-vlans">Enable DHCP for VLANs<a class="headerlink" href="#enable-dhcp-for-vlans" title="Permanent link"></a></h3> <p>Add to <code>/etc/config/dhcp</code> on Node 1 only:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>config<span class="w"> </span>dhcp<span class="w"> </span><span class="s1">'mgmt'</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w"> </span>option<span class="w"> </span>interface<span class="w"> </span><span class="s1">'mgmt_bridge'</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w"> </span>option<span class="w"> </span>start<span class="w"> </span><span class="s1">'100'</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w"> </span>option<span class="w"> </span>limit<span class="w"> </span><span class="s1">'50'</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w"> </span>option<span class="w"> </span>leasetime<span class="w"> </span><span class="s1">'12h'</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>config<span class="w"> </span>dhcp<span class="w"> </span><span class="s1">'trusted'</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="w"> </span>option<span class="w"> </span>interface<span class="w"> </span><span class="s1">'trusted_bridge'</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w"> </span>option<span class="w"> </span>start<span class="w"> </span><span class="s1">'100'</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w"> </span>option<span class="w"> </span>limit<span class="w"> </span><span class="s1">'100'</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w"> </span>option<span class="w"> </span>leasetime<span class="w"> </span><span class="s1">'12h'</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>config<span class="w"> </span>dhcp<span class="w"> </span><span class="s1">'guest'</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="w"> </span>option<span class="w"> </span>interface<span class="w"> </span><span class="s1">'guest_bridge'</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="w"> </span>option<span class="w"> </span>start<span class="w"> </span><span class="s1">'100'</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="w"> </span>option<span class="w"> </span>limit<span class="w"> </span><span class="s1">'50'</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="w"> </span>option<span class="w"> </span>leasetime<span class="w"> </span><span class="s1">'2h'</span>
</span></code></pre></div> <hr> <h2 id="testing-verification">Testing &amp; Verification<a class="headerlink" href="#testing-verification" title="Permanent link"></a></h2> <h3 id="initial-connectivity-tests">Initial Connectivity Tests<a class="headerlink" href="#initial-connectivity-tests" title="Permanent link"></a></h3> <h4 id="1-verify-batman-interfaces">1. Verify Batman Interfaces<a class="headerlink" href="#1-verify-batman-interfaces" title="Permanent link"></a></h4> <p>On each node:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>batctl<span class="w"> </span><span class="k">if</span>
</span></code></pre></div> <p>Expected output:</p> <div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>lan3: active
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>lan4: active
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>mesh0: active
</span></code></pre></div> <h4 id="2-check-mesh-topology">2. Check Mesh Topology<a class="headerlink" href="#2-check-mesh-topology" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>batctl<span class="w"> </span>o
</span></code></pre></div> <p>Expected output showing all nodes with multiple paths:</p> <div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>[B.A.T.M.A.N. adv 2023.0, MainIF/MAC: lan3/xx:xx:xx:xx:xx:xx (bat0)]
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>  Originator        last-seen (#/255) Nexthop           [outgoingIF]
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>  10.11.12.2        0.420s   (255) 10.11.12.2 [  lan3]
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>  10.11.12.2        0.520s   (255) 10.11.12.2 [  lan4] via 10.11.12.3
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>  10.11.12.2        0.640s   (180) 10.11.12.2 [ mesh0]
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>  10.11.12.3        0.340s   (255) 10.11.12.3 [  lan4]
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>  10.11.12.3        0.520s   (255) 10.11.12.3 [  lan3] via 10.11.12.2
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>  10.11.12.3        0.680s   (165) 10.11.12.3 [ mesh0]
</span></code></pre></div> <p>Key observations:</p> <ul> <li>TQ value of 255 = perfect wired connection</li> <li>TQ value 150-200 = good wireless connection</li> <li>Multiple paths to same destination = redundancy working</li> </ul> <h4 id="3-check-gateway-status">3. Check Gateway Status<a class="headerlink" href="#3-check-gateway-status" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>batctl<span class="w"> </span>gwl
</span></code></pre></div> <p>Expected output:</p> <div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>[B.A.T.M.A.N. adv 2023.0, MainIF/MAC: lan3/xx:xx:xx:xx:xx:xx (bat0)]
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>   Router            ( throughput) Next Hop          [outgoingIF]
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>=&gt; 10.11.12.1           (100.0 MBit) 10.11.12.1          [  lan3]
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a> * 10.11.12.2           (100.0 MBit) 10.11.12.2          [  lan3]
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>   10.11.12.3           (100.0 MBit) 10.11.12.3          [  lan4]
</span></code></pre></div> <ul> <li><code>=&gt;</code> = currently selected gateway</li> <li><code>*</code> = available backup gateways</li> </ul> <h4 id="4-ping-test-between-nodes">4. Ping Test Between Nodes<a class="headerlink" href="#4-ping-test-between-nodes" title="Permanent link"></a></h4> <p>From Node 1:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">10</span>.11.12.2
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">10</span>.11.12.3
</span></code></pre></div> <p>Should get responses with low latency (&lt;5ms on wired).</p> <h4 id="5-test-internet-connectivity">5. Test Internet Connectivity<a class="headerlink" href="#5-test-internet-connectivity" title="Permanent link"></a></h4> <p>From any node:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span>.1.1.1
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">5</span><span class="w"> </span>google.com
</span></code></pre></div> <p>Should work via whichever gateway batman selected.</p> <h4 id="6-test-wired-client-connectivity">6. Test Wired Client Connectivity<a class="headerlink" href="#6-test-wired-client-connectivity" title="Permanent link"></a></h4> <p>Connect a workstation to LAN1 or LAN2 on any node:</p> <p><strong>From the workstation:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># Check DHCP assignment</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>ip<span class="w"> </span>addr<span class="w"> </span>show<span class="w"> </span>eth0<span class="w">  </span><span class="c1"># Replace eth0 with your interface</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="c1"># Should show: inet 10.11.12.xxx/24</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="c1"># Verify gateway</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>ip<span class="w"> </span>route<span class="w"> </span>show
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="c1"># Should show: default via 10.11.12.1</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="c1"># Test connectivity to all nodes</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">10</span>.11.12.1
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">10</span>.11.12.2<span class="w">  </span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">10</span>.11.12.3
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="c1"># Test internet</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span>.1.1.1
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>curl<span class="w"> </span>-I<span class="w"> </span>https://google.com
</span></code></pre></div> <p><strong>Verify which gateway the workstation is using:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1"># On any mesh node, check the client's MAC</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>batctl<span class="w"> </span>tl<span class="w">  </span><span class="c1"># Translation table - shows all known clients</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="c1"># Check gateway selection for traffic</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>batctl<span class="w"> </span>gwl
</span></code></pre></div> <p><strong>Test mobility:</strong></p> <ol> <li>Connect workstation to Node1 LAN1, note IP address</li> <li>Move cable to Node2 LAN1</li> <li>Verify same IP retained (DHCP lease preserved)</li> <li>Verify connectivity maintained</li> </ol> <h3 id="failover-testing">Failover Testing<a class="headerlink" href="#failover-testing" title="Permanent link"></a></h3> <h4 id="test-1-single-wire-failure">Test 1: Single Wire Failure<a class="headerlink" href="#test-1-single-wire-failure" title="Permanent link"></a></h4> <p><strong>Scenario:</strong> Disconnect Node1-Node2 cable (lan3)</p> <ol> <li>Before disconnect:</li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>watch<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="s1">'batctl o | grep 10.11.12.2'</span>
</span></code></pre></div> <ol> <li> <p>Disconnect cable between Node1 lan3 and Node2 lan3</p> </li> <li> <p>Observe routing change:</p> </li> <li>Traffic from Node1 to Node2 now routes via Node3 (lan4)</li> <li>Or via mesh0 if wireless is faster</li> <li> <p>Failover should occur within 1-3 seconds</p> </li> <li> <p>Test connectivity:</p> </li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">10</span>.11.12.2
</span></code></pre></div> <p>Should continue working with minimal packet loss.</p> <ol> <li>Reconnect cable - should revert to direct path</li> </ol> <h4 id="test-2-node-failure">Test 2: Node Failure<a class="headerlink" href="#test-2-node-failure" title="Permanent link"></a></h4> <p><strong>Scenario:</strong> Power off Node2 completely</p> <ol> <li>From Node1, continuous ping to Node3:</li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>ping<span class="w"> </span><span class="m">10</span>.11.12.3
</span></code></pre></div> <ol> <li> <p>Power off Node2</p> </li> <li> <p>Observe:</p> </li> <li>Node1  Node3 wired path via Node2 fails</li> <li>Batman automatically routes via mesh0 (2.4GHz wireless)</li> <li> <p>Or via remaining wired path if ring was complete</p> </li> <li> <p>Check new topology:</p> </li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>batctl<span class="w"> </span>o
</span></code></pre></div> <p>Node2 should disappear from originator list.</p> <h4 id="test-3-gateway-failover">Test 3: Gateway Failover<a class="headerlink" href="#test-3-gateway-failover" title="Permanent link"></a></h4> <p><strong>Scenario:</strong> Disconnect WAN on active gateway</p> <ol> <li>Identify current gateway from client perspective:</li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># On any node</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>batctl<span class="w"> </span>gwl
</span></code></pre></div> <ol> <li> <p>Find which node client is currently using (look for <code>=&gt;</code>)</p> </li> <li> <p>Disconnect that node's WAN cable</p> </li> <li> <p>Observe gateway switch:</p> </li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>watch<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>batctl<span class="w"> </span>gwl
</span></code></pre></div> <ol> <li> <p>Client should automatically select new gateway within 5-30 seconds</p> </li> <li> <p>Test client internet:</p> </li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">1</span>.1.1.1
</span></code></pre></div> <p>May see 1-2 packets dropped during switchover.</p> <h4 id="test-4-complete-wired-mesh-failure">Test 4: Complete Wired Mesh Failure<a class="headerlink" href="#test-4-complete-wired-mesh-failure" title="Permanent link"></a></h4> <p><strong>Scenario:</strong> Disconnect all three wired cables</p> <ol> <li>Monitor mesh status:</li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>watch<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="s1">'batctl o'</span>
</span></code></pre></div> <ol> <li> <p>Disconnect all wired ring cables</p> </li> <li> <p>Observe:</p> </li> <li>All paths switch to mesh0 (2.4GHz)</li> <li>TQ values drop from 255 to ~150-200</li> <li> <p>Network remains functional</p> </li> <li> <p>Performance test:</p> </li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="c1"># From Node1 to Node2</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>iperf3<span class="w"> </span>-c<span class="w"> </span><span class="m">10</span>.11.12.2
</span></code></pre></div> <p>Compare wired vs wireless throughput.</p> <h4 id="test-5-wired-client-during-node-failure">Test 5: Wired Client During Node Failure<a class="headerlink" href="#test-5-wired-client-during-node-failure" title="Permanent link"></a></h4> <p><strong>Scenario:</strong> Workstation connected to node that fails</p> <ol> <li><strong>Setup:</strong></li> <li>Connect workstation to Node2 LAN1</li> <li>Verify internet connectivity</li> <li> <p>Note IP address (e.g., 10.11.12.105)</p> </li> <li> <p><strong>Simulate Node2 power failure:</strong></p> </li> <li>Unplug Node2 power</li> <li> <p>Workstation loses connection (expected)</p> </li> <li> <p><strong>Recovery:</strong></p> </li> <li>Move workstation cable to Node1 LAN1 or Node3 LAN1</li> <li>Workstation should get same IP (DHCP lease preserved)</li> <li>Verify connectivity restored</li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>ping<span class="w"> </span><span class="m">10</span>.11.12.1
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>ping<span class="w"> </span><span class="m">1</span>.1.1.1
</span></code></pre></div> <h4 id="test-6-wired-client-during-wan-failure-node-stays-up">Test 6: Wired Client During WAN Failure (Node Stays Up)<a class="headerlink" href="#test-6-wired-client-during-wan-failure-node-stays-up" title="Permanent link"></a></h4> <p><strong>Scenario:</strong> Node's WAN fails but node remains powered</p> <ol> <li><strong>Setup:</strong></li> <li>Connect workstation to Node2 LAN1</li> <li>Continuous ping to internet:</li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>ping<span class="w"> </span><span class="m">1</span>.1.1.1
</span></code></pre></div> <ol> <li> <p><strong>Disconnect Node2's WAN cable</strong></p> </li> <li> <p><strong>Observe:</strong></p> </li> <li>Workstation stays connected to Node2 LAN1</li> <li>May see 1-3 packets dropped during gateway switch (~5-30 seconds)</li> <li>Traffic automatically reroutes through mesh to Node1 or Node3</li> <li> <p>Ping resumes automatically</p> </li> <li> <p><strong>Verify new path:</strong></p> </li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="c1"># On Node2</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>batctl<span class="w"> </span>gwl
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="c1"># Should show different gateway selected</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a>traceroute<span class="w"> </span><span class="m">1</span>.1.1.1
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="c1"># Should show path through mesh</span>
</span></code></pre></div> <ol> <li><strong>Reconnect Node2 WAN:</strong></li> <li>Should switch back to local gateway</li> <li>Workstation stays connected throughout</li> </ol> <p><strong>Key observation:</strong> Workstation never loses connection to mesh when only WAN fails!</p> <h3 id="performance-testing">Performance Testing<a class="headerlink" href="#performance-testing" title="Permanent link"></a></h3> <h4 id="throughput-test">Throughput Test<a class="headerlink" href="#throughput-test" title="Permanent link"></a></h4> <p><strong>Setup iperf3 server on Node2:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>ssh<span class="w"> </span>root@10.11.12.2
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>opkg<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>opkg<span class="w"> </span>install<span class="w"> </span>iperf3
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>iperf3<span class="w"> </span>-s
</span></code></pre></div> <p><strong>Test from Node1:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c1"># Wired ring active</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>iperf3<span class="w"> </span>-c<span class="w"> </span><span class="m">10</span>.11.12.2<span class="w"> </span>-t<span class="w"> </span><span class="m">30</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="c1"># Disconnect wire, test wireless</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>iperf3<span class="w"> </span>-c<span class="w"> </span><span class="m">10</span>.11.12.2<span class="w"> </span>-t<span class="w"> </span><span class="m">30</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="c1"># Compare results</span>
</span></code></pre></div> <p>Expected results:</p> <ul> <li>Wired: 400-900 Mbps (depends on path: direct or via Node3)</li> <li>Wireless: 50-200 Mbps (depends on distance and interference)</li> </ul> <h4 id="latency-test">Latency Test<a class="headerlink" href="#latency-test" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c1"># Install hping3 for detailed latency tests</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>opkg<span class="w"> </span>install<span class="w"> </span>hping3
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="c1"># Test latency</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>hping3<span class="w"> </span>-c<span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">10</span>.11.12.2
</span></code></pre></div> <p>Expected:</p> <ul> <li>Wired direct: &lt;2ms</li> <li>Wired via intermediate node: 2-5ms</li> <li>Wireless: 5-20ms</li> </ul> <h3 id="vlan-testing-if-configured">VLAN Testing (if configured)<a class="headerlink" href="#vlan-testing-if-configured" title="Permanent link"></a></h3> <h4 id="test-vlan-isolation">Test VLAN Isolation<a class="headerlink" href="#test-vlan-isolation" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="c1"># From guest VLAN client, try to reach LAN</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>ping<span class="w"> </span><span class="m">10</span>.11.12.1<span class="w">  </span><span class="c1"># Should fail if firewall rules correct</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="c1"># From guest VLAN, test internet</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a>ping<span class="w"> </span><span class="m">1</span>.1.1.1<span class="w">     </span><span class="c1"># Should work</span>
</span></code></pre></div> <h4 id="test-vlan-mobility">Test VLAN Mobility<a class="headerlink" href="#test-vlan-mobility" title="Permanent link"></a></h4> <p>Connect a client to guest WiFi on Node1, then move to Node2's coverage area:</p> <ul> <li>Client should roam seamlessly</li> <li>VLAN membership should be maintained</li> <li>IP address should remain the same (same DHCP server)</li> </ul> <hr> <h2 id="monitoring-maintenance">Monitoring &amp; Maintenance<a class="headerlink" href="#monitoring-maintenance" title="Permanent link"></a></h2> <h3 id="create-monitoring-script">Create Monitoring Script<a class="headerlink" href="#create-monitoring-script" title="Permanent link"></a></h3> <p>Create <code>/root/mesh_monitor.sh</code>:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="ch">#!/bin/sh</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="c1"># Mesh Network Monitor Script</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="c1"># Usage: ./mesh_monitor.sh</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a>clear
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"========================================"</span>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">" Batman-adv Mesh Network Status"</span>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">" Generated: </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">"</span>
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"========================================"</span>
</span><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">""</span>
</span><span id="__span-52-13"><a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a>
</span><span id="__span-52-14"><a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"--- Local Node Info ---"</span>
</span><span id="__span-52-15"><a id="__codelineno-52-15" name="__codelineno-52-15" href="#__codelineno-52-15"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"Hostname: </span><span class="k">$(</span>uci<span class="w"> </span>get<span class="w"> </span>system.@system<span class="o">[</span><span class="m">0</span><span class="o">]</span>.hostname<span class="k">)</span><span class="s2">"</span>
</span><span id="__span-52-16"><a id="__codelineno-52-16" name="__codelineno-52-16" href="#__codelineno-52-16"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"IP Address: </span><span class="k">$(</span>ip<span class="w"> </span>-4<span class="w"> </span>addr<span class="w"> </span>show<span class="w"> </span>br-lan<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-oP<span class="w"> </span><span class="s1">'(?&lt;=inet\s)\d+(\.\d+){3}'</span><span class="k">)</span><span class="s2">"</span>
</span><span id="__span-52-17"><a id="__codelineno-52-17" name="__codelineno-52-17" href="#__codelineno-52-17"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"Uptime: </span><span class="k">$(</span>uptime<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">'{print $3,$4}'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">'s/,//'</span><span class="k">)</span><span class="s2">"</span>
</span><span id="__span-52-18"><a id="__codelineno-52-18" name="__codelineno-52-18" href="#__codelineno-52-18"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">""</span>
</span><span id="__span-52-19"><a id="__codelineno-52-19" name="__codelineno-52-19" href="#__codelineno-52-19"></a>
</span><span id="__span-52-20"><a id="__codelineno-52-20" name="__codelineno-52-20" href="#__codelineno-52-20"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"--- Batman Interfaces ---"</span>
</span><span id="__span-52-21"><a id="__codelineno-52-21" name="__codelineno-52-21" href="#__codelineno-52-21"></a>batctl<span class="w"> </span><span class="k">if</span>
</span><span id="__span-52-22"><a id="__codelineno-52-22" name="__codelineno-52-22" href="#__codelineno-52-22"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">""</span>
</span><span id="__span-52-23"><a id="__codelineno-52-23" name="__codelineno-52-23" href="#__codelineno-52-23"></a>
</span><span id="__span-52-24"><a id="__codelineno-52-24" name="__codelineno-52-24" href="#__codelineno-52-24"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"--- Mesh Topology ---"</span>
</span><span id="__span-52-25"><a id="__codelineno-52-25" name="__codelineno-52-25" href="#__codelineno-52-25"></a>batctl<span class="w"> </span>o<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-10
</span><span id="__span-52-26"><a id="__codelineno-52-26" name="__codelineno-52-26" href="#__codelineno-52-26"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">""</span>
</span><span id="__span-52-27"><a id="__codelineno-52-27" name="__codelineno-52-27" href="#__codelineno-52-27"></a>
</span><span id="__span-52-28"><a id="__codelineno-52-28" name="__codelineno-52-28" href="#__codelineno-52-28"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"--- Gateway Status ---"</span>
</span><span id="__span-52-29"><a id="__codelineno-52-29" name="__codelineno-52-29" href="#__codelineno-52-29"></a>batctl<span class="w"> </span>gwl
</span><span id="__span-52-30"><a id="__codelineno-52-30" name="__codelineno-52-30" href="#__codelineno-52-30"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">""</span>
</span><span id="__span-52-31"><a id="__codelineno-52-31" name="__codelineno-52-31" href="#__codelineno-52-31"></a>
</span><span id="__span-52-32"><a id="__codelineno-52-32" name="__codelineno-52-32" href="#__codelineno-52-32"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"--- Neighbor Info ---"</span>
</span><span id="__span-52-33"><a id="__codelineno-52-33" name="__codelineno-52-33" href="#__codelineno-52-33"></a>batctl<span class="w"> </span>n
</span><span id="__span-52-34"><a id="__codelineno-52-34" name="__codelineno-52-34" href="#__codelineno-52-34"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">""</span>
</span><span id="__span-52-35"><a id="__codelineno-52-35" name="__codelineno-52-35" href="#__codelineno-52-35"></a>
</span><span id="__span-52-36"><a id="__codelineno-52-36" name="__codelineno-52-36" href="#__codelineno-52-36"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"--- Link Quality Details ---"</span>
</span><span id="__span-52-37"><a id="__codelineno-52-37" name="__codelineno-52-37" href="#__codelineno-52-37"></a><span class="k">for</span><span class="w"> </span>iface<span class="w"> </span><span class="k">in</span><span class="w"> </span>lan3<span class="w"> </span>lan4<span class="w"> </span>mesh0<span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-52-38"><a id="__codelineno-52-38" name="__codelineno-52-38" href="#__codelineno-52-38"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">"/sys/class/net/</span><span class="nv">$iface</span><span class="s2">"</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-52-39"><a id="__codelineno-52-39" name="__codelineno-52-39" href="#__codelineno-52-39"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"</span><span class="nv">$iface</span><span class="s2"> status:"</span>
</span><span id="__span-52-40"><a id="__codelineno-52-40" name="__codelineno-52-40" href="#__codelineno-52-40"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"  State: </span><span class="k">$(</span>cat<span class="w"> </span>/sys/class/net/<span class="nv">$iface</span>/operstate<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">'N/A'</span><span class="k">)</span><span class="s2">"</span>
</span><span id="__span-52-41"><a id="__codelineno-52-41" name="__codelineno-52-41" href="#__codelineno-52-41"></a>
</span><span id="__span-52-42"><a id="__codelineno-52-42" name="__codelineno-52-42" href="#__codelineno-52-42"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">"</span><span class="nv">$iface</span><span class="s2">"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"mesh0"</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-52-43"><a id="__codelineno-52-43" name="__codelineno-52-43" href="#__codelineno-52-43"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"  Mesh peers:"</span>
</span><span id="__span-52-44"><a id="__codelineno-52-44" name="__codelineno-52-44" href="#__codelineno-52-44"></a><span class="w">            </span>iw<span class="w"> </span>dev<span class="w"> </span>mesh0<span class="w"> </span>station<span class="w"> </span>dump<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">"Station|signal:"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-6
</span><span id="__span-52-45"><a id="__codelineno-52-45" name="__codelineno-52-45" href="#__codelineno-52-45"></a><span class="w">        </span><span class="k">fi</span>
</span><span id="__span-52-46"><a id="__codelineno-52-46" name="__codelineno-52-46" href="#__codelineno-52-46"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">""</span>
</span><span id="__span-52-47"><a id="__codelineno-52-47" name="__codelineno-52-47" href="#__codelineno-52-47"></a><span class="w">    </span><span class="k">fi</span>
</span><span id="__span-52-48"><a id="__codelineno-52-48" name="__codelineno-52-48" href="#__codelineno-52-48"></a><span class="k">done</span>
</span><span id="__span-52-49"><a id="__codelineno-52-49" name="__codelineno-52-49" href="#__codelineno-52-49"></a>
</span><span id="__span-52-50"><a id="__codelineno-52-50" name="__codelineno-52-50" href="#__codelineno-52-50"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"--- WAN Status ---"</span>
</span><span id="__span-52-51"><a id="__codelineno-52-51" name="__codelineno-52-51" href="#__codelineno-52-51"></a><span class="k">for</span><span class="w"> </span>iface<span class="w"> </span><span class="k">in</span><span class="w"> </span>wan<span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-52-52"><a id="__codelineno-52-52" name="__codelineno-52-52" href="#__codelineno-52-52"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span>show<span class="w"> </span><span class="nv">$iface</span><span class="w"> </span>up<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span>UP<span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-52-53"><a id="__codelineno-52-53" name="__codelineno-52-53" href="#__codelineno-52-53"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"WAN: UP"</span>
</span><span id="__span-52-54"><a id="__codelineno-52-54" name="__codelineno-52-54" href="#__codelineno-52-54"></a><span class="w">        </span>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span><span class="w"> </span>-W<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span>.1.1.1<span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"Internet: OK"</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"Internet: FAILED"</span>
</span><span id="__span-52-55"><a id="__codelineno-52-55" name="__codelineno-52-55" href="#__codelineno-52-55"></a><span class="w">    </span><span class="k">else</span>
</span><span id="__span-52-56"><a id="__codelineno-52-56" name="__codelineno-52-56" href="#__codelineno-52-56"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"WAN: DOWN"</span>
</span><span id="__span-52-57"><a id="__codelineno-52-57" name="__codelineno-52-57" href="#__codelineno-52-57"></a><span class="w">    </span><span class="k">fi</span>
</span><span id="__span-52-58"><a id="__codelineno-52-58" name="__codelineno-52-58" href="#__codelineno-52-58"></a><span class="k">done</span>
</span><span id="__span-52-59"><a id="__codelineno-52-59" name="__codelineno-52-59" href="#__codelineno-52-59"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">""</span>
</span><span id="__span-52-60"><a id="__codelineno-52-60" name="__codelineno-52-60" href="#__codelineno-52-60"></a>
</span><span id="__span-52-61"><a id="__codelineno-52-61" name="__codelineno-52-61" href="#__codelineno-52-61"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"--- Recent Batman Logs ---"</span>
</span><span id="__span-52-62"><a id="__codelineno-52-62" name="__codelineno-52-62" href="#__codelineno-52-62"></a>logread<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>batman<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-5
</span><span id="__span-52-63"><a id="__codelineno-52-63" name="__codelineno-52-63" href="#__codelineno-52-63"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">""</span>
</span><span id="__span-52-64"><a id="__codelineno-52-64" name="__codelineno-52-64" href="#__codelineno-52-64"></a>
</span><span id="__span-52-65"><a id="__codelineno-52-65" name="__codelineno-52-65" href="#__codelineno-52-65"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"========================================"</span>
</span><span id="__span-52-66"><a id="__codelineno-52-66" name="__codelineno-52-66" href="#__codelineno-52-66"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">" Monitor script completed"</span>
</span><span id="__span-52-67"><a id="__codelineno-52-67" name="__codelineno-52-67" href="#__codelineno-52-67"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"========================================"</span>
</span></code></pre></div> <p>Make executable:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>chmod<span class="w"> </span>+x<span class="w"> </span>/root/mesh_monitor.sh
</span></code></pre></div> <p>Run it:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>/root/mesh_monitor.sh
</span></code></pre></div> <h3 id="continuous-monitoring">Continuous Monitoring<a class="headerlink" href="#continuous-monitoring" title="Permanent link"></a></h3> <p>For real-time monitoring:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>watch<span class="w"> </span>-n<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="s1">'/root/mesh_monitor.sh'</span>
</span></code></pre></div> <h3 id="key-metrics-to-monitor">Key Metrics to Monitor<a class="headerlink" href="#key-metrics-to-monitor" title="Permanent link"></a></h3> <ol> <li><strong>Originator TQ (Transmit Quality):</strong></li> <li>255 = Perfect</li> <li>200-254 = Excellent</li> <li>150-199 = Good</li> <li>100-149 = Fair</li> <li> <p>&lt;100 = Poor</p> </li> <li> <p><strong>Gateway Selection:</strong></p> </li> <li>Should be stable (not switching frequently)</li> <li> <p>Clients should distribute across gateways</p> </li> <li> <p><strong>Interface Status:</strong></p> </li> <li>All batman interfaces should show "active"</li> <li> <p>Ethernet ports should show "UP"</p> </li> <li> <p><strong>Mesh Peering:</strong></p> </li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>iw<span class="w"> </span>dev<span class="w"> </span>mesh0<span class="w"> </span>station<span class="w"> </span>dump
</span></code></pre></div> <ul> <li>Should show <code>mesh plink: ESTAB</code> for each peer</li> </ul> <h3 id="log-monitoring">Log Monitoring<a class="headerlink" href="#log-monitoring" title="Permanent link"></a></h3> <div class="language-bash highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="c1"># Watch batman logs in real-time</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>logread<span class="w"> </span>-f<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>batman
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="c1"># Check for errors</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a>logread<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">"batman.*error"</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="c1"># Check for gateway changes</span>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a>logread<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">"gw"</span>
</span></code></pre></div> <h3 id="performance-monitoring">Performance Monitoring<a class="headerlink" href="#performance-monitoring" title="Permanent link"></a></h3> <p>Create <code>/root/performance_test.sh</code>:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="ch">#!/bin/sh</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"=== Performance Test ==="</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"Date: </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">"</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">""</span>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a><span class="c1"># Test to other nodes</span>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a><span class="k">for</span><span class="w"> </span>ip<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">10</span>.11.12.1<span class="w"> </span><span class="m">10</span>.11.12.2<span class="w"> </span><span class="m">10</span>.11.12.3<span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="w">    </span><span class="nv">current_ip</span><span class="o">=</span><span class="k">$(</span>ip<span class="w"> </span>-4<span class="w"> </span>addr<span class="w"> </span>show<span class="w"> </span>br-lan<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-oP<span class="w"> </span><span class="s1">'(?&lt;=inet\s)\d+(\.\d+){3}'</span><span class="k">)</span>
</span><span id="__span-58-10"><a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">"</span><span class="nv">$ip</span><span class="s2">"</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="nv">$current_ip</span><span class="s2">"</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-58-11"><a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"Testing to </span><span class="nv">$ip</span><span class="s2">:"</span>
</span><span id="__span-58-12"><a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a><span class="w">        </span>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">10</span><span class="w"> </span>-q<span class="w"> </span><span class="nv">$ip</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1
</span><span id="__span-58-13"><a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">""</span>
</span><span id="__span-58-14"><a id="__codelineno-58-14" name="__codelineno-58-14" href="#__codelineno-58-14"></a><span class="w">    </span><span class="k">fi</span>
</span><span id="__span-58-15"><a id="__codelineno-58-15" name="__codelineno-58-15" href="#__codelineno-58-15"></a><span class="k">done</span>
</span><span id="__span-58-16"><a id="__codelineno-58-16" name="__codelineno-58-16" href="#__codelineno-58-16"></a>
</span><span id="__span-58-17"><a id="__codelineno-58-17" name="__codelineno-58-17" href="#__codelineno-58-17"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"=== Internet Connectivity ==="</span>
</span><span id="__span-58-18"><a id="__codelineno-58-18" name="__codelineno-58-18" href="#__codelineno-58-18"></a>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">10</span><span class="w"> </span>-q<span class="w"> </span><span class="m">1</span>.1.1.1<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1
</span><span id="__span-58-19"><a id="__codelineno-58-19" name="__codelineno-58-19" href="#__codelineno-58-19"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">""</span>
</span><span id="__span-58-20"><a id="__codelineno-58-20" name="__codelineno-58-20" href="#__codelineno-58-20"></a>
</span><span id="__span-58-21"><a id="__codelineno-58-21" name="__codelineno-58-21" href="#__codelineno-58-21"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"=== Current Routes ==="</span>
</span><span id="__span-58-22"><a id="__codelineno-58-22" name="__codelineno-58-22" href="#__codelineno-58-22"></a>batctl<span class="w"> </span>o<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"^\s*10.11.12"</span>
</span><span id="__span-58-23"><a id="__codelineno-58-23" name="__codelineno-58-23" href="#__codelineno-58-23"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">""</span>
</span></code></pre></div> <h3 id="scheduled-monitoring-optional">Scheduled Monitoring (Optional)<a class="headerlink" href="#scheduled-monitoring-optional" title="Permanent link"></a></h3> <p>Add to crontab for automated monitoring:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="c1"># Edit crontab</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>crontab<span class="w"> </span>-e
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="c1"># Add these lines:</span>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="c1"># Run mesh monitor every hour and save to log</span>
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="m">0</span><span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>/root/mesh_monitor.sh<span class="w"> </span>&gt;&gt;<span class="w"> </span>/tmp/mesh_monitor.log<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="c1"># Run performance test every 4 hours</span>
</span><span id="__span-59-9"><a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a><span class="m">0</span><span class="w"> </span>*/4<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>/root/performance_test.sh<span class="w"> </span>&gt;&gt;<span class="w"> </span>/tmp/performance_test.log<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
</span><span id="__span-59-10"><a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a>
</span><span id="__span-59-11"><a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a><span class="c1"># Rotate logs daily (keep last 7 days)</span>
</span><span id="__span-59-12"><a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>tail<span class="w"> </span>-1000<span class="w"> </span>/tmp/mesh_monitor.log<span class="w"> </span>&gt;<span class="w"> </span>/tmp/mesh_monitor.log.tmp<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mv<span class="w"> </span>/tmp/mesh_monitor.log.tmp<span class="w"> </span>/tmp/mesh_monitor.log
</span></code></pre></div> <hr> <h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link"></a></h2> <h3 id="issue-batman-interface-not-active">Issue: Batman Interface Not Active<a class="headerlink" href="#issue-batman-interface-not-active" title="Permanent link"></a></h3> <p><strong>Symptoms:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>batctl<span class="w"> </span><span class="k">if</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="c1"># Shows: No batman interfaces found</span>
</span></code></pre></div> <p><strong>Solutions:</strong></p> <ol> <li>Check batman module loaded:</li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>lsmod<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>batman
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="c1"># If not present:</span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>modprobe<span class="w"> </span>batman-adv
</span></code></pre></div> <ol> <li>Verify interface configuration:</li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>uci<span class="w"> </span>show<span class="w"> </span>network<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>batadv
</span></code></pre></div> <ol> <li>Restart network:</li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>/etc/init.d/network<span class="w"> </span>restart
</span></code></pre></div> <ol> <li>Check for errors:</li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>logread<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>batman
</span></code></pre></div> <h3 id="issue-mesh-peers-not-connecting">Issue: Mesh Peers Not Connecting<a class="headerlink" href="#issue-mesh-peers-not-connecting" title="Permanent link"></a></h3> <p><strong>Symptoms:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>batctl<span class="w"> </span>o
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="c1"># Shows no originators or only some nodes</span>
</span></code></pre></div> <p><strong>Solutions:</strong></p> <ol> <li><strong>Check wireless mesh:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>iw<span class="w"> </span>dev<span class="w"> </span>mesh0<span class="w"> </span>station<span class="w"> </span>dump
</span></code></pre></div> <p>Should show peers with <code>mesh plink: ESTAB</code></p> <ol> <li><strong>Verify mesh settings match:</strong></li> <li>Same mesh_id on all nodes</li> <li>Same encryption key</li> <li> <p>Same channel</p> </li> <li> <p><strong>Check mesh0 interface is up:</strong></p> </li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>ip<span class="w"> </span>link<span class="w"> </span>show<span class="w"> </span>mesh0
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="c1"># Should show: state UP</span>
</span></code></pre></div> <ol> <li><strong>Verify wired connections:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>ip<span class="w"> </span>link<span class="w"> </span>show<span class="w"> </span>lan3
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a>ip<span class="w"> </span>link<span class="w"> </span>show<span class="w"> </span>lan4
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="c1"># Should show: state UP</span>
</span></code></pre></div> <ol> <li><strong>Check physical cables</strong> - ensure all connections are secure</li> </ol> <h3 id="issue-low-tq-values-on-wired-links">Issue: Low TQ Values on Wired Links<a class="headerlink" href="#issue-low-tq-values-on-wired-links" title="Permanent link"></a></h3> <p><strong>Symptoms:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>batctl<span class="w"> </span>o
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="c1"># Wired interfaces showing TQ &lt; 200 instead of 255</span>
</span></code></pre></div> <p><strong>Solutions:</strong></p> <ol> <li><strong>Check MTU settings:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>ip<span class="w"> </span>link<span class="w"> </span>show<span class="w"> </span>lan3
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a>ip<span class="w"> </span>link<span class="w"> </span>show<span class="w"> </span>lan4
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="c1"># Should show mtu 1560</span>
</span></code></pre></div> <ol> <li><strong>Verify no speed/duplex mismatch:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>ethtool<span class="w"> </span>lan3
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="c1"># Should show: 1000baseT/Full</span>
</span></code></pre></div> <ol> <li><strong>Check for packet errors:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a>ip<span class="w"> </span>-s<span class="w"> </span>link<span class="w"> </span>show<span class="w"> </span>lan3
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="c1"># Look at RX/TX errors</span>
</span></code></pre></div> <ol> <li><strong>Test cable quality:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="c1"># On connected nodes, ping with large packets</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>ping<span class="w"> </span>-M<span class="w"> </span><span class="k">do</span><span class="w"> </span>-s<span class="w"> </span><span class="m">1500</span><span class="w"> </span><span class="m">10</span>.11.12.2
</span></code></pre></div> <h3 id="issue-gateway-not-switching-on-failover">Issue: Gateway Not Switching on Failover<a class="headerlink" href="#issue-gateway-not-switching-on-failover" title="Permanent link"></a></h3> <p><strong>Symptoms:</strong></p> <ul> <li>Disconnected WAN on gateway</li> <li>Clients lose internet instead of switching</li> </ul> <p><strong>Solutions:</strong></p> <ol> <li><strong>Check gateway configuration:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a>batctl<span class="w"> </span>gw_mode
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="c1"># Should show: server on all nodes</span>
</span></code></pre></div> <ol> <li><strong>Verify gateway bandwidth announced:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>uci<span class="w"> </span>show<span class="w"> </span>network.bat0.gw_bandwidth
</span></code></pre></div> <ol> <li><strong>Check gateway selection algorithm:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>batctl<span class="w"> </span>gwl
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="c1"># Verify multiple gateways listed</span>
</span></code></pre></div> <ol> <li><strong>Force gateway reselection:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="c1"># On client node</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>batctl<span class="w"> </span>gw_mode<span class="w"> </span>client
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a>sleep<span class="w"> </span><span class="m">2</span>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a>batctl<span class="w"> </span>gw_mode<span class="w"> </span>off
</span></code></pre></div> <ol> <li><strong>Check routing:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a>ip<span class="w"> </span>route<span class="w"> </span>show
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="c1"># Should show default via 10.11.12.x</span>
</span></code></pre></div> <h3 id="issue-clients-cant-get-dhcp">Issue: Clients Can't Get DHCP<a class="headerlink" href="#issue-clients-cant-get-dhcp" title="Permanent link"></a></h3> <p><strong>Symptoms:</strong></p> <ul> <li>Wireless clients connect but no IP</li> <li>Ethernet clients no IP</li> </ul> <p><strong>Solutions:</strong></p> <ol> <li><strong>Verify DHCP running on Node 1:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="c1"># On Node 1</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a>ps<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>dnsmasq
</span></code></pre></div> <ol> <li><strong>Check DHCP configuration:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>uci<span class="w"> </span>show<span class="w"> </span>dhcp.lan
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="c1"># Verify ignore != '1'</span>
</span></code></pre></div> <ol> <li><strong>Verify bridge includes bat0:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>brctl<span class="w"> </span>show<span class="w"> </span>br-lan
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="c1"># Should list bat0</span>
</span></code></pre></div> <ol> <li><strong>Check firewall:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a>iptables<span class="w"> </span>-L<span class="w"> </span>-n<span class="w"> </span>-v<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"dpt:67"</span>
</span></code></pre></div> <ol> <li><strong>Restart DHCP:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a>/etc/init.d/dnsmasq<span class="w"> </span>restart
</span></code></pre></div> <ol> <li><strong>Test DHCP manually:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="c1"># From client</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a>dhclient<span class="w"> </span>-v<span class="w"> </span>wlan0
</span></code></pre></div> <h3 id="issue-wired-client-cant-connect">Issue: Wired Client Can't Connect<a class="headerlink" href="#issue-wired-client-cant-connect" title="Permanent link"></a></h3> <p><strong>Symptoms:</strong></p> <ul> <li>Cable plugged into LAN1/LAN2 but no connectivity</li> <li>No IP address assigned</li> </ul> <p><strong>Solutions:</strong></p> <ol> <li><strong>Verify port is in bridge:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a>brctl<span class="w"> </span>show<span class="w"> </span>br-lan
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="c1"># Should list lan1 and lan2</span>
</span></code></pre></div> <ol> <li><strong>Check physical link:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a>ip<span class="w"> </span>link<span class="w"> </span>show<span class="w"> </span>lan1
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="c1"># Should show: state UP</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a>ethtool<span class="w"> </span>lan1
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="c1"># Should show: Link detected: yes</span>
</span></code></pre></div> <ol> <li><strong>Verify switch port (if using switch):</strong></li> <li>Check switch link lights</li> <li>Try different switch port</li> <li> <p>Test with known-good cable</p> </li> <li> <p><strong>Check interface status:</strong></p> </li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>uci<span class="w"> </span>show<span class="w"> </span>network<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"lan1\|lan2"</span>
</span></code></pre></div> <ol> <li><strong>Test with static IP:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="c1"># On client workstation, temporarily set static:</span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a>ip<span class="w"> </span>addr<span class="w"> </span>add<span class="w"> </span><span class="m">10</span>.11.12.200/24<span class="w"> </span>dev<span class="w"> </span>eth0
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a>ip<span class="w"> </span>route<span class="w"> </span>add<span class="w"> </span>default<span class="w"> </span>via<span class="w"> </span><span class="m">10</span>.11.12.1
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a>ping<span class="w"> </span><span class="m">10</span>.11.12.1
</span></code></pre></div> <ol> <li><strong>Check DHCP logs:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a>logread<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>dhcp
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="c1"># Look for DHCPDISCOVER and DHCPOFFER</span>
</span></code></pre></div> <h3 id="issue-client-gets-ip-but-no-internet">Issue: Client Gets IP But No Internet<a class="headerlink" href="#issue-client-gets-ip-but-no-internet" title="Permanent link"></a></h3> <p><strong>Symptoms:</strong></p> <ul> <li>DHCP works (10.11.12.x IP assigned)</li> <li>Can ping mesh nodes (10.11.12.1, .2, .3)</li> <li>Cannot reach internet</li> </ul> <p><strong>Solutions:</strong></p> <ol> <li><strong>Check gateway selection:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="c1"># On any node</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a>batctl<span class="w"> </span>gwl
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="c1"># Ensure at least one gateway available (=&gt;)</span>
</span></code></pre></div> <ol> <li><strong>Verify NAT/masquerading:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a>iptables<span class="w"> </span>-t<span class="w"> </span>nat<span class="w"> </span>-L<span class="w"> </span>POSTROUTING<span class="w"> </span>-v<span class="w"> </span>-n
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="c1"># Should show MASQUERADE rule for wan</span>
</span></code></pre></div> <ol> <li><strong>Check WAN connectivity:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="c1"># On each node</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a>ping<span class="w"> </span>-I<span class="w"> </span>wan<span class="w"> </span><span class="m">1</span>.1.1.1
</span></code></pre></div> <ol> <li><strong>Verify DNS:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="c1"># From client</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a>cat<span class="w"> </span>/etc/resolv.conf
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="c1"># Should show: nameserver 10.11.12.1 or public DNS</span>
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a>
</span><span id="__span-93-5"><a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a><span class="c1"># Test DNS</span>
</span><span id="__span-93-6"><a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a>nslookup<span class="w"> </span>google.com
</span></code></pre></div> <ol> <li><strong>Check firewall rules:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a>iptables<span class="w"> </span>-L<span class="w"> </span>FORWARD<span class="w"> </span>-v<span class="w"> </span>-n
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="c1"># Should allow lan -&gt; wan</span>
</span></code></pre></div> <ol> <li><strong>Test with explicit gateway:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="c1"># From client</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">1</span>.1.1.1
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a>traceroute<span class="w"> </span><span class="m">1</span>.1.1.1
</span><span id="__span-95-4"><a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="c1"># Verify path through gateway</span>
</span></code></pre></div> <h3 id="issue-client-connectivity-lost-during-failover">Issue: Client Connectivity Lost During Failover<a class="headerlink" href="#issue-client-connectivity-lost-during-failover" title="Permanent link"></a></h3> <p><strong>Symptoms:</strong></p> <ul> <li>Prolonged connection loss during WAN/node failover</li> <li>Expected 5-30 seconds, experiencing minutes</li> </ul> <p><strong>Solutions:</strong></p> <ol> <li><strong>Check gateway selection interval:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="c1"># Should switch within 30 seconds</span>
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a>watch<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="s1">'batctl gwl'</span>
</span></code></pre></div> <ol> <li><strong>Verify batman routing updates:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a>uci<span class="w"> </span>show<span class="w"> </span>network.bat0.orig_interval
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="c1"># Should be 1000 or less</span>
</span><span id="__span-97-3"><a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a>
</span><span id="__span-97-4"><a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a><span class="c1"># If too high, reduce:</span>
</span><span id="__span-97-5"><a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a>uci<span class="w"> </span><span class="nb">set</span><span class="w"> </span>network.bat0.orig_interval<span class="o">=</span><span class="s1">'500'</span>
</span><span id="__span-97-6"><a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a>uci<span class="w"> </span>commit<span class="w"> </span>network
</span><span id="__span-97-7"><a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a>/etc/init.d/network<span class="w"> </span>restart
</span></code></pre></div> <ol> <li><strong>Check for routing loops:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a>traceroute<span class="w"> </span><span class="m">1</span>.1.1.1
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="c1"># Should be simple path, no loops</span>
</span></code></pre></div> <ol> <li><strong>Verify multiple gateways available:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a>batctl<span class="w"> </span>gwl
</span><span id="__span-99-2"><a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a><span class="c1"># Should list 2-3 gateways with * markers</span>
</span></code></pre></div> <ol> <li><strong>Check client's ARP cache:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="c1"># From client</span>
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a>ip<span class="w"> </span>neigh<span class="w"> </span>flush<span class="w"> </span>all
</span><span id="__span-100-3"><a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a><span class="c1"># Forces ARP refresh</span>
</span></code></pre></div> <h3 id="issue-slow-performance-on-wired-client">Issue: Slow Performance on Wired Client<a class="headerlink" href="#issue-slow-performance-on-wired-client" title="Permanent link"></a></h3> <p><strong>Symptoms:</strong></p> <ul> <li>Wired client getting poor throughput</li> <li>High latency</li> </ul> <p><strong>Solutions:</strong></p> <ol> <li><strong>Check link speed:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="c1"># On router</span>
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a>ethtool<span class="w"> </span>lan1
</span><span id="__span-101-3"><a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="c1"># Should show: 1000baseT/Full</span>
</span></code></pre></div> <ol> <li><strong>Verify not routing through wireless:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a>batctl<span class="w"> </span>o<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A2<span class="w"> </span><span class="s2">"gateway_node"</span>
</span><span id="__span-102-2"><a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a><span class="c1"># Check TQ values - should be 255 for wired</span>
</span></code></pre></div> <ol> <li><strong>Test cable:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="c1"># Swap with known-good cable</span>
</span><span id="__span-103-2"><a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="c1"># Try different port (lan1 vs lan2)</span>
</span></code></pre></div> <ol> <li><strong>Check for packet errors:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a>ip<span class="w"> </span>-s<span class="w"> </span>link<span class="w"> </span>show<span class="w"> </span>lan1
</span><span id="__span-104-2"><a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="c1"># Look for errors, drops</span>
</span></code></pre></div> <ol> <li><strong>Verify MTU:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a>ip<span class="w"> </span>link<span class="w"> </span>show<span class="w"> </span>lan1<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>mtu
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a><span class="c1"># Default 1500 is fine for client ports</span>
</span></code></pre></div> <ol> <li><strong>Test direct to node:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="c1"># From workstation connected to Node2</span>
</span><span id="__span-106-2"><a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a>iperf3<span class="w"> </span>-c<span class="w"> </span><span class="m">10</span>.11.12.2
</span><span id="__span-106-3"><a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="c1"># Should get near-gigabit speeds</span>
</span></code></pre></div> <ol> <li><strong>Test through mesh:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="c1"># From same workstation</span>
</span><span id="__span-107-2"><a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a>iperf3<span class="w"> </span>-c<span class="w"> </span><span class="m">10</span>.11.12.1
</span><span id="__span-107-3"><a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a><span class="c1"># Will be limited by mesh throughput (400-900 Mbps wired)</span>
</span></code></pre></div> <h3 id="issue-high-latency-or-packet-loss">Issue: High Latency or Packet Loss<a class="headerlink" href="#issue-high-latency-or-packet-loss" title="Permanent link"></a></h3> <p><strong>Symptoms:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a>ping<span class="w"> </span><span class="m">10</span>.11.12.2
</span><span id="__span-108-2"><a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a><span class="c1"># Shows high latency or drops</span>
</span></code></pre></div> <p><strong>Solutions:</strong></p> <ol> <li><strong>Check current path:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a>batctl<span class="w"> </span>o<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="m">10</span>.11.12.2
</span><span id="__span-109-2"><a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a><span class="c1"># Verify using wired (TQ 255) not wireless</span>
</span></code></pre></div> <ol> <li><strong>Check for wireless interference:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a>iw<span class="w"> </span>dev<span class="w"> </span>mesh0<span class="w"> </span>scan<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">"freq|signal"</span>
</span></code></pre></div> <ol> <li><strong>Verify no routing loops:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a>traceroute<span class="w"> </span><span class="m">10</span>.11.12.2
</span><span id="__span-111-2"><a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a><span class="c1"># Should be 1-2 hops maximum</span>
</span></code></pre></div> <ol> <li><strong>Check for congestion:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a>batctl<span class="w"> </span>statistics
</span><span id="__span-112-2"><a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a><span class="c1"># Look for dropped packets</span>
</span></code></pre></div> <ol> <li><strong>Adjust batman parameters:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="c1"># Reduce originator interval for faster convergence</span>
</span><span id="__span-113-2"><a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a>uci<span class="w"> </span><span class="nb">set</span><span class="w"> </span>network.bat0.orig_interval<span class="o">=</span><span class="s1">'500'</span>
</span><span id="__span-113-3"><a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a>uci<span class="w"> </span>commit<span class="w"> </span>network
</span><span id="__span-113-4"><a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a>/etc/init.d/network<span class="w"> </span>restart
</span></code></pre></div> <h3 id="issue-vlan-traffic-not-working">Issue: VLAN Traffic Not Working<a class="headerlink" href="#issue-vlan-traffic-not-working" title="Permanent link"></a></h3> <p><strong>Symptoms:</strong></p> <ul> <li>VLAN clients can't communicate</li> <li>Tagged traffic not passing</li> </ul> <p><strong>Solutions:</strong></p> <ol> <li><strong>Verify VLAN interface exists:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a>ip<span class="w"> </span>link<span class="w"> </span>show<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"@bat0"</span>
</span><span id="__span-114-2"><a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a><span class="c1"># Should show vlan.10@bat0, vlan.20@bat0, etc.</span>
</span></code></pre></div> <ol> <li><strong>Check batman VLAN configuration:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a>uci<span class="w"> </span>show<span class="w"> </span>network<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>batadv_vlan
</span></code></pre></div> <ol> <li><strong>Verify bridge contains VLAN interface:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a>brctl<span class="w"> </span>show
</span></code></pre></div> <ol> <li><strong>Test VLAN connectivity:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="c1"># From VLAN interface</span>
</span><span id="__span-117-2"><a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a>ping<span class="w"> </span>-I<span class="w"> </span>br-guest<span class="w"> </span><span class="m">10</span>.11.30.1
</span></code></pre></div> <ol> <li><strong>Check firewall rules for VLAN:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a>iptables<span class="w"> </span>-L<span class="w"> </span>-v<span class="w"> </span>-n<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="m">10</span>.11.30
</span></code></pre></div> <h3 id="issue-frequent-gateway-switching">Issue: Frequent Gateway Switching<a class="headerlink" href="#issue-frequent-gateway-switching" title="Permanent link"></a></h3> <p><strong>Symptoms:</strong></p> <ul> <li><code>batctl gwl</code> shows <code>=&gt;</code> moving between nodes</li> <li>Client connections interrupt</li> </ul> <p><strong>Solutions:</strong></p> <ol> <li><strong>Increase gateway stability:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a><span class="c1"># Make gateway selection more sticky</span>
</span><span id="__span-119-2"><a id="__codelineno-119-2" name="__codelineno-119-2" href="#__codelineno-119-2"></a>uci<span class="w"> </span><span class="nb">set</span><span class="w"> </span>network.bat0.gw_sel_class<span class="o">=</span><span class="s1">'20'</span>
</span><span id="__span-119-3"><a id="__codelineno-119-3" name="__codelineno-119-3" href="#__codelineno-119-3"></a>uci<span class="w"> </span>commit<span class="w"> </span>network
</span><span id="__span-119-4"><a id="__codelineno-119-4" name="__codelineno-119-4" href="#__codelineno-119-4"></a>/etc/init.d/network<span class="w"> </span>restart
</span></code></pre></div> <ol> <li><strong>Ensure consistent bandwidth values:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="c1"># On all nodes, verify same value</span>
</span><span id="__span-120-2"><a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a>uci<span class="w"> </span>show<span class="w"> </span>network.bat0.gw_bandwidth
</span></code></pre></div> <ol> <li><strong>Check for unstable links:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-121-1"><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a>batctl<span class="w"> </span>o
</span><span id="__span-121-2"><a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a><span class="c1"># Look for TQ values fluctuating</span>
</span></code></pre></div> <h3 id="issue-poor-wireless-performance">Issue: Poor Wireless Performance<a class="headerlink" href="#issue-poor-wireless-performance" title="Permanent link"></a></h3> <p><strong>Symptoms:</strong></p> <ul> <li>Slow speeds on WiFi clients</li> <li>Frequent disconnections</li> </ul> <p><strong>Solutions:</strong></p> <ol> <li><strong>Check channel congestion:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-122-1"><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a>iw<span class="w"> </span>dev<span class="w"> </span>wlan0<span class="w"> </span>survey<span class="w"> </span>dump
</span></code></pre></div> <ol> <li><strong>Change WiFi channel:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-123-1"><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a>uci<span class="w"> </span><span class="nb">set</span><span class="w"> </span>wireless.radio1.channel<span class="o">=</span><span class="s1">'149'</span>
</span><span id="__span-123-2"><a id="__codelineno-123-2" name="__codelineno-123-2" href="#__codelineno-123-2"></a>uci<span class="w"> </span>commit<span class="w"> </span>wireless
</span><span id="__span-123-3"><a id="__codelineno-123-3" name="__codelineno-123-3" href="#__codelineno-123-3"></a>wifi<span class="w"> </span>reload
</span></code></pre></div> <ol> <li><strong>Verify country code:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-124-1"><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a>iw<span class="w"> </span>reg<span class="w"> </span>get
</span><span id="__span-124-2"><a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a><span class="c1"># Should show AU</span>
</span></code></pre></div> <ol> <li><strong>Check TX power:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-125-1"><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a>iw<span class="w"> </span>dev<span class="w"> </span>wlan0<span class="w"> </span>info<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>txpower
</span></code></pre></div> <ol> <li><strong>Optimize 802.11r settings:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-126-1"><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="c1"># Adjust timeouts</span>
</span><span id="__span-126-2"><a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a>uci<span class="w"> </span><span class="nb">set</span><span class="w"> </span>wireless.wlan0.reassociation_deadline<span class="o">=</span><span class="s1">'20000'</span>
</span><span id="__span-126-3"><a id="__codelineno-126-3" name="__codelineno-126-3" href="#__codelineno-126-3"></a>uci<span class="w"> </span>commit<span class="w"> </span>wireless
</span><span id="__span-126-4"><a id="__codelineno-126-4" name="__codelineno-126-4" href="#__codelineno-126-4"></a>wifi<span class="w"> </span>reload
</span></code></pre></div> <h3 id="issue-configuration-not-persisting">Issue: Configuration Not Persisting<a class="headerlink" href="#issue-configuration-not-persisting" title="Permanent link"></a></h3> <p><strong>Symptoms:</strong></p> <ul> <li>Changes revert after reboot</li> <li>UCI changes don't apply</li> </ul> <p><strong>Solutions:</strong></p> <ol> <li><strong>Always commit changes:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-127-1"><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a>uci<span class="w"> </span>commit
</span></code></pre></div> <ol> <li><strong>Verify changes saved:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-128-1"><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a>uci<span class="w"> </span>show<span class="w"> </span>network.bat0
</span></code></pre></div> <ol> <li><strong>Check for file system issues:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-129-1"><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a>df<span class="w"> </span>-h
</span><span id="__span-129-2"><a id="__codelineno-129-2" name="__codelineno-129-2" href="#__codelineno-129-2"></a><span class="c1"># Ensure /overlay not full</span>
</span></code></pre></div> <ol> <li><strong>Force config reload:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-130-1"><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a>/etc/init.d/network<span class="w"> </span>reload
</span></code></pre></div> <hr> <h2 id="advanced-tuning">Advanced Tuning<a class="headerlink" href="#advanced-tuning" title="Permanent link"></a></h2> <h3 id="batman-adv-algorithm-selection">Batman-adv Algorithm Selection<a class="headerlink" href="#batman-adv-algorithm-selection" title="Permanent link"></a></h3> <p><strong>BATMAN_IV (Legacy):</strong></p> <ul> <li>Simpler, lower overhead</li> <li>Good for stable topologies</li> </ul> <p><strong>BATMAN_V (Recommended):</strong></p> <ul> <li>Better multi-gateway support</li> <li>Considers throughput metrics</li> <li>Faster convergence</li> </ul> <p>To change:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-131-1"><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a>uci<span class="w"> </span><span class="nb">set</span><span class="w"> </span>network.bat0.routing_algo<span class="o">=</span><span class="s1">'BATMAN_IV'</span>
</span><span id="__span-131-2"><a id="__codelineno-131-2" name="__codelineno-131-2" href="#__codelineno-131-2"></a><span class="c1"># or</span>
</span><span id="__span-131-3"><a id="__codelineno-131-3" name="__codelineno-131-3" href="#__codelineno-131-3"></a>uci<span class="w"> </span><span class="nb">set</span><span class="w"> </span>network.bat0.routing_algo<span class="o">=</span><span class="s1">'BATMAN_V'</span>
</span><span id="__span-131-4"><a id="__codelineno-131-4" name="__codelineno-131-4" href="#__codelineno-131-4"></a>uci<span class="w"> </span>commit<span class="w"> </span>network
</span><span id="__span-131-5"><a id="__codelineno-131-5" name="__codelineno-131-5" href="#__codelineno-131-5"></a>/etc/init.d/network<span class="w"> </span>restart
</span></code></pre></div> <h3 id="optimize-for-different-scenarios">Optimize for Different Scenarios<a class="headerlink" href="#optimize-for-different-scenarios" title="Permanent link"></a></h3> <h4 id="low-latency-gaming-voip">Low-Latency (Gaming, VoIP)<a class="headerlink" href="#low-latency-gaming-voip" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-132-1"><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a>uci<span class="w"> </span><span class="nb">set</span><span class="w"> </span>network.bat0.orig_interval<span class="o">=</span><span class="s1">'500'</span>
</span><span id="__span-132-2"><a id="__codelineno-132-2" name="__codelineno-132-2" href="#__codelineno-132-2"></a>uci<span class="w"> </span><span class="nb">set</span><span class="w"> </span>network.bat0.hop_penalty<span class="o">=</span><span class="s1">'10'</span>
</span><span id="__span-132-3"><a id="__codelineno-132-3" name="__codelineno-132-3" href="#__codelineno-132-3"></a>uci<span class="w"> </span>commit<span class="w"> </span>network
</span></code></pre></div> <h4 id="maximum-throughput">Maximum Throughput<a class="headerlink" href="#maximum-throughput" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-133-1"><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a>uci<span class="w"> </span><span class="nb">set</span><span class="w"> </span>network.bat0.aggregated_ogms<span class="o">=</span><span class="s1">'1'</span>
</span><span id="__span-133-2"><a id="__codelineno-133-2" name="__codelineno-133-2" href="#__codelineno-133-2"></a>uci<span class="w"> </span><span class="nb">set</span><span class="w"> </span>network.bat0.network_coding<span class="o">=</span><span class="s1">'1'</span>
</span><span id="__span-133-3"><a id="__codelineno-133-3" name="__codelineno-133-3" href="#__codelineno-133-3"></a>uci<span class="w"> </span>commit<span class="w"> </span>network
</span></code></pre></div> <h4 id="high-density-clients">High-Density Clients<a class="headerlink" href="#high-density-clients" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-134-1"><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a>uci<span class="w"> </span><span class="nb">set</span><span class="w"> </span>network.bat0.multicast_fanout<span class="o">=</span><span class="s1">'32'</span>
</span><span id="__span-134-2"><a id="__codelineno-134-2" name="__codelineno-134-2" href="#__codelineno-134-2"></a>uci<span class="w"> </span><span class="nb">set</span><span class="w"> </span>network.bat0.distributed_arp_table<span class="o">=</span><span class="s1">'1'</span>
</span><span id="__span-134-3"><a id="__codelineno-134-3" name="__codelineno-134-3" href="#__codelineno-134-3"></a>uci<span class="w"> </span>commit<span class="w"> </span>network
</span></code></pre></div> <h3 id="qos-over-mesh">QoS Over Mesh<a class="headerlink" href="#qos-over-mesh" title="Permanent link"></a></h3> <p>To prioritize traffic types:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-135-1"><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a>opkg<span class="w"> </span>install<span class="w"> </span>qos-scripts
</span><span id="__span-135-2"><a id="__codelineno-135-2" name="__codelineno-135-2" href="#__codelineno-135-2"></a>
</span><span id="__span-135-3"><a id="__codelineno-135-3" name="__codelineno-135-3" href="#__codelineno-135-3"></a><span class="c1"># Edit /etc/config/qos</span>
</span><span id="__span-135-4"><a id="__codelineno-135-4" name="__codelineno-135-4" href="#__codelineno-135-4"></a><span class="c1"># See OpenWrt QoS documentation</span>
</span></code></pre></div> <hr> <h2 id="backup-recovery">Backup &amp; Recovery<a class="headerlink" href="#backup-recovery" title="Permanent link"></a></h2> <h3 id="backup-configuration">Backup Configuration<a class="headerlink" href="#backup-configuration" title="Permanent link"></a></h3> <p><strong>Create backup of all nodes:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-136-1"><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a><span class="c1"># On each node</span>
</span><span id="__span-136-2"><a id="__codelineno-136-2" name="__codelineno-136-2" href="#__codelineno-136-2"></a>ssh<span class="w"> </span>root@10.11.12.1<span class="w"> </span><span class="s1">'sysupgrade -b /tmp/backup-node1.tar.gz'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-136-3"><a id="__codelineno-136-3" name="__codelineno-136-3" href="#__codelineno-136-3"></a>scp<span class="w"> </span>root@10.11.12.1:/tmp/backup-node1.tar.gz<span class="w"> </span>./
</span><span id="__span-136-4"><a id="__codelineno-136-4" name="__codelineno-136-4" href="#__codelineno-136-4"></a>
</span><span id="__span-136-5"><a id="__codelineno-136-5" name="__codelineno-136-5" href="#__codelineno-136-5"></a>ssh<span class="w"> </span>root@10.11.12.2<span class="w"> </span><span class="s1">'sysupgrade -b /tmp/backup-node2.tar.gz'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-136-6"><a id="__codelineno-136-6" name="__codelineno-136-6" href="#__codelineno-136-6"></a>scp<span class="w"> </span>root@10.11.12.2:/tmp/backup-node2.tar.gz<span class="w"> </span>./
</span><span id="__span-136-7"><a id="__codelineno-136-7" name="__codelineno-136-7" href="#__codelineno-136-7"></a>
</span><span id="__span-136-8"><a id="__codelineno-136-8" name="__codelineno-136-8" href="#__codelineno-136-8"></a>ssh<span class="w"> </span>root@10.11.12.3<span class="w"> </span><span class="s1">'sysupgrade -b /tmp/backup-node3.tar.gz'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-136-9"><a id="__codelineno-136-9" name="__codelineno-136-9" href="#__codelineno-136-9"></a>scp<span class="w"> </span>root@10.11.12.3:/tmp/backup-node3.tar.gz<span class="w"> </span>./
</span></code></pre></div> <h3 id="restore-configuration">Restore Configuration<a class="headerlink" href="#restore-configuration" title="Permanent link"></a></h3> <div class="language-bash highlight"><pre><span></span><code><span id="__span-137-1"><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a><span class="c1"># Copy backup to node</span>
</span><span id="__span-137-2"><a id="__codelineno-137-2" name="__codelineno-137-2" href="#__codelineno-137-2"></a>scp<span class="w"> </span>backup-node1.tar.gz<span class="w"> </span>root@10.11.12.1:/tmp/
</span><span id="__span-137-3"><a id="__codelineno-137-3" name="__codelineno-137-3" href="#__codelineno-137-3"></a>
</span><span id="__span-137-4"><a id="__codelineno-137-4" name="__codelineno-137-4" href="#__codelineno-137-4"></a><span class="c1"># SSH to node and restore</span>
</span><span id="__span-137-5"><a id="__codelineno-137-5" name="__codelineno-137-5" href="#__codelineno-137-5"></a>ssh<span class="w"> </span>root@10.11.12.1
</span><span id="__span-137-6"><a id="__codelineno-137-6" name="__codelineno-137-6" href="#__codelineno-137-6"></a>sysupgrade<span class="w"> </span>-r<span class="w"> </span>/tmp/backup-node1.tar.gz
</span><span id="__span-137-7"><a id="__codelineno-137-7" name="__codelineno-137-7" href="#__codelineno-137-7"></a>reboot
</span></code></pre></div> <h3 id="configuration-version-control">Configuration Version Control<a class="headerlink" href="#configuration-version-control" title="Permanent link"></a></h3> <p>Consider storing configs in git:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-138-1"><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="c1"># On your management machine</span>
</span><span id="__span-138-2"><a id="__codelineno-138-2" name="__codelineno-138-2" href="#__codelineno-138-2"></a>mkdir<span class="w"> </span>openwrt-configs
</span><span id="__span-138-3"><a id="__codelineno-138-3" name="__codelineno-138-3" href="#__codelineno-138-3"></a><span class="nb">cd</span><span class="w"> </span>openwrt-configs
</span><span id="__span-138-4"><a id="__codelineno-138-4" name="__codelineno-138-4" href="#__codelineno-138-4"></a>git<span class="w"> </span>init
</span><span id="__span-138-5"><a id="__codelineno-138-5" name="__codelineno-138-5" href="#__codelineno-138-5"></a>
</span><span id="__span-138-6"><a id="__codelineno-138-6" name="__codelineno-138-6" href="#__codelineno-138-6"></a><span class="c1"># Pull configs from all nodes</span>
</span><span id="__span-138-7"><a id="__codelineno-138-7" name="__codelineno-138-7" href="#__codelineno-138-7"></a><span class="k">for</span><span class="w"> </span>node<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-138-8"><a id="__codelineno-138-8" name="__codelineno-138-8" href="#__codelineno-138-8"></a><span class="w">    </span>mkdir<span class="w"> </span>node<span class="nv">$node</span>
</span><span id="__span-138-9"><a id="__codelineno-138-9" name="__codelineno-138-9" href="#__codelineno-138-9"></a><span class="w">    </span>scp<span class="w"> </span>-r<span class="w"> </span>root@10.11.12.<span class="nv">$node</span>:/etc/config/*<span class="w"> </span>node<span class="nv">$node</span>/
</span><span id="__span-138-10"><a id="__codelineno-138-10" name="__codelineno-138-10" href="#__codelineno-138-10"></a><span class="k">done</span>
</span><span id="__span-138-11"><a id="__codelineno-138-11" name="__codelineno-138-11" href="#__codelineno-138-11"></a>
</span><span id="__span-138-12"><a id="__codelineno-138-12" name="__codelineno-138-12" href="#__codelineno-138-12"></a>git<span class="w"> </span>add<span class="w"> </span>.
</span><span id="__span-138-13"><a id="__codelineno-138-13" name="__codelineno-138-13" href="#__codelineno-138-13"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">"Initial mesh configuration"</span>
</span></code></pre></div> <hr> <h2 id="security-considerations">Security Considerations<a class="headerlink" href="#security-considerations" title="Permanent link"></a></h2> <h3 id="mesh-security">Mesh Security<a class="headerlink" href="#mesh-security" title="Permanent link"></a></h3> <p> <strong>Configured:</strong></p> <ul> <li>WPA3-SAE encryption on mesh (2.4GHz)</li> <li>WPA2+CCMP on client AP (5GHz)</li> </ul> <p> <strong>Additional Recommendations:</strong></p> <ol> <li><strong>Change default passwords:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-139-1"><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a><span class="c1"># On each node</span>
</span><span id="__span-139-2"><a id="__codelineno-139-2" name="__codelineno-139-2" href="#__codelineno-139-2"></a>passwd
</span><span id="__span-139-3"><a id="__codelineno-139-3" name="__codelineno-139-3" href="#__codelineno-139-3"></a><span class="c1"># Use strong, unique passwords</span>
</span></code></pre></div> <ol> <li> <p><strong>Disable WPS:</strong> Already disabled in config (not specified = disabled)</p> </li> <li> <p><strong>Enable SSH key authentication:</strong></p> </li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-140-1"><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a><span class="c1"># On your management machine</span>
</span><span id="__span-140-2"><a id="__codelineno-140-2" name="__codelineno-140-2" href="#__codelineno-140-2"></a>ssh-keygen<span class="w"> </span>-t<span class="w"> </span>ed25519
</span><span id="__span-140-3"><a id="__codelineno-140-3" name="__codelineno-140-3" href="#__codelineno-140-3"></a>
</span><span id="__span-140-4"><a id="__codelineno-140-4" name="__codelineno-140-4" href="#__codelineno-140-4"></a><span class="c1"># Copy to each node</span>
</span><span id="__span-140-5"><a id="__codelineno-140-5" name="__codelineno-140-5" href="#__codelineno-140-5"></a>ssh-copy-id<span class="w"> </span>root@10.11.12.1
</span><span id="__span-140-6"><a id="__codelineno-140-6" name="__codelineno-140-6" href="#__codelineno-140-6"></a>ssh-copy-id<span class="w"> </span>root@10.11.12.2
</span><span id="__span-140-7"><a id="__codelineno-140-7" name="__codelineno-140-7" href="#__codelineno-140-7"></a>ssh-copy-id<span class="w"> </span>root@10.11.12.3
</span><span id="__span-140-8"><a id="__codelineno-140-8" name="__codelineno-140-8" href="#__codelineno-140-8"></a>
</span><span id="__span-140-9"><a id="__codelineno-140-9" name="__codelineno-140-9" href="#__codelineno-140-9"></a><span class="c1"># Disable password authentication (optional)  # pragma: allowlist secret</span>
</span><span id="__span-140-10"><a id="__codelineno-140-10" name="__codelineno-140-10" href="#__codelineno-140-10"></a><span class="c1"># Edit /etc/ssh/sshd_config and set:</span>
</span><span id="__span-140-11"><a id="__codelineno-140-11" name="__codelineno-140-11" href="#__codelineno-140-11"></a><span class="c1"># PasswordAuthentication no</span>
</span><span id="__span-140-12"><a id="__codelineno-140-12" name="__codelineno-140-12" href="#__codelineno-140-12"></a><span class="c1"># Then restart SSH:</span>
</span><span id="__span-140-13"><a id="__codelineno-140-13" name="__codelineno-140-13" href="#__codelineno-140-13"></a>/etc/init.d/sshd<span class="w"> </span>restart
</span></code></pre></div> <ol> <li><strong>Firewall hardening:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-141-1"><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a><span class="c1"># Drop invalid packets</span>
</span><span id="__span-141-2"><a id="__codelineno-141-2" name="__codelineno-141-2" href="#__codelineno-141-2"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>INVALID<span class="w"> </span>-j<span class="w"> </span>DROP
</span><span id="__span-141-3"><a id="__codelineno-141-3" name="__codelineno-141-3" href="#__codelineno-141-3"></a>
</span><span id="__span-141-4"><a id="__codelineno-141-4" name="__codelineno-141-4" href="#__codelineno-141-4"></a><span class="c1"># Rate limit SSH</span>
</span><span id="__span-141-5"><a id="__codelineno-141-5" name="__codelineno-141-5" href="#__codelineno-141-5"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">22</span><span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW<span class="w"> </span>-m<span class="w"> </span>recent<span class="w"> </span>--set
</span><span id="__span-141-6"><a id="__codelineno-141-6" name="__codelineno-141-6" href="#__codelineno-141-6"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">22</span><span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW<span class="w"> </span>-m<span class="w"> </span>recent<span class="w"> </span>--update<span class="w"> </span>--seconds<span class="w"> </span><span class="m">60</span><span class="w"> </span>--hitcount<span class="w"> </span><span class="m">4</span><span class="w"> </span>-j<span class="w"> </span>DROP
</span></code></pre></div> <ol> <li><strong>Disable unused services:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-142-1"><a id="__codelineno-142-1" name="__codelineno-142-1" href="#__codelineno-142-1"></a>/etc/init.d/uhttpd<span class="w"> </span>stop
</span><span id="__span-142-2"><a id="__codelineno-142-2" name="__codelineno-142-2" href="#__codelineno-142-2"></a>/etc/init.d/uhttpd<span class="w"> </span>disable<span class="w">  </span><span class="c1"># If you don't use LuCI remotely</span>
</span></code></pre></div> <ol> <li><strong>Regular updates:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-143-1"><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a>opkg<span class="w"> </span>update
</span><span id="__span-143-2"><a id="__codelineno-143-2" name="__codelineno-143-2" href="#__codelineno-143-2"></a>opkg<span class="w"> </span>list-upgradable
</span><span id="__span-143-3"><a id="__codelineno-143-3" name="__codelineno-143-3" href="#__codelineno-143-3"></a>opkg<span class="w"> </span>upgrade<span class="w"> </span>&lt;package&gt;
</span></code></pre></div> <h3 id="network-segmentation">Network Segmentation<a class="headerlink" href="#network-segmentation" title="Permanent link"></a></h3> <p>With VLAN configuration, ensure:</p> <ul> <li>Management VLAN (10) restricted to admin devices only</li> <li>Guest VLAN (30) fully isolated from LAN</li> <li>IoT VLAN (40) restricted to internet-only, no local access</li> </ul> <h3 id="monitoring-for-security">Monitoring for Security<a class="headerlink" href="#monitoring-for-security" title="Permanent link"></a></h3> <div class="language-bash highlight"><pre><span></span><code><span id="__span-144-1"><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a><span class="c1"># Watch for unauthorized mesh joins</span>
</span><span id="__span-144-2"><a id="__codelineno-144-2" name="__codelineno-144-2" href="#__codelineno-144-2"></a>logread<span class="w"> </span>-f<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">"new mesh"</span>
</span><span id="__span-144-3"><a id="__codelineno-144-3" name="__codelineno-144-3" href="#__codelineno-144-3"></a>
</span><span id="__span-144-4"><a id="__codelineno-144-4" name="__codelineno-144-4" href="#__codelineno-144-4"></a><span class="c1"># Monitor failed login attempts</span>
</span><span id="__span-144-5"><a id="__codelineno-144-5" name="__codelineno-144-5" href="#__codelineno-144-5"></a>logread<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">"auth.*fail"</span>
</span><span id="__span-144-6"><a id="__codelineno-144-6" name="__codelineno-144-6" href="#__codelineno-144-6"></a>
</span><span id="__span-144-7"><a id="__codelineno-144-7" name="__codelineno-144-7" href="#__codelineno-144-7"></a><span class="c1"># Check for unusual traffic</span>
</span><span id="__span-144-8"><a id="__codelineno-144-8" name="__codelineno-144-8" href="#__codelineno-144-8"></a>iptraf-ng<span class="w">  </span><span class="c1"># opkg install iptraf-ng</span>
</span></code></pre></div> <hr> <h2 id="performance-expectations">Performance Expectations<a class="headerlink" href="#performance-expectations" title="Permanent link"></a></h2> <h3 id="throughput-benchmarks">Throughput Benchmarks<a class="headerlink" href="#throughput-benchmarks" title="Permanent link"></a></h3> <p><strong>Wired Mesh (Full Ring Active):</strong></p> <ul> <li>Direct connection (1 hop): 400-900 Mbps</li> <li>Via intermediate node (2 hops): 200-600 Mbps</li> </ul> <p><strong>Wireless Mesh Backup (2.4GHz):</strong></p> <ul> <li>Good signal (-60 dBm): 80-150 Mbps</li> <li>Fair signal (-70 dBm): 40-80 Mbps</li> <li>Weak signal (-80 dBm): 10-40 Mbps</li> </ul> <p><strong>Client WiFi (5GHz AP):</strong></p> <ul> <li>802.11ac VHT80: 300-600 Mbps typical</li> <li>802.11ac VHT40: 150-300 Mbps typical</li> </ul> <h3 id="latency-benchmarks">Latency Benchmarks<a class="headerlink" href="#latency-benchmarks" title="Permanent link"></a></h3> <p><strong>Wired:</strong></p> <ul> <li>Direct: &lt;2ms</li> <li>Via intermediate: 2-5ms</li> </ul> <p><strong>Wireless:</strong></p> <ul> <li>Single hop: 5-15ms</li> <li>Multi-hop: 15-30ms</li> </ul> <p><strong>Failover Times:</strong></p> <ul> <li>Wire to wire: &lt;1 second</li> <li>Wire to wireless: 1-3 seconds</li> <li>Gateway switch: 5-30 seconds</li> </ul> <hr> <h2 id="maintenance-schedule">Maintenance Schedule<a class="headerlink" href="#maintenance-schedule" title="Permanent link"></a></h2> <h3 id="daily">Daily<a class="headerlink" href="#daily" title="Permanent link"></a></h3> <ul> <li>Monitor gateway status</li> <li>Check batman originator table</li> <li>Verify internet connectivity</li> </ul> <h3 id="weekly">Weekly<a class="headerlink" href="#weekly" title="Permanent link"></a></h3> <ul> <li>Review logs for errors</li> <li>Check interface statistics</li> <li>Verify all paths active</li> <li>Run performance tests</li> </ul> <h3 id="monthly">Monthly<a class="headerlink" href="#monthly" title="Permanent link"></a></h3> <ul> <li>Update packages</li> <li>Review and rotate logs</li> <li>Verify backups</li> <li>Test failover scenarios</li> </ul> <h3 id="quarterly">Quarterly<a class="headerlink" href="#quarterly" title="Permanent link"></a></h3> <ul> <li>Full firmware update (if stable version available)</li> <li>Security audit</li> <li>Performance baseline testing</li> <li>Configuration backup refresh</li> </ul> <hr> <h2 id="additional-resources">Additional Resources<a class="headerlink" href="#additional-resources" title="Permanent link"></a></h2> <h3 id="openwrt-documentation">OpenWrt Documentation<a class="headerlink" href="#openwrt-documentation" title="Permanent link"></a></h3> <ul> <li>Main site: <a href="https://openwrt.org">https://openwrt.org</a></li> <li>Batman-adv: <a href="https://openwrt.org/docs/guide-user/network/wifi/mesh/batman">https://openwrt.org/docs/guide-user/network/wifi/mesh/batman</a></li> <li>Wireless: <a href="https://openwrt.org/docs/guide-user/network/wifi/start">https://openwrt.org/docs/guide-user/network/wifi/start</a></li> </ul> <h3 id="batman-adv-project">Batman-adv Project<a class="headerlink" href="#batman-adv-project" title="Permanent link"></a></h3> <ul> <li>Homepage: <a href="https://www.open-mesh.org/projects/batman-adv">https://www.open-mesh.org/projects/batman-adv</a></li> <li>Documentation: <a href="https://www.open-mesh.org/projects/batman-adv/wiki">https://www.open-mesh.org/projects/batman-adv/wiki</a></li> <li>Mailing list: <a href="mailto:b.a.t.m.a.n@lists.open-mesh.org">b.a.t.m.a.n@lists.open-mesh.org</a></li> </ul> <h3 id="community-resources">Community Resources<a class="headerlink" href="#community-resources" title="Permanent link"></a></h3> <ul> <li>OpenWrt Forum: <a href="https://forum.openwrt.org">https://forum.openwrt.org</a></li> <li>Reddit: r/openwrt</li> <li>IRC: #openwrt on OFTC</li> </ul> <h3 id="tools">Tools<a class="headerlink" href="#tools" title="Permanent link"></a></h3> <ul> <li>WiFi Analyzer (Android/iOS) - for channel planning</li> <li>Angry IP Scanner - for network discovery</li> <li>WinBox/MikroTik tools - for advanced network testing</li> </ul> <hr> <h2 id="quick-reference-guide">Quick Reference Guide<a class="headerlink" href="#quick-reference-guide" title="Permanent link"></a></h2> <h3 id="common-client-connection-scenarios">Common Client Connection Scenarios<a class="headerlink" href="#common-client-connection-scenarios" title="Permanent link"></a></h3> <h4 id="connecting-a-workstation-wired">Connecting a Workstation (Wired)<a class="headerlink" href="#connecting-a-workstation-wired" title="Permanent link"></a></h4> <ol> <li><strong>Plug ethernet cable</strong> into LAN1 or LAN2 on any node</li> <li><strong>Workstation gets DHCP automatically:</strong></li> <li>IP: 10.11.12.100-250</li> <li>Gateway: 10.11.12.1</li> <li>DNS: 1.1.1.1, 8.8.8.8</li> <li><strong>Verify connectivity:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-145-1"><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a>ping<span class="w"> </span><span class="m">10</span>.11.12.1<span class="w">  </span><span class="c1"># Node 1</span>
</span><span id="__span-145-2"><a id="__codelineno-145-2" name="__codelineno-145-2" href="#__codelineno-145-2"></a>ping<span class="w"> </span><span class="m">10</span>.11.12.2<span class="w">  </span><span class="c1"># Node 2</span>
</span><span id="__span-145-3"><a id="__codelineno-145-3" name="__codelineno-145-3" href="#__codelineno-145-3"></a>ping<span class="w"> </span><span class="m">10</span>.11.12.3<span class="w">  </span><span class="c1"># Node 3</span>
</span><span id="__span-145-4"><a id="__codelineno-145-4" name="__codelineno-145-4" href="#__codelineno-145-4"></a>ping<span class="w"> </span><span class="m">1</span>.1.1.1<span class="w">     </span><span class="c1"># Internet</span>
</span></code></pre></div> <h4 id="connecting-multiple-workstations">Connecting Multiple Workstations<a class="headerlink" href="#connecting-multiple-workstations" title="Permanent link"></a></h4> <ul> <li><strong>Up to 6 wired devices:</strong> 2 per node (LAN1, LAN2)</li> <li><strong>Need more?</strong> Add unmanaged switch to any LAN1/LAN2 port</li> <li><strong>All on same network:</strong> 10.11.12.0/24</li> <li><strong>All share redundancy:</strong> Automatic failover if their node loses WAN</li> </ul> <h4 id="setting-static-ip-for-a-device">Setting Static IP for a Device<a class="headerlink" href="#setting-static-ip-for-a-device" title="Permanent link"></a></h4> <p><strong>On Node 1</strong> (<code>/etc/config/dhcp</code>):</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-146-1"><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a>config<span class="w"> </span>host
</span><span id="__span-146-2"><a id="__codelineno-146-2" name="__codelineno-146-2" href="#__codelineno-146-2"></a><span class="w">    </span>option<span class="w"> </span>name<span class="w"> </span><span class="s1">'my-device'</span>
</span><span id="__span-146-3"><a id="__codelineno-146-3" name="__codelineno-146-3" href="#__codelineno-146-3"></a><span class="w">    </span>option<span class="w"> </span>mac<span class="w"> </span><span class="s1">'AA:BB:CC:DD:EE:FF'</span>
</span><span id="__span-146-4"><a id="__codelineno-146-4" name="__codelineno-146-4" href="#__codelineno-146-4"></a><span class="w">    </span>option<span class="w"> </span>ip<span class="w"> </span><span class="s1">'10.11.12.10'</span>
</span></code></pre></div> <p>Then restart dnsmasq:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-147-1"><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a>/etc/init.d/dnsmasq<span class="w"> </span>restart
</span></code></pre></div> <h4 id="moving-a-device-between-nodes">Moving a Device Between Nodes<a class="headerlink" href="#moving-a-device-between-nodes" title="Permanent link"></a></h4> <ol> <li><strong>Note current IP</strong> (e.g., 10.11.12.105)</li> <li><strong>Unplug from Node A</strong></li> <li><strong>Plug into Node B</strong> (LAN1 or LAN2)</li> <li><strong>Same IP maintained</strong> (DHCP lease preserved)</li> <li><strong>Connectivity continues</strong> seamlessly</li> </ol> <h3 id="common-monitoring-commands">Common Monitoring Commands<a class="headerlink" href="#common-monitoring-commands" title="Permanent link"></a></h3> <h4 id="check-mesh-status">Check Mesh Status<a class="headerlink" href="#check-mesh-status" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-148-1"><a id="__codelineno-148-1" name="__codelineno-148-1" href="#__codelineno-148-1"></a>batctl<span class="w"> </span>o<span class="w">              </span><span class="c1"># Mesh topology</span>
</span><span id="__span-148-2"><a id="__codelineno-148-2" name="__codelineno-148-2" href="#__codelineno-148-2"></a>batctl<span class="w"> </span>gwl<span class="w">            </span><span class="c1"># Gateway status</span>
</span><span id="__span-148-3"><a id="__codelineno-148-3" name="__codelineno-148-3" href="#__codelineno-148-3"></a>batctl<span class="w"> </span><span class="k">if</span><span class="w">             </span><span class="c1"># Batman interfaces</span>
</span><span id="__span-148-4"><a id="__codelineno-148-4" name="__codelineno-148-4" href="#__codelineno-148-4"></a>batctl<span class="w"> </span>n<span class="w">              </span><span class="c1"># Neighbor details</span>
</span></code></pre></div> <h4 id="check-connectivity">Check Connectivity<a class="headerlink" href="#check-connectivity" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-149-1"><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a>ping<span class="w"> </span><span class="m">10</span>.11.12.1<span class="w">       </span><span class="c1"># Node 1</span>
</span><span id="__span-149-2"><a id="__codelineno-149-2" name="__codelineno-149-2" href="#__codelineno-149-2"></a>ping<span class="w"> </span><span class="m">10</span>.11.12.2<span class="w">       </span><span class="c1"># Node 2  </span>
</span><span id="__span-149-3"><a id="__codelineno-149-3" name="__codelineno-149-3" href="#__codelineno-149-3"></a>ping<span class="w"> </span><span class="m">10</span>.11.12.3<span class="w">       </span><span class="c1"># Node 3</span>
</span><span id="__span-149-4"><a id="__codelineno-149-4" name="__codelineno-149-4" href="#__codelineno-149-4"></a>ping<span class="w"> </span><span class="m">1</span>.1.1.1<span class="w">          </span><span class="c1"># Internet via gateway</span>
</span><span id="__span-149-5"><a id="__codelineno-149-5" name="__codelineno-149-5" href="#__codelineno-149-5"></a>
</span><span id="__span-149-6"><a id="__codelineno-149-6" name="__codelineno-149-6" href="#__codelineno-149-6"></a>traceroute<span class="w"> </span><span class="m">1</span>.1.1.1<span class="w">    </span><span class="c1"># Show path to internet</span>
</span></code></pre></div> <h4 id="check-physical-links">Check Physical Links<a class="headerlink" href="#check-physical-links" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-150-1"><a id="__codelineno-150-1" name="__codelineno-150-1" href="#__codelineno-150-1"></a>ip<span class="w"> </span>link<span class="w"> </span>show<span class="w"> </span>lan1<span class="w">     </span><span class="c1"># Client port 1</span>
</span><span id="__span-150-2"><a id="__codelineno-150-2" name="__codelineno-150-2" href="#__codelineno-150-2"></a>ip<span class="w"> </span>link<span class="w"> </span>show<span class="w"> </span>lan2<span class="w">     </span><span class="c1"># Client port 2</span>
</span><span id="__span-150-3"><a id="__codelineno-150-3" name="__codelineno-150-3" href="#__codelineno-150-3"></a>ip<span class="w"> </span>link<span class="w"> </span>show<span class="w"> </span>lan3<span class="w">     </span><span class="c1"># Mesh port 1</span>
</span><span id="__span-150-4"><a id="__codelineno-150-4" name="__codelineno-150-4" href="#__codelineno-150-4"></a>ip<span class="w"> </span>link<span class="w"> </span>show<span class="w"> </span>lan4<span class="w">     </span><span class="c1"># Mesh port 2</span>
</span><span id="__span-150-5"><a id="__codelineno-150-5" name="__codelineno-150-5" href="#__codelineno-150-5"></a>ip<span class="w"> </span>link<span class="w"> </span>show<span class="w"> </span>mesh0<span class="w">    </span><span class="c1"># Wireless mesh</span>
</span><span id="__span-150-6"><a id="__codelineno-150-6" name="__codelineno-150-6" href="#__codelineno-150-6"></a>
</span><span id="__span-150-7"><a id="__codelineno-150-7" name="__codelineno-150-7" href="#__codelineno-150-7"></a>ethtool<span class="w"> </span>lan3<span class="w">          </span><span class="c1"># Detailed link info</span>
</span></code></pre></div> <h4 id="check-client-list">Check Client List<a class="headerlink" href="#check-client-list" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-151-1"><a id="__codelineno-151-1" name="__codelineno-151-1" href="#__codelineno-151-1"></a>batctl<span class="w"> </span>tl<span class="w">             </span><span class="c1"># Translation table (all clients)</span>
</span><span id="__span-151-2"><a id="__codelineno-151-2" name="__codelineno-151-2" href="#__codelineno-151-2"></a>arp<span class="w"> </span>-a<span class="w">                </span><span class="c1"># ARP table (recently seen)</span>
</span><span id="__span-151-3"><a id="__codelineno-151-3" name="__codelineno-151-3" href="#__codelineno-151-3"></a>cat<span class="w"> </span>/tmp/dhcp.leases<span class="w">  </span><span class="c1"># DHCP leases (Node 1 only)</span>
</span></code></pre></div> <h4 id="check-performance">Check Performance<a class="headerlink" href="#check-performance" title="Permanent link"></a></h4> <div class="language-bash highlight"><pre><span></span><code><span id="__span-152-1"><a id="__codelineno-152-1" name="__codelineno-152-1" href="#__codelineno-152-1"></a>iperf3<span class="w"> </span>-c<span class="w"> </span><span class="m">10</span>.11.12.2<span class="w">  </span><span class="c1"># Throughput test to Node 2</span>
</span><span id="__span-152-2"><a id="__codelineno-152-2" name="__codelineno-152-2" href="#__codelineno-152-2"></a>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">10</span>.11.12.2<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1<span class="w">  </span><span class="c1"># Latency stats</span>
</span></code></pre></div> <h3 id="emergency-procedures">Emergency Procedures<a class="headerlink" href="#emergency-procedures" title="Permanent link"></a></h3> <h4 id="complete-mesh-down">Complete Mesh Down<a class="headerlink" href="#complete-mesh-down" title="Permanent link"></a></h4> <p><strong>Symptoms:</strong> All batman interfaces inactive</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-153-1"><a id="__codelineno-153-1" name="__codelineno-153-1" href="#__codelineno-153-1"></a>batctl<span class="w"> </span><span class="k">if</span>
</span><span id="__span-153-2"><a id="__codelineno-153-2" name="__codelineno-153-2" href="#__codelineno-153-2"></a><span class="c1"># Shows: No interfaces</span>
</span></code></pre></div> <p><strong>Recovery:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-154-1"><a id="__codelineno-154-1" name="__codelineno-154-1" href="#__codelineno-154-1"></a>/etc/init.d/network<span class="w"> </span>restart
</span><span id="__span-154-2"><a id="__codelineno-154-2" name="__codelineno-154-2" href="#__codelineno-154-2"></a><span class="c1"># Wait 30 seconds</span>
</span><span id="__span-154-3"><a id="__codelineno-154-3" name="__codelineno-154-3" href="#__codelineno-154-3"></a>batctl<span class="w"> </span><span class="k">if</span>
</span><span id="__span-154-4"><a id="__codelineno-154-4" name="__codelineno-154-4" href="#__codelineno-154-4"></a><span class="c1"># Should show: lan3: active, lan4: active, mesh0: active</span>
</span></code></pre></div> <h4 id="all-gateways-down">All Gateways Down<a class="headerlink" href="#all-gateways-down" title="Permanent link"></a></h4> <p><strong>Symptoms:</strong> No internet access from any node</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-155-1"><a id="__codelineno-155-1" name="__codelineno-155-1" href="#__codelineno-155-1"></a>batctl<span class="w"> </span>gwl
</span><span id="__span-155-2"><a id="__codelineno-155-2" name="__codelineno-155-2" href="#__codelineno-155-2"></a><span class="c1"># Shows: No gateways</span>
</span></code></pre></div> <p><strong>Diagnosis:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-156-1"><a id="__codelineno-156-1" name="__codelineno-156-1" href="#__codelineno-156-1"></a><span class="c1"># Check each node's WAN</span>
</span><span id="__span-156-2"><a id="__codelineno-156-2" name="__codelineno-156-2" href="#__codelineno-156-2"></a>ping<span class="w"> </span>-I<span class="w"> </span>wan<span class="w"> </span><span class="m">1</span>.1.1.1<span class="w">  </span><span class="c1"># On Node 1</span>
</span><span id="__span-156-3"><a id="__codelineno-156-3" name="__codelineno-156-3" href="#__codelineno-156-3"></a>ping<span class="w"> </span>-I<span class="w"> </span>wan<span class="w"> </span><span class="m">1</span>.1.1.1<span class="w">  </span><span class="c1"># On Node 2</span>
</span><span id="__span-156-4"><a id="__codelineno-156-4" name="__codelineno-156-4" href="#__codelineno-156-4"></a>ping<span class="w"> </span>-I<span class="w"> </span>wan<span class="w"> </span><span class="m">1</span>.1.1.1<span class="w">  </span><span class="c1"># On Node 3</span>
</span></code></pre></div> <p><strong>Recovery:</strong></p> <ul> <li>Fix WAN connections (check cables, ISP)</li> <li>Verify gateway mode:</li> </ul> <div class="language-bash highlight"><pre><span></span><code><span id="__span-157-1"><a id="__codelineno-157-1" name="__codelineno-157-1" href="#__codelineno-157-1"></a>batctl<span class="w"> </span>gw_mode
</span><span id="__span-157-2"><a id="__codelineno-157-2" name="__codelineno-157-2" href="#__codelineno-157-2"></a><span class="c1"># Should show: server</span>
</span></code></pre></div> <h4 id="node-completely-unresponsive">Node Completely Unresponsive<a class="headerlink" href="#node-completely-unresponsive" title="Permanent link"></a></h4> <p><strong>Recovery steps:</strong></p> <ol> <li><strong>Power cycle</strong> the node</li> <li><strong>Check physical connections</strong> (power, ethernet)</li> <li><strong>Monitor boot process:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-158-1"><a id="__codelineno-158-1" name="__codelineno-158-1" href="#__codelineno-158-1"></a><span class="c1"># From another node</span>
</span><span id="__span-158-2"><a id="__codelineno-158-2" name="__codelineno-158-2" href="#__codelineno-158-2"></a>ping<span class="w"> </span><span class="m">10</span>.11.12.X
</span><span id="__span-158-3"><a id="__codelineno-158-3" name="__codelineno-158-3" href="#__codelineno-158-3"></a><span class="c1"># Should respond after ~60 seconds</span>
</span></code></pre></div> <ol> <li><strong>Verify services started:</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id="__span-159-1"><a id="__codelineno-159-1" name="__codelineno-159-1" href="#__codelineno-159-1"></a>ssh<span class="w"> </span>root@10.11.12.X
</span><span id="__span-159-2"><a id="__codelineno-159-2" name="__codelineno-159-2" href="#__codelineno-159-2"></a>batctl<span class="w"> </span><span class="k">if</span>
</span><span id="__span-159-3"><a id="__codelineno-159-3" name="__codelineno-159-3" href="#__codelineno-159-3"></a>batctl<span class="w"> </span>o
</span></code></pre></div> <h4 id="client-cant-connect-after-node-restart">Client Can't Connect After Node Restart<a class="headerlink" href="#client-cant-connect-after-node-restart" title="Permanent link"></a></h4> <p><strong>Quick fix:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-160-1"><a id="__codelineno-160-1" name="__codelineno-160-1" href="#__codelineno-160-1"></a><span class="c1"># On the affected node</span>
</span><span id="__span-160-2"><a id="__codelineno-160-2" name="__codelineno-160-2" href="#__codelineno-160-2"></a>/etc/init.d/network<span class="w"> </span>restart
</span><span id="__span-160-3"><a id="__codelineno-160-3" name="__codelineno-160-3" href="#__codelineno-160-3"></a>/etc/init.d/dnsmasq<span class="w"> </span>restart
</span><span id="__span-160-4"><a id="__codelineno-160-4" name="__codelineno-160-4" href="#__codelineno-160-4"></a>
</span><span id="__span-160-5"><a id="__codelineno-160-5" name="__codelineno-160-5" href="#__codelineno-160-5"></a><span class="c1"># Or full reboot</span>
</span><span id="__span-160-6"><a id="__codelineno-160-6" name="__codelineno-160-6" href="#__codelineno-160-6"></a>reboot
</span></code></pre></div> <h3 id="port-cheat-sheet">Port Cheat Sheet<a class="headerlink" href="#port-cheat-sheet" title="Permanent link"></a></h3> <div class="language-text highlight"><pre><span></span><code><span id="__span-161-1"><a id="__codelineno-161-1" name="__codelineno-161-1" href="#__codelineno-161-1"></a>
</span><span id="__span-161-2"><a id="__codelineno-161-2" name="__codelineno-161-2" href="#__codelineno-161-2"></a>  DIR-1960 Port Reference                
</span><span id="__span-161-3"><a id="__codelineno-161-3" name="__codelineno-161-3" href="#__codelineno-161-3"></a>
</span><span id="__span-161-4"><a id="__codelineno-161-4" name="__codelineno-161-4" href="#__codelineno-161-4"></a> Port         Purpose                   
</span><span id="__span-161-5"><a id="__codelineno-161-5" name="__codelineno-161-5" href="#__codelineno-161-5"></a>
</span><span id="__span-161-6"><a id="__codelineno-161-6" name="__codelineno-161-6" href="#__codelineno-161-6"></a> WAN (Blue)   ISP connection            
</span><span id="__span-161-7"><a id="__codelineno-161-7" name="__codelineno-161-7" href="#__codelineno-161-7"></a> LAN1 (Yel)   CLIENT DEVICES           
</span><span id="__span-161-8"><a id="__codelineno-161-8" name="__codelineno-161-8" href="#__codelineno-161-8"></a> LAN2 (Yel)   CLIENT DEVICES           
</span><span id="__span-161-9"><a id="__codelineno-161-9" name="__codelineno-161-9" href="#__codelineno-161-9"></a> LAN3 (Yel)   MESH (to another node)    
</span><span id="__span-161-10"><a id="__codelineno-161-10" name="__codelineno-161-10" href="#__codelineno-161-10"></a> LAN4 (Yel)   MESH (to another node)    
</span><span id="__span-161-11"><a id="__codelineno-161-11" name="__codelineno-161-11" href="#__codelineno-161-11"></a> WiFi 2.4GHz  MESH BACKUP (invisible)   
</span><span id="__span-161-12"><a id="__codelineno-161-12" name="__codelineno-161-12" href="#__codelineno-161-12"></a> WiFi 5GHz    CLIENT WIRELESS          
</span><span id="__span-161-13"><a id="__codelineno-161-13" name="__codelineno-161-13" href="#__codelineno-161-13"></a>
</span></code></pre></div> <h3 id="ip-address-allocation">IP Address Allocation<a class="headerlink" href="#ip-address-allocation" title="Permanent link"></a></h3> <div class="language-text highlight"><pre><span></span><code><span id="__span-162-1"><a id="__codelineno-162-1" name="__codelineno-162-1" href="#__codelineno-162-1"></a>10.11.12.1      - Node 1 (DHCP server, primary)
</span><span id="__span-162-2"><a id="__codelineno-162-2" name="__codelineno-162-2" href="#__codelineno-162-2"></a>10.11.12.2      - Node 2 (gateway)
</span><span id="__span-162-3"><a id="__codelineno-162-3" name="__codelineno-162-3" href="#__codelineno-162-3"></a>10.11.12.3      - Node 3 (gateway)
</span><span id="__span-162-4"><a id="__codelineno-162-4" name="__codelineno-162-4" href="#__codelineno-162-4"></a>10.11.12.10-99  - Reserved for static IPs
</span><span id="__span-162-5"><a id="__codelineno-162-5" name="__codelineno-162-5" href="#__codelineno-162-5"></a>10.11.12.100-250 - DHCP pool (clients)
</span></code></pre></div> <h3 id="important-files">Important Files<a class="headerlink" href="#important-files" title="Permanent link"></a></h3> <div class="language-text highlight"><pre><span></span><code><span id="__span-163-1"><a id="__codelineno-163-1" name="__codelineno-163-1" href="#__codelineno-163-1"></a>/etc/config/network   - Network interfaces
</span><span id="__span-163-2"><a id="__codelineno-163-2" name="__codelineno-163-2" href="#__codelineno-163-2"></a>/etc/config/wireless  - WiFi configuration
</span><span id="__span-163-3"><a id="__codelineno-163-3" name="__codelineno-163-3" href="#__codelineno-163-3"></a>/etc/config/dhcp      - DHCP/DNS settings
</span><span id="__span-163-4"><a id="__codelineno-163-4" name="__codelineno-163-4" href="#__codelineno-163-4"></a>/etc/config/firewall  - Firewall rules
</span><span id="__span-163-5"><a id="__codelineno-163-5" name="__codelineno-163-5" href="#__codelineno-163-5"></a>
</span><span id="__span-163-6"><a id="__codelineno-163-6" name="__codelineno-163-6" href="#__codelineno-163-6"></a>/tmp/dhcp.leases      - Active DHCP leases
</span><span id="__span-163-7"><a id="__codelineno-163-7" name="__codelineno-163-7" href="#__codelineno-163-7"></a>/var/log/messages     - System log
</span></code></pre></div> <h3 id="getting-help">Getting Help<a class="headerlink" href="#getting-help" title="Permanent link"></a></h3> <div class="language-bash highlight"><pre><span></span><code><span id="__span-164-1"><a id="__codelineno-164-1" name="__codelineno-164-1" href="#__codelineno-164-1"></a><span class="c1"># System status</span>
</span><span id="__span-164-2"><a id="__codelineno-164-2" name="__codelineno-164-2" href="#__codelineno-164-2"></a>/root/mesh_monitor.sh
</span><span id="__span-164-3"><a id="__codelineno-164-3" name="__codelineno-164-3" href="#__codelineno-164-3"></a>
</span><span id="__span-164-4"><a id="__codelineno-164-4" name="__codelineno-164-4" href="#__codelineno-164-4"></a><span class="c1"># Detailed logs</span>
</span><span id="__span-164-5"><a id="__codelineno-164-5" name="__codelineno-164-5" href="#__codelineno-164-5"></a>logread<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>batman
</span><span id="__span-164-6"><a id="__codelineno-164-6" name="__codelineno-164-6" href="#__codelineno-164-6"></a>logread<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>dhcp
</span><span id="__span-164-7"><a id="__codelineno-164-7" name="__codelineno-164-7" href="#__codelineno-164-7"></a>logread<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>error
</span><span id="__span-164-8"><a id="__codelineno-164-8" name="__codelineno-164-8" href="#__codelineno-164-8"></a>
</span><span id="__span-164-9"><a id="__codelineno-164-9" name="__codelineno-164-9" href="#__codelineno-164-9"></a><span class="c1"># Dump all network info</span>
</span><span id="__span-164-10"><a id="__codelineno-164-10" name="__codelineno-164-10" href="#__codelineno-164-10"></a>uci<span class="w"> </span>show<span class="w"> </span>network
</span><span id="__span-164-11"><a id="__codelineno-164-11" name="__codelineno-164-11" href="#__codelineno-164-11"></a>uci<span class="w"> </span>show<span class="w"> </span>wireless
</span><span id="__span-164-12"><a id="__codelineno-164-12" name="__codelineno-164-12" href="#__codelineno-164-12"></a>uci<span class="w"> </span>show<span class="w"> </span>dhcp
</span></code></pre></div> <hr> <h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link"></a></h2> <p>You now have a production-ready, highly-available mesh network with:</p> <p> Three independent internet gateways  Automatic failover (wired  wireless  gateway)  Full ring topology for maximum redundancy  VLAN support for network segmentation  Unified WiFi with seamless roaming  Comprehensive monitoring and troubleshooting tools</p> <h3 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link"></a></h3> <ol> <li><strong>Implement monitoring</strong> - Set up the monitoring scripts</li> <li><strong>Test thoroughly</strong> - Run through all failover scenarios</li> <li><strong>Tune performance</strong> - Adjust based on your specific environment</li> <li><strong>Document specifics</strong> - Note your exact cable runs, WAN providers, etc.</li> <li><strong>Enjoy your HA network!</strong></li> </ol> <h3 id="support">Support<a class="headerlink" href="#support" title="Permanent link"></a></h3> <p>If you encounter issues not covered in this guide:</p> <ol> <li>Check OpenWrt forums</li> <li>Review batman-adv documentation</li> <li>Enable debug logging: <code>batctl loglevel all</code></li> <li>Join the OpenWrt IRC channel for real-time help</li> </ol> <hr> <p><strong>Document Version:</strong> 1.0 <strong>Last Updated:</strong> 2025-11-05 <strong>Author:</strong> Network Architecture Guide <strong>License:</strong> CC BY-SA 4.0</p> <aside class="md-source-file"> <span class="md-source-file__fact"> <span class="md-icon" title="Last update"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="November 6, 2025 05:13:17 UTC"><span class="timeago" datetime="2025-11-06T05:13:17+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="November 6, 2025 05:13:17 UTC">2025-11-06</span> </span> <span class="md-source-file__fact"> <span class="md-icon" title="Created"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="November 5, 2025 02:48:29 UTC"><span class="timeago" datetime="2025-11-05T02:48:29+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="November 5, 2025 02:48:29 UTC">2025-11-05</span> </span> </aside> <form class="md-feedback" name="feedback" hidden> <fieldset> <legend class="md-feedback__title"> Was this page helpful? </legend> <div class="md-feedback__inner"> <div class="md-feedback__list"> <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"></path></svg> </button> <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"></path></svg> </button> </div> <div class="md-feedback__note"> <div data-md-value="1" hidden> Thanks for your feedback! </div> <div data-md-value="0" hidden> Thanks for your feedback! Help us improve this page by opening an issue on GitHub. </div> </div> </div> </fieldset> </form> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type="button" class="md-top md-icon" data-md-component="top" hidden> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg> Back to top </button> </main> <footer class="md-footer"> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class="md-copyright"> <div class="md-copyright__highlight"> Copyright  2025 OpenWrt Mesh Network Project </div> Made with <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener"> Material for MkDocs </a> </div> <div class="md-social"> <a href="https://github.com/git-kubik/mesh" target="_blank" rel="noopener" title="github.com" class="md-social__link"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </a> <a href="https://hub.docker.com/" target="_blank" rel="noopener" title="hub.docker.com" class="md-social__link"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1zm0-204.3h-66.1v60.7h66.1zm78.2 144.8H362v59.4h66.1zm-156.3-72.1h-66.1v60.1h66.1zm78.1 0h-66.1v60.1h66.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1zm78.1 0h-66.1v59.4h66.1zm-78.1-72.1h-66.1v60.1h66.1z"></path></svg> </a> </div> </div> </div> </footer> </div> <div class="md-dialog" data-md-component="dialog"> <div class="md-dialog__inner md-typeset"></div> </div> <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "content.action.edit", "content.action.view"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script> <script src="../js/timeago.min.js"></script> <script src="../js/timeago_mkdocs_material.js"></script>  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>